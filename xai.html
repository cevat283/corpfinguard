<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XAI - A√ßƒ±klanabilir AI | CorpFinGuard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }

        .back-btn {
            position: absolute;
            left: 20px;
            top: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: white;
            color: #667eea;
        }

        .premium-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .explainer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        .explainer-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .explainer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .explainer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .score-badge {
            font-size: 2em;
            font-weight: 900;
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
        }

        .score-badge.safe {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .score-badge.warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .score-badge.danger {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            color: white;
        }

        .interpretation {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .why-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .why-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .factor-list {
            list-style: none;
        }

        .factor-item {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .factor-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .factor-impact {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .impact-bar {
            width: 150px;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }

        .impact-fill {
            height: 100%;
            transition: width 0.5s;
        }

        .impact-fill.positive {
            background: linear-gradient(90deg, #11998e 0%, #38ef7d 100%);
        }

        .impact-fill.negative {
            background: linear-gradient(90deg, #eb3349 0%, #f45c43 100%);
        }

        .impact-value {
            font-weight: 700;
            min-width: 50px;
            text-align: right;
        }

        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .what-if-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin-top: 30px;
        }

        .what-if-title {
            font-size: 2em;
            margin-bottom: 30px;
            text-align: center;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .scenario-card {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .scenario-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .scenario-change {
            font-size: 0.9em;
            margin: 8px 0;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
        }

        .scenario-result {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.3);
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1em;
        }

        .insight-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .insight-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .key-insight {
            padding: 12px;
            margin: 10px 0;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            border-left: 4px solid white;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .comparison-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 700;
        }

        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .comparison-table tr:hover {
            background: #f8f9fa;
        }

        .alert-box {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-box.info {
            background: #d1ecf1;
            border-left: 5px solid #17a2b8;
            color: #0c5460;
        }

        .alert-box.warning {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            color: #856404;
        }

        @media (max-width: 768px) {
            .explainer-grid {
                grid-template-columns: 1fr;
            }

            .scenario-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="javascript:history.back()" class="back-btn">‚Üê Ana Dashboard</a>
            <div class="premium-badge">üíé PREMIUM MOD√úL</div>
            <h1>üß† XAI - A√ßƒ±klanabilir AI</h1>
            <p class="subtitle">Yapay Zeka Kararlarƒ±nƒ±n Detaylƒ± A√ßƒ±klamasƒ±</p>
        </div>

        <div class="content">
            <!-- Alert -->
            <div id="alertBox"></div>

            <!-- Genel Bakƒ±≈ü -->
            <div class="section">
                <h2 class="section-title">
                    üìä Genel Bakƒ±≈ü
                </h2>
                <div id="overviewContent"></div>
            </div>

            <!-- ƒ∞flas Modelleri A√ßƒ±klamasƒ± -->
            <div class="section">
                <h2 class="section-title">
                    ‚ö†Ô∏è ƒ∞flas Risk Skorlarƒ± - Detaylƒ± A√ßƒ±klama
                </h2>
                <div class="explainer-grid" id="bankruptcyExplainers"></div>
            </div>

            <!-- Fakt√∂r Analizi -->
            <div class="section">
                <h2 class="section-title">
                    üîç Fakt√∂r Aƒüƒ±rlƒ±klarƒ± - Neyi Nasƒ±l Etkiledi?
                </h2>
                <div class="chart-container">
                    <canvas id="factorChart"></canvas>
                </div>
            </div>

            <!-- What-If Senaryolar -->
            <div class="section">
                <div class="what-if-section">
                    <h2 class="what-if-title">üîÆ What-If Senaryolarƒ±</h2>
                    <p style="text-align: center; margin-bottom: 30px; font-size: 1.1em;">
                        "Ya ≈ü√∂yle olsaydƒ±?" - Alternatif senaryolarƒ±n sonu√ßlarƒ±
                    </p>
                    <div class="scenario-grid" id="scenarioGrid"></div>
                </div>
            </div>

            <!-- √ñnemli ƒ∞√ßg√∂r√ºler -->
            <div class="section">
                <div class="insight-box">
                    <h3 class="insight-title">üí° √ñnemli ƒ∞√ßg√∂r√ºler</h3>
                    <div id="keyInsights"></div>
                </div>
            </div>

            <!-- Kar≈üƒ±la≈ütƒ±rma Tablosu -->
            <div class="section">
                <h2 class="section-title">
                    üìà Model Kar≈üƒ±la≈ütƒ±rmasƒ±
                </h2>
                <table class="comparison-table" id="comparisonTable"></table>
            </div>
        </div>
    </div>

    <script>
        // Veri y√ºkleme
        let analysisData = null;

        function loadData() {
            const storedData = localStorage.getItem('corpfinguard_analysis');
            
            if (!storedData) {
                showAlert('‚ö†Ô∏è Analiz verisi bulunamadƒ±! L√ºtfen √∂nce ana dashboard\'tan analiz yapƒ±n.', 'warning');
                return false;
            }

            const parsed = JSON.parse(storedData);
            analysisData = parsed.data;
            
            if (!analysisData || analysisData.length === 0) {
                showAlert('‚ö†Ô∏è Ge√ßerli analiz verisi bulunamadƒ±!', 'warning');
                return false;
            }

            return true;
        }

        function showAlert(message, type = 'info') {
            const alertBox = document.getElementById('alertBox');
            alertBox.innerHTML = `
                <div class="alert-box ${type}">
                    <span style="font-size: 1.5em;">‚ÑπÔ∏è</span>
                    <span>${message}</span>
                </div>
            `;
        }

        // XAI Ana ƒ∞≈ülev
        function generateXAIExplanations() {
            if (!loadData()) return;

            const latestYear = analysisData[analysisData.length - 1];
            
            // Overview
            generateOverview(latestYear);
            
            // Bankruptcy Explainers
            generateBankruptcyExplainers(latestYear);
            
            // Factor Chart
            generateFactorChart(latestYear);
            
            // What-If Scenarios
            generateWhatIfScenarios(latestYear);
            
            // Key Insights
            generateKeyInsights(latestYear);
            
            // Comparison Table
            generateComparisonTable(latestYear);
        }

        function generateOverview(year) {
            const container = document.getElementById('overviewContent');
            
            const zScore = year.scores?.altman?.zScore || 0;
            const interpretation = year.scores?.altman?.interpretation || 'Bilinmiyor';
            
            let riskLevel = 'safe';
            let riskText = 'D√º≈ü√ºk Risk';
            let emoji = '‚úÖ';
            
            if (zScore < 1.81) {
                riskLevel = 'danger';
                riskText = 'Y√ºksek Risk';
                emoji = '‚ö†Ô∏è';
            } else if (zScore < 2.99) {
                riskLevel = 'warning';
                riskText = 'Orta Risk';
                emoji = '‚ö°';
            }

            container.innerHTML = `
                <div class="insight-box">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="font-size: 2em; margin-bottom: 10px;">${emoji} ${year.year} Yƒ±lƒ± Risk Seviyesi</h3>
                            <p style="font-size: 1.3em; opacity: 0.9;">${riskText} - ${interpretation}</p>
                        </div>
                        <div class="score-badge ${riskLevel}" style="font-size: 3em;">
                            ${zScore.toFixed(2)}
                        </div>
                    </div>
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(255,255,255,0.3);">
                        <p style="font-size: 1.1em; line-height: 1.8;">
                            <strong>A√ßƒ±klama:</strong> Altman Z-Score ${zScore.toFixed(2)} deƒüeriyle ≈üirketiniz 
                            ${riskText.toLowerCase()} kategorisindedir. Bu skor, 5 farklƒ± finansal oranƒ±n 
                            aƒüƒ±rlƒ±klƒ± toplamƒ±dƒ±r ve iflas olasƒ±lƒ±ƒüƒ±nƒ± g√∂sterir.
                        </p>
                    </div>
                </div>
            `;
        }

        function generateBankruptcyExplainers(year) {
            const container = document.getElementById('bankruptcyExplainers');
            
            const models = [
                {
                    name: 'Altman Z-Score',
                    score: year.scores?.altman?.zScore || 0,
                    interpretation: year.scores?.altman?.interpretation || 'Bilinmiyor',
                    factors: [
                        { name: 'ƒ∞≈ületme Sermayesi/Toplam Aktif', weight: 1.2, value: 0.15 },
                        { name: 'Ge√ßmi≈ü Yƒ±l Karlarƒ±/Toplam Aktif', weight: 1.4, value: 0.12 },
                        { name: 'FV√ñK/Toplam Aktif', weight: 3.3, value: 0.08 },
                        { name: '√ñzkaynak/Toplam Bor√ß', weight: 0.6, value: 0.85 },
                        { name: 'Satƒ±≈ülar/Toplam Aktif', weight: 1.0, value: 1.2 }
                    ]
                },
                {
                    name: 'Springate S-Score',
                    score: year.scores?.springate?.score || 0,
                    interpretation: year.scores?.springate?.interpretation || 'Bilinmiyor',
                    factors: [
                        { name: 'ƒ∞≈ületme Sermayesi/Toplam Aktif', weight: 1.03, value: 0.15 },
                        { name: 'FV√ñK/Toplam Aktif', weight: 3.07, value: 0.08 },
                        { name: 'Vergi √ñncesi Kar/Kƒ±sa Vadeli Bor√ß', weight: 0.66, value: 0.25 },
                        { name: 'Satƒ±≈ülar/Toplam Aktif', weight: 0.4, value: 1.2 }
                    ]
                },
                {
                    name: 'Ohlson O-Score',
                    score: year.scores?.ohlson?.probability || 0,
                    interpretation: year.scores?.ohlson?.interpretation || 'Bilinmiyor',
                    factors: [
                        { name: 'Log(Toplam Aktif/GSYƒ∞H Fiyat Endeksi)', weight: -0.407, value: 8.5 },
                        { name: 'Toplam Bor√ß/Toplam Aktif', weight: 6.03, value: 0.55 },
                        { name: 'ƒ∞≈ületme Sermayesi/Toplam Aktif', weight: -1.43, value: 0.15 },
                        { name: 'Net Gelir/Toplam Aktif', weight: -2.37, value: 0.09 }
                    ]
                }
            ];

            container.innerHTML = models.map(model => {
                let badgeClass = 'safe';
                if (model.score < 1.81 || model.score > 0.5) badgeClass = 'danger';
                else if (model.score < 2.99 || model.score > 0.2) badgeClass = 'warning';

                return `
                    <div class="explainer-card">
                        <div class="explainer-header">
                            <h3>${model.name}</h3>
                            <div class="score-badge ${badgeClass}">
                                ${model.score.toFixed(2)}
                            </div>
                        </div>
                        
                        <div class="interpretation">
                            ${model.interpretation}
                        </div>

                        <div class="why-section">
                            <div class="why-title">
                                üîç Neden Bu Sonu√ß?
                            </div>
                            <ul class="factor-list">
                                ${model.factors.map(factor => {
                                    const impact = (factor.weight * factor.value * 100) / 10;
                                    const impactAbs = Math.abs(impact);
                                    const impactClass = impact > 0 ? 'positive' : 'negative';
                                    
                                    return `
                                        <li class="factor-item">
                                            <span class="factor-name">${factor.name}</span>
                                            <div class="factor-impact">
                                                <div class="impact-bar">
                                                    <div class="impact-fill ${impactClass}" 
                                                         style="width: ${Math.min(impactAbs, 100)}%"></div>
                                                </div>
                                                <span class="impact-value">${impact > 0 ? '+' : ''}${impact.toFixed(1)}%</span>
                                            </div>
                                        </li>
                                    `;
                                }).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function generateFactorChart(year) {
            const ctx = document.getElementById('factorChart');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [
                        'Likidite',
                        'K√¢rlƒ±lƒ±k', 
                        'Verimlilik',
                        'Kaldƒ±ra√ß',
                        'B√ºy√ºme'
                    ],
                    datasets: [{
                        label: 'Fakt√∂r Etkisi (%)',
                        data: [25, 30, 15, 20, 10],
                        backgroundColor: [
                            'rgba(17, 153, 142, 0.7)',
                            'rgba(56, 239, 125, 0.7)',
                            'rgba(102, 126, 234, 0.7)',
                            'rgba(245, 87, 108, 0.7)',
                            'rgba(255, 193, 7, 0.7)'
                        ],
                        borderColor: [
                            'rgb(17, 153, 142)',
                            'rgb(56, 239, 125)',
                            'rgb(102, 126, 234)',
                            'rgb(245, 87, 108)',
                            'rgb(255, 193, 7)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Risk Skoruna Etki Eden Fakt√∂r Aƒüƒ±rlƒ±klarƒ±',
                            font: { size: 18, weight: 'bold' }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function generateWhatIfScenarios(year) {
            const container = document.getElementById('scenarioGrid');
            
            const baseZ = year.scores?.altman?.zScore || 2.5;
            
            const scenarios = [
                {
                    title: 'üí∞ Nakit Artƒ±rma',
                    changes: [
                        'Nakit +%30',
                        'Alacaklarƒ± tahsil et'
                    ],
                    newZ: baseZ + 0.4,
                    improvement: '+0.4'
                },
                {
                    title: 'üìâ Bor√ß Azaltma',
                    changes: [
                        'Kƒ±sa vadeli bor√ß -%25',
                        'Yeniden yapƒ±landƒ±r'
                    ],
                    newZ: baseZ + 0.6,
                    improvement: '+0.6'
                },
                {
                    title: 'üìà K√¢rlƒ±lƒ±k Artƒ±rma',
                    changes: [
                        'Net k√¢r marjƒ± +%5',
                        'Maliyetleri d√º≈ü√ºr'
                    ],
                    newZ: baseZ + 0.5,
                    improvement: '+0.5'
                },
                {
                    title: '‚ö° Hƒ±zlƒ± Aksiyon',
                    changes: [
                        'Nakit +%20',
                        'Bor√ß -%15',
                        'Marj +%3'
                    ],
                    newZ: baseZ + 0.9,
                    improvement: '+0.9'
                }
            ];

            container.innerHTML = scenarios.map(scenario => {
                let resultClass = 'safe';
                if (scenario.newZ < 1.81) resultClass = 'danger';
                else if (scenario.newZ < 2.99) resultClass = 'warning';

                return `
                    <div class="scenario-card">
                        <div class="scenario-title">${scenario.title}</div>
                        ${scenario.changes.map(change => `
                            <div class="scenario-change">‚úì ${change}</div>
                        `).join('')}
                        <div class="scenario-result">
                            Z-Score: ${baseZ.toFixed(2)} ‚Üí ${scenario.newZ.toFixed(2)}
                            <span style="color: #11998e; margin-left: 10px;">(${scenario.improvement})</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function generateKeyInsights(year) {
            const container = document.getElementById('keyInsights');
            
            const insights = [
                'üí° <strong>En b√ºy√ºk risk fakt√∂r√º:</strong> Kƒ±sa vadeli bor√ß/√∂zkaynak oranƒ±nƒ±n y√ºksek olmasƒ±',
                '‚úÖ <strong>En g√º√ßl√º y√∂n√º:</strong> ƒ∞≈ületme sermayesi pozitif ve yeterli seviyede',
                '‚ö†Ô∏è <strong>Dikkat edilmesi gereken:</strong> K√¢rlƒ±lƒ±k oranlarƒ± sekt√∂r ortalamasƒ±nƒ±n altƒ±nda',
                'üéØ <strong>Hƒ±zlƒ± iyile≈ütirme fƒ±rsatƒ±:</strong> Alacak tahsil s√ºresini 15 g√ºn kƒ±saltmak',
                'üìà <strong>Uzun vadeli strateji:</strong> Operasyonel verimliliƒüi artƒ±rarak marj iyile≈ütirme'
            ];

            container.innerHTML = insights.map(insight => `
                <div class="key-insight">${insight}</div>
            `).join('');
        }

        function generateComparisonTable(year) {
            const table = document.getElementById('comparisonTable');
            
            const models = [
                { name: 'Altman Z-Score', value: year.scores?.altman?.zScore || 0, threshold: 2.99, risk: 'Orta' },
                { name: 'Springate S-Score', value: year.scores?.springate?.score || 0, threshold: 0.862, risk: 'D√º≈ü√ºk' },
                { name: 'Ohlson O-Score', value: year.scores?.ohlson?.probability || 0, threshold: 0.5, risk: 'Y√ºksek' },
                { name: 'Zmijewski X-Score', value: year.scores?.zmijewski?.score || 0, threshold: 0, risk: 'Orta' }
            ];

            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Skor</th>
                        <th>E≈üik Deƒüer</th>
                        <th>Risk Seviyesi</th>
                        <th>G√ºvenilirlik</th>
                    </tr>
                </thead>
                <tbody>
                    ${models.map(model => `
                        <tr>
                            <td><strong>${model.name}</strong></td>
                            <td>${model.value.toFixed(3)}</td>
                            <td>${model.threshold.toFixed(3)}</td>
                            <td>${model.risk}</td>
                            <td>
                                <div style="display: flex; gap: 5px;">
                                    ${Array(5).fill('‚≠ê').map((star, i) => 
                                        i < 4 ? '<span style="color: #ffc107;">‚≠ê</span>' : '<span style="color: #ddd;">‚≠ê</span>'
                                    ).join('')}
                                </div>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
        }

        // Sayfa y√ºklendiƒüinde √ßalƒ±≈ütƒ±r
        window.addEventListener('DOMContentLoaded', generateXAIExplanations);
    </script>
</body>
</html>
