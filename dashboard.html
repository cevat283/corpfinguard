<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CorpFinGuard ULTRA - Professional Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            border: none;
            outline: none;
        }

        .logout-btn:hover {
            background: white;
            color: #667eea;
        }

        .header .badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            margin: 5px;
            font-size: 12px;
        }

        .upload-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            text-align: center;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            background: #f0f4ff;
            border-color: #764ba2;
        }

        #fileInput {
            display: none;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            padding: 0;
            gap: 0;
            overflow-x: auto;
            border-bottom: 2px solid #dee2e6;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 14px;
            color: #495057;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
        }

        .tab-btn:hover {
            background: #e9ecef;
        }

        .tab-btn.active {
            color: #667eea;
            background: white;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            color: #2c3e50;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .data-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-size: 14px;
        }

        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .risk-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            margin: 5px;
        }

        .risk-low { background: #d4edda; color: #155724; }
        .risk-medium { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }
        .risk-critical { background: #721c24; color: white; }

        .info-box {
            background: #e7f1ff;
            border-left: 5px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .danger-box {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .patron-comment {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .patron-comment::before {
            content: "üí° PATRON ƒ∞√áƒ∞N √ñZET";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #ffc107;
            color: #000;
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .patron-comment.good {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
        }

        .patron-comment.danger {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-color: #dc3545;
        }

        .action-box {
            background: rgba(255,255,255,0.7);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .model-score {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            margin: 10px;
            font-size: 18px;
        }

        .score-good { background: #d4edda; color: #155724; }
        .score-warning { background: #fff3cd; color: #856404; }
        .score-danger { background: #f8d7da; color: #721c24; }

        .regulation-badge {
            display: inline-block;
            background: #6c757d;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-left: 5px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
        }

        .dupont-tree {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .dupont-node {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .manipulation-indicator {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .manipulation-high { background: #f8d7da; }
        .manipulation-medium { background: #fff3cd; }
        .manipulation-low { background: #d4edda; }

        .basel-table {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .bddk-classification {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .bddk-group {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            flex: 1;
            margin: 0 10px;
        }

        .bddk-1 { background: #d4edda; }
        .bddk-2 { background: #cfe2ff; }
        .bddk-3 { background: #fff3cd; }
        .bddk-4 { background: #f8d7da; }
        .bddk-5 { background: #721c24; color: white; }

        .tfrs9-stages {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .tfrs9-stage {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        @media print {
            .tabs, .upload-section { display: none; }
            .tab-content { display: block !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="user-info">
                <div class="user-badge">
                    <span id="userIcon">üë§</span>
                    <span id="userName">Kullanƒ±cƒ±</span>
                </div>
                <button class="logout-btn" onclick="logout()">üö™ √áƒ±kƒ±≈ü</button>
            </div>
            
            <h1>üõ°Ô∏è CorpFinGuard ULTRA</h1>
            <p>Kurumsal Finansal Risk Analiz ve Erken Uyarƒ± Sistemi</p>
            <div>
                <span class="badge">Basel III</span>
                <span class="badge">BDDK</span>
                <span class="badge">TFRS 9</span>
                <span class="badge">7 ƒ∞flas Modeli</span>
                <span class="badge">Benford Law</span>
                <span class="badge">DuPont</span>
                <span class="badge">40+ Oran</span>
            </div>
        </div>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <h2>üìä Mizan Dosyalarƒ±nƒ± Y√ºkleyin</h2>
                <p>Excel dosyalarƒ±nƒ±zƒ± buraya s√ºr√ºkleyin veya tƒ±klayƒ±n</p>
                <small>En az 2 yƒ±l, ideal 3-4 yƒ±l mizan verisi y√ºkleyin</small>
                <input type="file" id="fileInput" multiple accept=".xlsx,.xls">
            </div>
            <div id="fileList"></div>
            <button class="analyze-btn" onclick="startAnalysis()">üöÄ Analizi Ba≈ülat</button>
            <button class="analyze-btn" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);" onclick="startDemoAnalysis()">üé≠ Demo Veriyle Test Et</button>
            <button class="analyze-btn" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);" onclick="clearAllData()">üóëÔ∏è Verileri Temizle</button>
        </div>

        <div id="reportSection" style="display: none;">
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('overview', event)">üìä √ñzet</button>
                <button class="tab-btn" onclick="showTab('ratios', event)">üìà 40+ Oran</button>
                <button class="tab-btn" onclick="showTab('dupont', event)">üéØ DuPont</button>
                <button class="tab-btn" onclick="showTab('bankruptcy', event)">‚ö†Ô∏è 7 ƒ∞flas Modeli</button>
                <button class="tab-btn" onclick="showTab('manipulation', event)">üîç Hile Tespiti</button>
                <button class="tab-btn" onclick="showTab('basel', event)">üè¶ Basel III</button>
                <button class="tab-btn" onclick="showTab('bddk', event)">üèõÔ∏è BDDK</button>
                <button class="tab-btn" onclick="showTab('tfrs9', event)">üìã TFRS 9</button>
                <button class="tab-btn" onclick="showTab('credit', event)">üí≥ Kredi</button>
                <button class="tab-btn" onclick="showTab('trends', event)">üìâ Trendler</button>
                <button class="tab-btn" onclick="showTab('cashflow', event)">üí∞ Nakit</button>
                <button class="tab-btn" onclick="showTab('scenario', event)">üîÆ Senaryo</button>
                <button class="tab-btn" onclick="showTab('valuation', event)">üíé Deƒüerleme</button>
                <button class="tab-btn" onclick="showTab('recommendations', event)">üí° √ñneriler</button>
            </div>

            <div id="tabContents"></div>
        </div>
    </div>

    <script>
        // ============= SESSION MANAGEMENT =============
        let currentUser = null;
        
        // Logout fonksiyonu
        function logout() {
            if (confirm('√áƒ±kƒ±≈ü yapmak istediƒüinize emin misiniz?')) {
                localStorage.removeItem('corpfinguard_session');
                sessionStorage.removeItem('corpfinguard_session');
                window.location.href = 'login.html';
            }
        }
        
        // Session kontrol√º - sayfa y√ºklendiƒüinde
        (function checkSession() {
            const sessionData = localStorage.getItem('corpfinguard_session') || 
                               sessionStorage.getItem('corpfinguard_session');
            
            if (!sessionData) {
                window.location.href = 'login.html';
                return;
            }
            
            currentUser = JSON.parse(sessionData);
            
            // Sayfa y√ºklendiƒüinde kullanƒ±cƒ± bilgilerini g√∂ster
            window.addEventListener('DOMContentLoaded', function() {
                document.getElementById('userName').textContent = currentUser.name;
                
                if (currentUser.isDemo) {
                    document.getElementById('userIcon').textContent = 'üé≠';
                    document.getElementById('userName').textContent = 'Demo Kullanƒ±cƒ±';
                }
            });
        })();
        
        // ============= ORIGINAL CODE STARTS HERE =============
        // Global deƒüi≈ükenler
        let uploadedFiles = [];
        let parsedData = [];

        // Dosya y√ºkleme
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('click', () => {
            // Premium kontrol√º - sadece Excel y√ºkleme i√ßin
            if (currentUser && currentUser.isDemo) {
                alert('üîí Excel y√ºkleme √∂zelliƒüi premium √ºyelere √∂zeldir!\n\n‚úÖ Demo ile t√ºm mod√ºlleri deneyebilirsiniz!\nüìä "Demo Veriyle Test Et" butonuna tƒ±klayƒ±n.\n\nüíé Premium √∂zellikleri kullanmak i√ßin:\n‚Ä¢ √áƒ±kƒ±≈ü yapƒ±n\n‚Ä¢ "Kayƒ±t Ol" ile √ºcretsiz hesap olu≈üturun');
                return;
            }
            fileInput.click();
        });
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.background = '#f0f4ff';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.background = 'white';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.background = 'white';
            
            // Premium kontrol√º
            if (currentUser && currentUser.isDemo) {
                alert('üîí Excel y√ºkleme √∂zelliƒüi premium √ºyelere √∂zeldir!');
                return;
            }
            
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            // Premium kontrol√º
            if (currentUser && currentUser.isDemo) {
                alert('üîí Excel y√ºkleme √∂zelliƒüi premium √ºyelere √∂zeldir!');
                return;
            }
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            uploadedFiles = Array.from(files);
            displayFileList();
        }

        function displayFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '<h3>Y√ºklenen Dosyalar:</h3>' +
                uploadedFiles.map(file => `<p>‚úì ${file.name}</p>`).join('');
        }

        // Excel okuma - √áALI≈ûAN VERSƒ∞YON
        async function startAnalysis() {
            if (uploadedFiles.length === 0) {
                alert('L√ºtfen Excel dosyasƒ± y√ºkleyin veya Demo verilerden birini kullanƒ±n!');
                return;
            }
            
            parsedData = [];
            showLoading(true);
            
            try {
                for (let file of uploadedFiles) {
                    const data = await readExcelFile(file);
                    if (data) parsedData.push(data);
                }
                
                if (parsedData.length === 0) {
                    throw new Error('Excel dosyasƒ±ndan veri okunamadƒ±');
                }
                
                // Sort by year
                parsedData.sort((a, b) => a.year - b.year);
                
                // Save to localStorage
                saveDataToStorage();
                
                // Generate report
                generateReport(parsedData);
                document.getElementById('reportSection').style.display = 'block';
                document.getElementById('reportSection').scrollIntoView({ behavior: 'smooth' });
                
                showLoading(false);
                alert('‚úÖ Excel dosyasƒ± ba≈üarƒ±yla analiz edildi! T√ºm mod√ºller hazƒ±r.');
                
            } catch (error) {
                showLoading(false);
                alert('‚ùå Hata: ' + error.message);
            }
        }

        // DEMO VERƒ∞ OLU≈ûTUR
        function generateDemoData() {
            return [
                {
                    year: 2021,
                    // Bilan√ßo
                    cash: 12500000,
                    marketableSecurities: 3000000,
                    receivables: 28000000,
                    inventory: 19000000,
                    prepaidExpenses: 2000000,
                    otherCurrentAssets: 1500000,
                    currentAssets: 66000000,
                    
                    ppe: 45000000,
                    intangibles: 5000000,
                    investments: 8000000,
                    otherNonCurrentAssets: 3000000,
                    nonCurrentAssets: 61000000,
                    totalAssets: 127000000,
                    
                    accountsPayable: 18000000,
                    shortTermDebt: 15000000,
                    currentPortionLTD: 5000000,
                    accruedExpenses: 4000000,
                    otherCurrentLiabilities: 2000000,
                    currentLiabilities: 44000000,
                    
                    longTermDebt: 32000000,
                    deferredTaxes: 3000000,
                    otherNonCurrentLiabilities: 2000000,
                    nonCurrentLiabilities: 37000000,
                    totalLiabilities: 81000000,
                    
                    commonStock: 20000000,
                    retainedEarnings: 24000000,
                    otherEquity: 2000000,
                    totalEquity: 46000000,
                    
                    // Gelir Tablosu
                    revenue: 145000000,
                    cogs: 94250000,
                    grossProfit: 50750000,
                    
                    salesExpenses: 14500000,
                    adminExpenses: 10150000,
                    rdExpenses: 2900000,
                    operatingExpenses: 27550000,
                    operatingIncome: 23200000,
                    
                    depreciation: 4500000,
                    amortization: 500000,
                    ebitda: 28200000,
                    
                    interestExpense: 5200000,
                    otherIncome: 1000000,
                    ebt: 19000000,
                    
                    taxExpense: 4180000,
                    netIncome: 14820000,
                    
                    // Nakit Akƒ±m
                    operatingCashFlow: 18500000,
                    investingCashFlow: -8000000,
                    financingCashFlow: -5000000,
                    freeCashFlow: 10500000,
                    
                    // Diƒüer
                    sharesOutstanding: 10000000,
                    dividendsPaid: 4000000,
                    capex: 7000000,
                    workingCapital: 22000000,
                    
                    // Risk Aƒüƒ±rlƒ±klƒ± Varlƒ±klar (Basel III)
                    riskWeightedAssets: 95000000,
                    tier1Capital: 38000000,
                    tier2Capital: 8000000,
                    cet1Capital: 35000000
                },
                {
                    year: 2022,
                    cash: 9800000,
                    marketableSecurities: 2500000,
                    receivables: 34000000,
                    inventory: 24000000,
                    prepaidExpenses: 2500000,
                    otherCurrentAssets: 1700000,
                    currentAssets: 74500000,
                    
                    ppe: 52000000,
                    intangibles: 5500000,
                    investments: 9000000,
                    otherNonCurrentAssets: 3500000,
                    nonCurrentAssets: 70000000,
                    totalAssets: 144500000,
                    
                    accountsPayable: 22000000,
                    shortTermDebt: 20000000,
                    currentPortionLTD: 6000000,
                    accruedExpenses: 5000000,
                    otherCurrentLiabilities: 2500000,
                    currentLiabilities: 55500000,
                    
                    longTermDebt: 38000000,
                    deferredTaxes: 3500000,
                    otherNonCurrentLiabilities: 2500000,
                    nonCurrentLiabilities: 44000000,
                    totalLiabilities: 99500000,
                    
                    commonStock: 20000000,
                    retainedEarnings: 23000000,
                    otherEquity: 2000000,
                    totalEquity: 45000000,
                    
                    revenue: 162000000,
                    cogs: 108540000,
                    grossProfit: 53460000,
                    
                    salesExpenses: 17820000,
                    adminExpenses: 11340000,
                    rdExpenses: 3240000,
                    operatingExpenses: 32400000,
                    operatingIncome: 21060000,
                    
                    depreciation: 5200000,
                    amortization: 600000,
                    ebitda: 26860000,
                    
                    interestExpense: 6800000,
                    otherIncome: 800000,
                    ebt: 15060000,
                    
                    taxExpense: 3313000,
                    netIncome: 11747000,
                    
                    operatingCashFlow: 15200000,
                    investingCashFlow: -12000000,
                    financingCashFlow: -2000000,
                    freeCashFlow: 3200000,
                    
                    sharesOutstanding: 10000000,
                    dividendsPaid: 3500000,
                    capex: 9000000,
                    workingCapital: 19000000,
                    
                    riskWeightedAssets: 108000000,
                    tier1Capital: 36000000,
                    tier2Capital: 9000000,
                    cet1Capital: 33000000
                },
                {
                    year: 2023,
                    cash: 6200000,
                    marketableSecurities: 1800000,
                    receivables: 42000000,
                    inventory: 31000000,
                    prepaidExpenses: 3000000,
                    otherCurrentAssets: 2000000,
                    currentAssets: 86000000,
                    
                    ppe: 58000000,
                    intangibles: 6000000,
                    investments: 10000000,
                    otherNonCurrentAssets: 4000000,
                    nonCurrentAssets: 78000000,
                    totalAssets: 164000000,
                    
                    accountsPayable: 28000000,
                    shortTermDebt: 28000000,
                    currentPortionLTD: 8000000,
                    accruedExpenses: 6000000,
                    otherCurrentLiabilities: 3000000,
                    currentLiabilities: 73000000,
                    
                    longTermDebt: 45000000,
                    deferredTaxes: 4000000,
                    otherNonCurrentLiabilities: 3000000,
                    nonCurrentLiabilities: 52000000,
                    totalLiabilities: 125000000,
                    
                    commonStock: 20000000,
                    retainedEarnings: 17000000,
                    otherEquity: 2000000,
                    totalEquity: 39000000,
                    
                    revenue: 168000000,
                    cogs: 117600000,
                    grossProfit: 50400000,
                    
                    salesExpenses: 20160000,
                    adminExpenses: 13440000,
                    rdExpenses: 3360000,
                    operatingExpenses: 36960000,
                    operatingIncome: 13440000,
                    
                    depreciation: 6000000,
                    amortization: 700000,
                    ebitda: 20140000,
                    
                    interestExpense: 9200000,
                    otherIncome: 500000,
                    ebt: 4740000,
                    
                    taxExpense: 1043000,
                    netIncome: 3697000,
                    
                    operatingCashFlow: 8500000,
                    investingCashFlow: -15000000,
                    financingCashFlow: 3000000,
                    freeCashFlow: -6500000,
                    
                    sharesOutstanding: 10000000,
                    dividendsPaid: 1000000,
                    capex: 12000000,
                    workingCapital: 13000000,
                    
                    riskWeightedAssets: 123000000,
                    tier1Capital: 31000000,
                    tier2Capital: 8000000,
                    cet1Capital: 28000000
                }
            ];
        }

        // DEMO ANALƒ∞Z FONKSƒ∞YONU
        function startDemoAnalysis() {
            const demoData = generateDemoData();
            parsedData = demoData;
            generateReport(parsedData);
            document.getElementById('reportSection').style.display = 'block';
            
            setTimeout(() => {
                alert('üìä DEMO VERƒ∞LERLE TEST EDƒ∞YORSUNUZ!\n\n' + 
                      '‚úÖ 40+ Finansal Oran\n' +
                      '‚úÖ 7 ƒ∞flas Modeli (Altman, Springate, Ohlson...)\n' +
                      '‚úÖ Basel III, BDDK, TFRS 9 Analizleri\n' +
                      '‚úÖ Benford Law ile Hile Tespiti\n' +
                      '‚úÖ DuPont Analizi\n\n' +
                      'T√ºm mod√ºlleri inceleyebilirsiniz!');
            }, 500);
        }

        // EXCEL ANALƒ∞Z FONKSƒ∞YONU - GER√áEK Mƒ∞ZAN ƒ∞√áƒ∞N
        async function startAnalysis() {
            // Premium kontrol√º
            if (currentUser && currentUser.isDemo) {
                alert('üîí Excel analizi √∂zelliƒüi premium √ºyelere √∂zeldir!\n\n‚úÖ Demo veriyle t√ºm mod√ºlleri deneyebilirsiniz!\nüìä "Demo Veriyle Test Et" butonuna tƒ±klayƒ±n.');
                return;
            }
            
            if (uploadedFiles.length === 0) {
                alert('L√ºtfen en az 2 yƒ±llƒ±k mizan dosyasƒ± y√ºkleyin!');
                return;
            }
            
            parsedData = [];
            
            try {
                for (let file of uploadedFiles) {
                    const data = await readExcelFile(file);
                    parsedData.push(data);
                }
                
                // Yƒ±llarƒ± kronolojik sƒ±rala
                parsedData.sort((a, b) => a.year - b.year);
                
                if (parsedData.length < 2) {
                    alert('En az 2 yƒ±llƒ±k veri gerekli!');
                    return;
                }
                
                generateReport(parsedData);
                document.getElementById('reportSection').style.display = 'block';
                document.getElementById('reportSection').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                alert('Dosya okuma hatasƒ±: ' + error.message);
            }
        }

        // EXCEL OKUMA FONKSƒ∞YONU
        function readExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                        
                        // Dosya adƒ±ndan yƒ±l √ßƒ±kar
                        const year = extractYear(file.name) || new Date().getFullYear();
                        
                        // Mizan verilerini parse et
                        const financialData = parseMizanData(jsonData, year);
                        resolve(financialData);
                        
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.readAsArrayBuffer(file);
            });
        }

        // DOSYA ADINDAN YIL √áIKAR
        function extractYear(filename) {
            const match = filename.match(/20\d{2}/);
            return match ? parseInt(match[0]) : null;
        }

        // Mƒ∞ZAN VERƒ∞LERƒ∞Nƒ∞ PARSE ET - ALT HESAP DESTEƒûƒ∞
        function parseMizanData(data, year) {
            const accounts = {};
            
            // Parse each row
            data.forEach((row, index) => {
                if (!row || row.length < 3) return;
                
                let accountCode = null;
                let balance = 0;
                
                // Try different column formats
                if (typeof row[0] === 'string' && row[0].match(/^\d{3}/)) {
                    // Format: "102.01.01 - GARANTƒ∞ BANKASI"
                    accountCode = parseInt(row[0].substring(0, 3));
                    balance = parseFloat(row[row.length - 1]) || parseFloat(row[row.length - 2]) || 0;
                } else if (typeof row[0] === 'number') {
                    // Format: 102 as number
                    accountCode = row[0];
                    balance = parseFloat(row[row.length - 1]) || parseFloat(row[row.length - 2]) || 0;
                }
                
                if (accountCode && accountCode >= 100 && accountCode < 999) {
                    if (!accounts[accountCode]) accounts[accountCode] = 0;
                    accounts[accountCode] += Math.abs(balance);
                }
            });
            const result = {
                year: year,
                // Bilan√ßo kalemleri - ba≈ülangƒ±√ß deƒüerleri
                cash: 0,
                marketableSecurities: 0,
                receivables: 0,
                inventory: 0,
                prepaidExpenses: 0,
                otherCurrentAssets: 0,
                currentAssets: 0,
                ppe: 0,
                intangibles: 0,
                investments: 0,
                otherNonCurrentAssets: 0,
                nonCurrentAssets: 0,
                totalAssets: 0,
                accountsPayable: 0,
                shortTermDebt: 0,
                currentPortionLTD: 0,
                accruedExpenses: 0,
                otherCurrentLiabilities: 0,
                currentLiabilities: 0,
                longTermDebt: 0,
                deferredTaxes: 0,
                otherNonCurrentLiabilities: 0,
                nonCurrentLiabilities: 0,
                totalLiabilities: 0,
                commonStock: 0,
                retainedEarnings: 0,
                otherEquity: 0,
                totalEquity: 0,
                revenue: 0,
                cogs: 0,
                grossProfit: 0,
                salesExpenses: 0,
                adminExpenses: 0,
                rdExpenses: 0,
                operatingExpenses: 0,
                operatingIncome: 0,
                depreciation: 0,
                amortization: 0,
                ebitda: 0,
                interestExpense: 0,
                otherIncome: 0,
                ebt: 0,
                taxExpense: 0,
                netIncome: 0,
                operatingCashFlow: 0,
                investingCashFlow: 0,
                financingCashFlow: 0,
                freeCashFlow: 0,
                sharesOutstanding: 10000000,
                dividendsPaid: 0,
                capex: 0,
                workingCapital: 0
            };

            // HESAP KODU E≈ûLE≈ûTƒ∞RME KURALLARI
            const accountMapping = {
                // VARLIKLAR
                '100': 'cash', // Kasa
                '101': 'cash', // Alƒ±nan √áekler
                '102': 'cash', // Bankalar
                '103': 'cash', // Verilen √áekler ve √ñdeme Emirleri
                '108': 'otherCurrentAssets', // Diƒüer Hazƒ±r Deƒüerler
                '110': 'marketableSecurities', // Hisse Senetleri
                '111': 'marketableSecurities', // √ñzel Kesim Tahvil Senet ve Bonolarƒ±
                '112': 'marketableSecurities', // Kamu Kesimi Tahvil Senet ve Bonolarƒ±
                '118': 'marketableSecurities', // Diƒüer Menkul Kƒ±ymetler
                '120': 'receivables', // Alƒ±cƒ±lar
                '121': 'receivables', // Alacak Senetleri
                '122': 'receivables', // Alacak Senetleri Reeskontu
                '126': 'receivables', // Verilen Depozito ve Teminatlar
                '127': 'receivables', // Diƒüer Ticari Alacaklar
                '128': 'receivables', // ≈û√ºpheli Ticari Alacaklar
                '129': 'receivables', // ≈û√ºpheli Ticari Alacaklar Kar≈üƒ±lƒ±ƒüƒ±
                '150': 'inventory', // ƒ∞lk Madde ve Malzeme
                '151': 'inventory', // Yarƒ± Mamuller
                '152': 'inventory', // Mamuller
                '153': 'inventory', // Ticari Mallar
                '157': 'inventory', // Diƒüer Stoklar
                '180': 'prepaidExpenses', // Gelecek Aylara Ait Giderler
                '190': 'otherCurrentAssets', // Devreden KDV
                '191': 'otherCurrentAssets', // ƒ∞ndirilecek KDV
                '250': 'ppe', // Arazi ve Arsalar
                '251': 'ppe', // Yer Altƒ± ve Yer √úst√º D√ºzenleri
                '252': 'ppe', // Binalar
                '253': 'ppe', // Tesis Makine ve Cihazlar
                '254': 'ppe', // Ta≈üƒ±tlar
                '255': 'ppe', // Demirba≈ülar
                '257': 'ppe', // Birikmi≈ü Amortismanlar
                '260': 'intangibles', // Haklar
                '261': 'intangibles', // ≈ûerefiye
                '262': 'intangibles', // Kurulu≈ü ve √ñrg√ºtlenme Giderleri
                '263': 'intangibles', // Ara≈ütƒ±rma ve Geli≈ütirme Giderleri
                '264': 'intangibles', // √ñzel Maliyetler
                '268': 'intangibles', // Birikmi≈ü Amortismanlar
                
                // BOR√áLAR
                '300': 'shortTermDebt', // Banka Kredileri
                '303': 'shortTermDebt', // Uzun Vadeli Kredilerin Anapara Taksitleri
                '320': 'accountsPayable', // Satƒ±cƒ±lar
                '321': 'accountsPayable', // Bor√ß Senetleri
                '322': 'accountsPayable', // Bor√ß Senetleri Reeskontu
                '326': 'accountsPayable', // Alƒ±nan Depozito ve Teminatlar
                '329': 'accountsPayable', // Diƒüer Ticari Bor√ßlar
                '360': 'otherCurrentLiabilities', // √ñdenecek Vergi ve Fonlar
                '361': 'otherCurrentLiabilities', // √ñdenecek Sosyal G√ºvenlik Kesintileri
                '368': 'otherCurrentLiabilities', // Vadesi Ge√ßmi≈ü Ertelenmi≈ü veya Taksitlendirilmi≈ü Vergi ve Diƒüer Y√ºk√ºml√ºl√ºkler
                '370': 'otherCurrentLiabilities', // D√∂nem Karƒ± Vergi ve Diƒüer Yasal Y√ºk√ºml√ºl√ºk Kar≈üƒ±lƒ±klarƒ±
                '380': 'otherCurrentLiabilities', // Gelecek Aylara Ait Gelirler
                '381': 'otherCurrentLiabilities', // Gider Tahakkuklarƒ±
                '391': 'otherCurrentLiabilities', // Hesaplanan KDV
                '400': 'longTermDebt', // Banka Kredileri
                '405': 'longTermDebt', // √áƒ±karƒ±lmƒ±≈ü Tahviller
                '407': 'longTermDebt', // √áƒ±karƒ±lmƒ±≈ü Diƒüer Menkul Kƒ±ymetler
                '420': 'otherNonCurrentLiabilities', // Satƒ±cƒ±lar
                '479': 'deferredTaxes', // Diƒüer Bor√ß ve Gider Kar≈üƒ±lƒ±klarƒ±
                
                // √ñZKAYNAKLAR
                '500': 'commonStock', // Sermaye
                '501': 'commonStock', // √ñdenmemi≈ü Sermaye
                '520': 'otherEquity', // Hisse Senedi ƒ∞hra√ß Primleri
                '540': 'otherEquity', // Yasal Yedekler
                '541': 'otherEquity', // Stat√º Yedekleri
                '542': 'otherEquity', // Olaƒüan√ºst√º Yedekler
                '549': 'otherEquity', // √ñzel Fonlar
                '570': 'retainedEarnings', // Ge√ßmi≈ü Yƒ±llar Karlarƒ±
                '580': 'retainedEarnings', // Ge√ßmi≈ü Yƒ±llar Zararlarƒ±
                '590': 'retainedEarnings', // D√∂nem Net Karƒ±
                '591': 'retainedEarnings', // D√∂nem Net Zararƒ±
                
                // GELƒ∞R TABLOSU
                '600': 'revenue', // Yurti√ßi Satƒ±≈ülar
                '601': 'revenue', // Yurtdƒ±≈üƒ± Satƒ±≈ülar
                '610': 'revenue', // Satƒ±≈ütan ƒ∞adeler
                '611': 'revenue', // Satƒ±≈ü ƒ∞skontolarƒ±
                '612': 'revenue', // Diƒüer ƒ∞ndirimler
                '620': 'cogs', // Satƒ±lan Mamuller Maliyeti
                '621': 'cogs', // Satƒ±lan Ticari Mallar Maliyeti
                '622': 'cogs', // Satƒ±lan Hizmet Maliyeti
                '623': 'cogs', // Diƒüer Satƒ±≈ülarƒ±n Maliyeti
                '630': 'operatingExpenses', // Ara≈ütƒ±rma ve Geli≈ütirme Giderleri
                '631': 'salesExpenses', // Pazarlama Satƒ±≈ü ve Daƒüƒ±tƒ±m Giderleri
                '632': 'adminExpenses', // Genel Y√∂netim Giderleri
                '640': 'otherIncome', // ƒ∞≈ütiraklerden Temett√º Gelirleri
                '641': 'otherIncome', // Baƒülƒ± Ortaklƒ±klardan Temett√º Gelirleri
                '642': 'otherIncome', // Faiz Gelirleri
                '643': 'otherIncome', // Komisyon Gelirleri
                '644': 'otherIncome', // Konusu Kalmayan Kar≈üƒ±lƒ±klar
                '645': 'otherIncome', // Menkul Kƒ±ymet Satƒ±≈ü Karlarƒ±
                '646': 'otherIncome', // Kambiyo Karlarƒ±
                '647': 'otherIncome', // Reeskont Faiz Gelirleri
                '649': 'otherIncome', // Diƒüer Olaƒüan Gelir ve Karlar
                '653': 'otherIncome', // Komisyon Giderleri
                '654': 'otherIncome', // Kar≈üƒ±lƒ±k Giderleri
                '655': 'otherIncome', // Menkul Kƒ±ymet Satƒ±≈ü Zararlarƒ±
                '656': 'otherIncome', // Kambiyo Zararlarƒ±
                '657': 'otherIncome', // Reeskont Faiz Giderleri
                '659': 'otherIncome', // Diƒüer Olaƒüan Gider ve Zararlar
                '660': 'interestExpense', // Kƒ±sa Vadeli Bor√ßlanma Giderleri
                '661': 'interestExpense', // Uzun Vadeli Bor√ßlanma Giderleri
                '689': 'otherIncome', // Diƒüer Olaƒüandƒ±≈üƒ± Gelir ve Karlar
                '690': 'taxExpense', // D√∂nem Karƒ± Vergi ve Diƒüer Yasal Y√ºk√ºml√ºl√ºk Kar≈üƒ±lƒ±klarƒ±
                '691': 'taxExpense', // D√∂nem Karƒ± Vergi ve Diƒüer Yasal Y√ºk√ºml√ºl√ºk Kar≈üƒ±lƒ±klarƒ±
                '692': 'taxExpense', // D√∂nem Net Karƒ± veya Zararƒ±
                '697': 'otherIncome', // D√∂nem Net Karƒ± veya Zararƒ±
                '698': 'otherIncome', // D√∂nem Net Karƒ± veya Zararƒ±
                '730': 'operatingExpenses', // Genel √úretim Giderleri
                '740': 'operatingExpenses', // Hizmet √úretim Maliyeti
                '750': 'depreciation', // Ara≈ütƒ±rma ve Geli≈ütirme Giderleri
                '760': 'salesExpenses', // Pazarlama Satƒ±≈ü ve Daƒüƒ±tƒ±m Giderleri
                '770': 'adminExpenses', // Genel Y√∂netim Giderleri
                '780': 'interestExpense', // Finansman Giderleri
            };

            // Mizan verilerini i≈üle
            data.forEach(row => {
                if (!row || row.length < 3) return;
                
                // Hesap kodunu al (ilk 3 hane)
                const accountCode = String(row[0]).substring(0, 3);
                const debit = parseFloat(row[2]) || 0;  // Bor√ß
                const credit = parseFloat(row[3]) || 0; // Alacak
                const balance = debit - credit;
                
                // Hesap koduna g√∂re e≈üle≈ütir
                if (accountMapping[accountCode]) {
                    const field = accountMapping[accountCode];
                    
                    // Gelir tablosu kalemleri i√ßin mutlak deƒüer al
                    if (['revenue', 'cogs', 'operatingExpenses', 'salesExpenses', 'adminExpenses', 
                         'interestExpense', 'otherIncome', 'taxExpense', 'depreciation'].includes(field)) {
                        result[field] += Math.abs(balance);
                    } else {
                        result[field] += balance;
                    }
                }
            });

            // Toplamlarƒ± hesapla
            result.currentAssets = result.cash + result.marketableSecurities + result.receivables + 
                                   result.inventory + result.prepaidExpenses + result.otherCurrentAssets;
            
            result.nonCurrentAssets = result.ppe + result.intangibles + result.investments + 
                                      result.otherNonCurrentAssets;
            
            result.totalAssets = result.currentAssets + result.nonCurrentAssets;
            
            result.currentLiabilities = result.accountsPayable + result.shortTermDebt + 
                                       result.currentPortionLTD + result.accruedExpenses + 
                                       result.otherCurrentLiabilities;
            
            result.nonCurrentLiabilities = result.longTermDebt + result.deferredTaxes + 
                                           result.otherNonCurrentLiabilities;
            
            result.totalLiabilities = result.currentLiabilities + result.nonCurrentLiabilities;
            
            result.totalEquity = result.commonStock + result.retainedEarnings + result.otherEquity;
            
            // Gelir tablosu hesaplamalarƒ±
            result.grossProfit = result.revenue - result.cogs;
            result.operatingIncome = result.grossProfit - result.operatingExpenses - 
                                     result.salesExpenses - result.adminExpenses;
            result.ebitda = result.operatingIncome + result.depreciation + result.amortization;
            result.ebt = result.operatingIncome - result.interestExpense + result.otherIncome;
            result.netIncome = result.ebt - result.taxExpense;
            
            // Nakit akƒ±≈ü tahminleri (basitle≈ütirilmi≈ü)
            result.operatingCashFlow = result.netIncome + result.depreciation + result.amortization;
            result.investingCashFlow = -result.capex;
            result.financingCashFlow = result.dividendsPaid * -1;
            result.freeCashFlow = result.operatingCashFlow - result.capex;
            
            result.workingCapital = result.currentAssets - result.currentLiabilities;
            
            // Risk aƒüƒ±rlƒ±klƒ± varlƒ±klar (Basel III i√ßin tahmin)
            result.riskWeightedAssets = result.totalAssets * 0.75;
            result.tier1Capital = result.totalEquity * 0.9;
            result.tier2Capital = result.totalEquity * 0.1;
            result.cet1Capital = result.totalEquity * 0.85;
            
            return result;
        }

        // RAPOR OLU≈ûTUR
        function generateReport(years) {
            const tabContents = document.getElementById('tabContents');
            
            // Her yƒ±l i√ßin oranlarƒ± hesapla
            years.forEach(year => {
                year.ratios = calculateAllRatios(year);
                year.scores = calculateAllBankruptcyScores(year);
                year.manipulation = calculateManipulationIndicators(year);
                year.basel = calculateBaselIII(year);
                year.bddk = calculateBDDKClassification(year);
                year.tfrs9 = calculateTFRS9(year);
            });

            let html = '';
            
            // 1. Genel Bakƒ±≈ü
            html += generateOverview(years);
            
            // 2. 40+ Finansal Oran
            html += generateComprehensiveRatios(years);
            
            // 3. DuPont Analizi
            html += generateDuPontAnalysis(years);
            
            // 4. 7 ƒ∞flas Modeli
            html += generateBankruptcyModels(years);
            
            // 5. Hile Tespiti
            html += generateManipulationDetection(years);
            
            // 6. Basel III
            html += generateBaselIII(years);
            
            // 7. BDDK
            html += generateBDDK(years);
            
            // 8. TFRS 9
            html += generateTFRS9(years);
            
            // 9. Kredi Deƒüerlendirme
            html += generateCreditAssessment(years);
            
            // 10. Trend Analizi
            html += generateTrends(years);
            
            // 11. Nakit Akƒ±≈ü
            html += generateCashFlow(years);
            
            // 12. Senaryo Analizi
            html += generateScenarioAnalysis(years);
            
            // 13. ≈ûirket Deƒüerlemesi
            html += generateValuation(years);
            
            // 14. √ñneriler
            html += generateRecommendations(years);
            
            tabContents.innerHTML = html;
            showTab('overview');
            
            setTimeout(() => {
                createCharts(years);
            }, 100);
        }

        // 1. GENEL BAKI≈û
        function generateOverview(years) {
            const current = years[years.length - 1];
            const overallScore = calculateOverallRiskScore(current);
            
            return `
            <div class="tab-content active" id="overview">
                <div class="section">
                    <h2 class="section-title">üìä GENEL BAKI≈û</h2>
                    
                    <div class="grid-container">
                        <div class="metric-card">
                            <h3>Risk Skoru</h3>
                            <div class="metric-value">${overallScore}/100</div>
                            <span class="risk-badge risk-${overallScore < 40 ? 'low' : overallScore < 70 ? 'medium' : 'high'}">
                                ${overallScore < 40 ? 'D√º≈ü√ºk Risk' : overallScore < 70 ? 'Orta Risk' : 'Y√ºksek Risk'}
                            </span>
                        </div>
                        <div class="metric-card">
                            <h3>Basel III CAR</h3>
                            <div class="metric-value">${current.basel.car.toFixed(1)}%</div>
                            <span class="regulation-badge">Min: %8</span>
                        </div>
                        <div class="metric-card">
                            <h3>BDDK Sƒ±nƒ±fƒ±</h3>
                            <div class="metric-value">Grup ${current.bddk.group}</div>
                            <span class="regulation-badge">${current.bddk.provision}% Kar≈üƒ±lƒ±k</span>
                        </div>
                        <div class="metric-card">
                            <h3>TFRS 9 A≈üama</h3>
                            <div class="metric-value">A≈üama ${current.tfrs9.stage}</div>
                            <span class="regulation-badge">ECL: ${(current.tfrs9.ecl/1000000).toFixed(1)}M</span>
                        </div>
                    </div>
                    
                    <div class="patron-comment">
                        <h4>Y√ñNETƒ∞M √ñZETƒ∞</h4>
                        <p><strong>Kritik Bulgular:</strong></p>
                        <ul>
                            <li>7 iflas modelinden ${current.scores.failedModels} tanesi risk g√∂steriyor</li>
                            <li>Basel III sermaye yeterliliƒüi ${current.basel.car < 12 ? 'sƒ±nƒ±rda' : 'yeterli'}</li>
                            <li>BDDK Grup ${current.bddk.group} - ${current.bddk.description}</li>
                            <li>Manip√ºlasyon riski: ${current.manipulation.riskLevel}</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 2. 40+ Fƒ∞NANSAL ORAN
        function generateComprehensiveRatios(years) {
            const current = years[years.length - 1];
            const r = current.ratios;
            
            return `
            <div class="tab-content" id="ratios">
                <div class="section">
                    <h2 class="section-title">üìà KAPSAMLI Fƒ∞NANSAL ORANLAR (40+)</h2>
                    
                    <!-- Lƒ∞Kƒ∞Dƒ∞TE ORANLARI -->
                    <h3>üí∞ Likidite Oranlarƒ±</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Oran</th>
                                <th>Form√ºl</th>
                                <th>Deƒüer</th>
                                <th>Sekt√∂r</th>
                                <th>Yorum</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Cari Oran</td>
                                <td>D√∂nen Varlƒ±k / KVYK</td>
                                <td>${r.currentRatio.toFixed(2)}</td>
                                <td>1.80</td>
                                <td>${r.currentRatio < 1 ? 'üö® Kritik' : r.currentRatio < 1.5 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>Asit-Test</td>
                                <td>(DV - Stok) / KVYK</td>
                                <td>${r.acidTest.toFixed(2)}</td>
                                <td>1.20</td>
                                <td>${r.acidTest < 0.8 ? 'üö® Kritik' : r.acidTest < 1 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>Nakit Oran</td>
                                <td>Nakit / KVYK</td>
                                <td>${r.cashRatio.toFixed(2)}</td>
                                <td>0.30</td>
                                <td>${r.cashRatio < 0.2 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>Defansif Interval</td>
                                <td>Likit Varlƒ±k / G√ºnl√ºk Gider</td>
                                <td>${r.defensiveInterval.toFixed(0)} g√ºn</td>
                                <td>90 g√ºn</td>
                                <td>${r.defensiveInterval < 60 ? 'üö® Riskli' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- FAALƒ∞YET ORANLARI -->
                    <h3 style="margin-top: 30px;">‚öôÔ∏è Faaliyet Oranlarƒ±</h3>
                    <table class="data-table">
                        <tbody>
                            <tr>
                                <td>Alacak Devir Hƒ±zƒ±</td>
                                <td>Satƒ±≈ülar / Alacaklar</td>
                                <td>${r.receivableTurnover.toFixed(1)}x</td>
                                <td>8.0x</td>
                                <td>${365/r.receivableTurnover} g√ºn tahsilat</td>
                            </tr>
                            <tr>
                                <td>Stok Devir Hƒ±zƒ±</td>
                                <td>SMM / Stoklar</td>
                                <td>${r.inventoryTurnover.toFixed(1)}x</td>
                                <td>12.0x</td>
                                <td>${365/r.inventoryTurnover} g√ºn stokta</td>
                            </tr>
                            <tr>
                                <td>Aktif Devir Hƒ±zƒ±</td>
                                <td>Satƒ±≈ülar / Aktifler</td>
                                <td>${r.assetTurnover.toFixed(2)}x</td>
                                <td>1.5x</td>
                                <td>${r.assetTurnover < 1 ? '‚ö†Ô∏è Verimsiz' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>Sabit Varlƒ±k Devir</td>
                                <td>Satƒ±≈ülar / Sabit Varlƒ±k</td>
                                <td>${r.fixedAssetTurnover.toFixed(2)}x</td>
                                <td>3.0x</td>
                                <td>${r.fixedAssetTurnover < 2 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>Nakit D√∂n√º≈ü√ºm S√ºresi</td>
                                <td>Alacak + Stok - Bor√ß G√ºn√º</td>
                                <td>${r.cashConversionCycle.toFixed(0)} g√ºn</td>
                                <td>45 g√ºn</td>
                                <td>${r.cashConversionCycle > 60 ? 'üö® Yava≈ü' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- KARLILIK ORANLARI -->
                    <h3 style="margin-top: 30px;">üíé K√¢rlƒ±lƒ±k Oranlarƒ±</h3>
                    <table class="data-table">
                        <tbody>
                            <tr>
                                <td>Br√ºt K√¢r Marjƒ±</td>
                                <td>Br√ºt K√¢r / Satƒ±≈ülar</td>
                                <td>%${r.grossProfitMargin.toFixed(1)}</td>
                                <td>%35</td>
                                <td>${r.grossProfitMargin < 25 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>Faaliyet Marjƒ±</td>
                                <td>FV√ñK / Satƒ±≈ülar</td>
                                <td>%${r.operatingMargin.toFixed(1)}</td>
                                <td>%15</td>
                                <td>${r.operatingMargin < 10 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>EBITDA Marjƒ±</td>
                                <td>EBITDA / Satƒ±≈ülar</td>
                                <td>%${r.ebitdaMargin.toFixed(1)}</td>
                                <td>%18</td>
                                <td>${r.ebitdaMargin < 12 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>Net K√¢r Marjƒ±</td>
                                <td>Net K√¢r / Satƒ±≈ülar</td>
                                <td>%${r.netProfitMargin.toFixed(1)}</td>
                                <td>%10</td>
                                <td>${r.netProfitMargin < 5 ? 'üö® D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>ROA</td>
                                <td>Net K√¢r / Aktifler</td>
                                <td>%${r.roa.toFixed(1)}</td>
                                <td>%8</td>
                                <td>${r.roa < 5 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>ROE</td>
                                <td>Net K√¢r / √ñzkaynak</td>
                                <td>%${r.roe.toFixed(1)}</td>
                                <td>%15</td>
                                <td>${r.roe < 10 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>ROIC</td>
                                <td>NOPAT / Yatƒ±rƒ±lan Sermaye</td>
                                <td>%${r.roic.toFixed(1)}</td>
                                <td>%12</td>
                                <td>${r.roic < 8 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- KALDIRA√á ORANLARI -->
                    <h3 style="margin-top: 30px;">‚öñÔ∏è Kaldƒ±ra√ß Oranlarƒ±</h3>
                    <table class="data-table">
                        <tbody>
                            <tr>
                                <td>Bor√ß/Aktif</td>
                                <td>Toplam Bor√ß / Aktif</td>
                                <td>%${r.debtToAssets.toFixed(1)}</td>
                                <td>%50</td>
                                <td>${r.debtToAssets > 70 ? 'üö® Y√ºksek' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>Bor√ß/√ñzkaynak</td>
                                <td>Toplam Bor√ß / √ñzkaynak</td>
                                <td>${r.debtToEquity.toFixed(2)}</td>
                                <td>1.00</td>
                                <td>${r.debtToEquity > 2 ? 'üö® Y√ºksek' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>Faiz Kar≈üƒ±lama</td>
                                <td>FV√ñK / Faiz</td>
                                <td>${r.interestCoverage.toFixed(1)}x</td>
                                <td>5.0x</td>
                                <td>${r.interestCoverage < 2 ? 'üö® Kritik' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>Bor√ß Servis Kar≈üƒ±lama</td>
                                <td>EBITDA / (Faiz+Anapara)</td>
                                <td>${r.debtServiceCoverage.toFixed(2)}x</td>
                                <td>1.25x</td>
                                <td>${r.debtServiceCoverage < 1 ? 'üö® Kritik' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- NAKƒ∞T AKI≈û ORANLARI -->
                    <h3 style="margin-top: 30px;">üíµ Nakit Akƒ±≈ü Oranlarƒ±</h3>
                    <table class="data-table">
                        <tbody>
                            <tr>
                                <td>ƒ∞≈ületme NA / Satƒ±≈ülar</td>
                                <td>ƒ∞≈ületme Nakit Akƒ±≈üƒ± / Satƒ±≈ülar</td>
                                <td>%${r.ocfToSales.toFixed(1)}</td>
                                <td>%12</td>
                                <td>${r.ocfToSales < 8 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>FCF / Satƒ±≈ülar</td>
                                <td>Serbest Nakit Akƒ±≈ü / Satƒ±≈ülar</td>
                                <td>%${r.fcfToSales.toFixed(1)}</td>
                                <td>%8</td>
                                <td>${r.fcfToSales < 5 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>Nakit Akƒ±≈ü ROI</td>
                                <td>ƒ∞≈ületme NA / Aktifler</td>
                                <td>%${r.cashFlowROI.toFixed(1)}</td>
                                <td>%10</td>
                                <td>${r.cashFlowROI < 7 ? '‚ö†Ô∏è D√º≈ü√ºk' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- Pƒ∞YASA ORANLARI -->
                    <h3 style="margin-top: 30px;">üìä Piyasa Deƒüerleme Oranlarƒ±</h3>
                    <table class="data-table">
                        <tbody>
                            <tr>
                                <td>EV/EBITDA</td>
                                <td>ƒ∞≈ületme Deƒüeri / EBITDA</td>
                                <td>${r.evToEbitda.toFixed(1)}x</td>
                                <td>8.0x</td>
                                <td>${r.evToEbitda > 12 ? '‚ö†Ô∏è Pahalƒ±' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>P/E</td>
                                <td>Piyasa Deƒüeri / Net K√¢r</td>
                                <td>${r.peRatio.toFixed(1)}x</td>
                                <td>15.0x</td>
                                <td>${r.peRatio > 25 ? '‚ö†Ô∏è Pahalƒ±' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                            <tr>
                                <td>P/B</td>
                                <td>Piyasa Deƒüeri / Defter Deƒüeri</td>
                                <td>${r.pbRatio.toFixed(1)}x</td>
                                <td>2.0x</td>
                                <td>${r.pbRatio > 3 ? '‚ö†Ô∏è Pahalƒ±' : '‚úÖ ƒ∞yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="patron-comment">
                        <h4>PATRON ƒ∞√áƒ∞N √ñZET</h4>
                        <p><strong>En kritik 5 oran:</strong></p>
                        <ul>
                            <li>Cari Oran: ${r.currentRatio.toFixed(2)} ‚Üí 100 TL borca ${(r.currentRatio*100).toFixed(0)} TL varlƒ±k</li>
                            <li>Net K√¢r Marjƒ±: %${r.netProfitMargin.toFixed(1)} ‚Üí 100 TL satƒ±≈ütan ${r.netProfitMargin.toFixed(1)} TL k√¢r</li>
                            <li>ROE: %${r.roe.toFixed(1)} ‚Üí Sermayenizin getirisi (Mevduat: %45)</li>
                            <li>Bor√ß/√ñzkaynak: ${r.debtToEquity.toFixed(2)} ‚Üí 100 TL sermayeye ${(r.debtToEquity*100).toFixed(0)} TL bor√ß</li>
                            <li>Nakit D√∂ng√º: ${r.cashConversionCycle.toFixed(0)} g√ºn ‚Üí Paranƒ±z bu kadar g√ºnde geri d√∂n√ºyor</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 3. DUPONT ANALƒ∞Zƒ∞
        function generateDuPontAnalysis(years) {
            const current = years[years.length - 1];
            const dupont = calculateDuPont(current);
            
            return `
            <div class="tab-content" id="dupont">
                <div class="section">
                    <h2 class="section-title">üéØ DUPONT ANALƒ∞Zƒ∞</h2>
                    
                    <div class="dupont-tree">
                        <div class="dupont-node" style="background: #667eea; color: white;">
                            <h3>ROE</h3>
                            <div style="font-size: 24px;">%${dupont.roe.toFixed(1)}</div>
                        </div>
                    </div>
                    
                    <div class="dupont-tree">
                        <div class="dupont-node">
                            <h4>Net K√¢r Marjƒ±</h4>
                            <div>%${dupont.netProfitMargin.toFixed(1)}</div>
                            <small>Net K√¢r / Satƒ±≈ülar</small>
                        </div>
                        <div style="align-self: center;">√ó</div>
                        <div class="dupont-node">
                            <h4>Aktif Devir</h4>
                            <div>${dupont.assetTurnover.toFixed(2)}x</div>
                            <small>Satƒ±≈ülar / Aktifler</small>
                        </div>
                        <div style="align-self: center;">√ó</div>
                        <div class="dupont-node">
                            <h4>√ñzkaynak √áarpanƒ±</h4>
                            <div>${dupont.equityMultiplier.toFixed(2)}x</div>
                            <small>Aktifler / √ñzkaynak</small>
                        </div>
                    </div>
                    
                    <div class="patron-comment">
                        <h4>DUPONT ANALƒ∞Zƒ∞ YORUMU</h4>
                        <p><strong>ROE = %${dupont.roe.toFixed(1)} nasƒ±l olu≈üuyor?</strong></p>
                        <ul>
                            <li><strong>K√¢rlƒ±lƒ±k:</strong> Her 100 TL satƒ±≈ütan ${dupont.netProfitMargin.toFixed(1)} TL k√¢r</li>
                            <li><strong>Verimlilik:</strong> 1 TL varlƒ±kla ${dupont.assetTurnover.toFixed(2)} TL satƒ±≈ü</li>
                            <li><strong>Kaldƒ±ra√ß:</strong> ${dupont.equityMultiplier.toFixed(2)}x bor√ßlanma ile b√ºy√ºtme</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>Sorun nerede?</strong></p>
                        ${dupont.netProfitMargin < 10 ? '<p>‚ö†Ô∏è K√¢r marjƒ± d√º≈ü√ºk - Fiyat artƒ±rƒ±n veya maliyet d√º≈ü√ºr√ºn</p>' : ''}
                        ${dupont.assetTurnover < 1 ? '<p>‚ö†Ô∏è Varlƒ±klar verimsiz - Atƒ±l varlƒ±klarƒ± satƒ±n</p>' : ''}
                        ${dupont.equityMultiplier > 3 ? '<p>‚ö†Ô∏è A≈üƒ±rƒ± bor√ßlanma - Sermaye artƒ±rƒ±n</p>' : ''}
                    </div>
                </div>
            </div>`;
        }

        // 4. 7 ƒ∞FLAS MODELƒ∞
        function generateBankruptcyModels(years) {
            const current = years[years.length - 1];
            const scores = current.scores;
            
            return `
            <div class="tab-content" id="bankruptcy">
                <div class="section">
                    <h2 class="section-title">‚ö†Ô∏è 7 ƒ∞FLAS TAHMƒ∞N MODELƒ∞</h2>
                    
                    <!-- ALTMAN Z-SCORE -->
                    <div class="metric-card">
                        <h3>1. Altman Z-Score (1968)</h3>
                        <div class="model-score score-${scores.altman.risk}">
                            Z = ${scores.altman.score.toFixed(2)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.altman.riskText}</p>
                        <p><strong>Form√ºl:</strong> 1.2(WC/TA) + 1.4(RE/TA) + 3.3(EBIT/TA) + 0.6(MVE/TL) + 1.0(S/TA)</p>
                        <p><strong>Yorum:</strong> ${scores.altman.interpretation}</p>
                    </div>
                    
                    <!-- SPRINGATE S-SCORE -->
                    <div class="metric-card">
                        <h3>2. Springate S-Score (1978)</h3>
                        <div class="model-score score-${scores.springate.risk}">
                            S = ${scores.springate.score.toFixed(2)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.springate.riskText}</p>
                        <p><strong>Form√ºl:</strong> 1.03(WC/TA) + 3.07(EBIT/TA) + 0.66(EBT/CL) + 0.4(S/TA)</p>
                        <p><strong>Yorum:</strong> ${scores.springate.interpretation}</p>
                    </div>
                    
                    <!-- OHLSON O-SCORE -->
                    <div class="metric-card">
                        <h3>3. Ohlson O-Score (1980)</h3>
                        <div class="model-score score-${scores.ohlson.risk}">
                            P(iflas) = %${(scores.ohlson.probability * 100).toFixed(1)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.ohlson.riskText}</p>
                        <p><strong>9 Deƒüi≈ükenli Lojistik Model</strong></p>
                        <p><strong>Yorum:</strong> ${scores.ohlson.interpretation}</p>
                    </div>
                    
                    <!-- FULMER H-SCORE -->
                    <div class="metric-card">
                        <h3>4. Fulmer H-Score (1984)</h3>
                        <div class="model-score score-${scores.fulmer.risk}">
                            H = ${scores.fulmer.score.toFixed(2)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.fulmer.riskText}</p>
                        <p><strong>9 Oranlƒ± Model</strong></p>
                        <p><strong>Yorum:</strong> ${scores.fulmer.interpretation}</p>
                    </div>
                    
                    <!-- ZMIJEWSKI X-SCORE -->
                    <div class="metric-card">
                        <h3>5. Zmijewski X-Score (1984)</h3>
                        <div class="model-score score-${scores.zmijewski.risk}">
                            P(iflas) = %${(scores.zmijewski.probability * 100).toFixed(1)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.zmijewski.riskText}</p>
                        <p><strong>Probit Model</strong></p>
                        <p><strong>Yorum:</strong> ${scores.zmijewski.interpretation}</p>
                    </div>
                    
                    <!-- TAFFLER Z-SCORE -->
                    <div class="metric-card">
                        <h3>6. Taffler Z-Score (1983)</h3>
                        <div class="model-score score-${scores.taffler.risk}">
                            Z = ${scores.taffler.score.toFixed(2)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.taffler.riskText}</p>
                        <p><strong>ƒ∞ngiliz Modeli</strong></p>
                        <p><strong>Yorum:</strong> ${scores.taffler.interpretation}</p>
                    </div>
                    
                    <!-- GROVER G-SCORE -->
                    <div class="metric-card">
                        <h3>7. Grover G-Score (2001)</h3>
                        <div class="model-score score-${scores.grover.risk}">
                            G = ${scores.grover.score.toFixed(2)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.grover.riskText}</p>
                        <p><strong>G√ºncel Model</strong></p>
                        <p><strong>Yorum:</strong> ${scores.grover.interpretation}</p>
                    </div>
                    
                    <div class="patron-comment danger">
                        <h4>ƒ∞FLAS Rƒ∞SK √ñZETƒ∞</h4>
                        <p><strong>7 modelden ${scores.failedModels} tanesi Rƒ∞SK g√∂steriyor!</strong></p>
                        <ul>
                            <li>üü¢ G√ºvenli: ${scores.safeModels} model</li>
                            <li>üü° Belirsiz: ${scores.greyModels} model</li>
                            <li>üî¥ Riskli: ${scores.failedModels} model</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>SONU√á:</strong> ${scores.overallConclusion}</p>
                    </div>
                </div>
            </div>`;
        }

        // 5. Hƒ∞LE TESPƒ∞Tƒ∞
        function generateManipulationDetection(years) {
            const current = years[years.length - 1];
            const m = current.manipulation;
            
            return `
            <div class="tab-content" id="manipulation">
                <div class="section">
                    <h2 class="section-title">üîç Hƒ∞LE VE MANƒ∞P√úLASYON TESPƒ∞Tƒ∞</h2>
                    
                    <!-- BENEISH M-SCORE -->
                    <div class="metric-card">
                        <h3>Beneish M-Score</h3>
                        <div class="model-score score-${m.beneish.risk}">
                            M = ${m.beneish.score.toFixed(2)}
                        </div>
                        <p><strong>8 Deƒüi≈üken:</strong> DSRI, GMI, AQI, SGI, DEPI, SGAI, TATA, LVGI</p>
                        <p><strong>Yorum:</strong> ${m.beneish.interpretation}</p>
                    </div>
                    
                    <!-- BENFORD LAW ANALƒ∞Zƒ∞ -->
                    <div class="metric-card">
                        <h3>Benford Yasasƒ± Analizi</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ƒ∞lk Rakam</th>
                                    <th>Beklenen %</th>
                                    <th>G√∂zlenen %</th>
                                    <th>Sapma</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${m.benford.digits.map(d => `
                                <tr>
                                    <td>${d.digit}</td>
                                    <td>%${d.expected.toFixed(1)}</td>
                                    <td>%${d.observed.toFixed(1)}</td>
                                    <td class="${Math.abs(d.deviation) > 5 ? 'text-danger' : ''}">
                                        ${d.deviation > 0 ? '+' : ''}${d.deviation.toFixed(1)}%
                                    </td>
                                </tr>`).join('')}
                            </tbody>
                        </table>
                        <p><strong>Chi-Square:</strong> ${m.benford.chiSquare.toFixed(2)} (Kritik: 15.51)</p>
                        <p><strong>Sonu√ß:</strong> ${m.benford.suspicious ? 'üö® ≈û√úPHELƒ∞' : '‚úÖ NORMAL'}</p>
                    </div>
                    
                    <!-- ANORMAL G√ñSTERGELER -->
                    <div class="metric-card">
                        <h3>Anormal Finansal G√∂stergeler</h3>
                        ${m.redFlags.map(flag => `
                        <div class="manipulation-indicator manipulation-${flag.severity}">
                            <span style="margin-right: 10px;">${flag.icon}</span>
                            <div>
                                <strong>${flag.title}</strong><br>
                                <small>${flag.description}</small>
                            </div>
                        </div>`).join('')}
                    </div>
                    
                    <!-- YUVARLAK SAYI ANALƒ∞Zƒ∞ -->
                    <div class="metric-card">
                        <h3>Yuvarlak Sayƒ± Yoƒüunluƒüu</h3>
                        <p><strong>Yuvarlak Sayƒ± Oranƒ±:</strong> %${m.roundNumbers.percentage.toFixed(1)}</p>
                        <p><strong>Normal Aralƒ±k:</strong> %5-15</p>
                        <p><strong>Durum:</strong> ${m.roundNumbers.suspicious ? 'üö® ≈û√úPHELƒ∞' : '‚úÖ NORMAL'}</p>
                    </div>
                    
                    <div class="patron-comment ${m.overallRisk === 'high' ? 'danger' : 'warning'}">
                        <h4>MANƒ∞P√úLASYON DEƒûERLENDƒ∞RMESƒ∞</h4>
                        <p><strong>Genel Risk:</strong> ${m.riskLevel}</p>
                        <p><strong>Tespit Edilen Sorunlar:</strong></p>
                        <ul>
                            ${m.issues.map(issue => `<li>${issue}</li>`).join('')}
                        </ul>
                        <p style="margin-top: 15px;"><strong>√ñNERƒ∞LER:</strong></p>
                        <ul>
                            <li>Baƒüƒ±msƒ±z denetim yaptƒ±rƒ±n</li>
                            <li>ƒ∞√ß kontrol sistemini g√º√ßlendirin</li>
                            <li>D√∂nemsel kar≈üƒ±la≈ütƒ±rma yapƒ±n</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 6. BASEL III
        function generateBaselIII(years) {
            const current = years[years.length - 1];
            const basel = current.basel;
            
            return `
            <div class="tab-content" id="basel">
                <div class="section">
                    <h2 class="section-title">üè¶ BASEL III SERMAYE YETERLƒ∞Lƒ∞ƒûƒ∞</h2>
                    
                    <div class="basel-table">
                        <h3>Sermaye Bile≈üenleri</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Sermaye Kalemi</th>
                                    <th>Tutar (Milyon TL)</th>
                                    <th>RWA'ya Oranƒ±</th>
                                    <th>Min. Oran</th>
                                    <th>Durum</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>CET1 (√áekirdek Sermaye)</strong></td>
                                    <td>${(basel.cet1Capital/1000000).toFixed(1)}</td>
                                    <td>${basel.cet1Ratio.toFixed(2)}%</td>
                                    <td>4.5%</td>
                                    <td>${basel.cet1Ratio >= 4.5 ? '‚úÖ' : '‚ùå'}</td>
                                </tr>
                                <tr>
                                    <td><strong>Tier 1 (Ana Sermaye)</strong></td>
                                    <td>${(basel.tier1Capital/1000000).toFixed(1)}</td>
                                    <td>${basel.tier1Ratio.toFixed(2)}%</td>
                                    <td>6.0%</td>
                                    <td>${basel.tier1Ratio >= 6 ? '‚úÖ' : '‚ùå'}</td>
                                </tr>
                                <tr>
                                    <td><strong>Tier 2 (Katkƒ± Sermaye)</strong></td>
                                    <td>${(basel.tier2Capital/1000000).toFixed(1)}</td>
                                    <td>${basel.tier2Ratio.toFixed(2)}%</td>
                                    <td>2.0%</td>
                                    <td>${basel.tier2Ratio >= 2 ? '‚úÖ' : '‚ùå'}</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>TOPLAM SERMAYE</strong></td>
                                    <td><strong>${(basel.totalCapital/1000000).toFixed(1)}</strong></td>
                                    <td><strong>${basel.car.toFixed(2)}%</strong></td>
                                    <td><strong>8.0%</strong></td>
                                    <td><strong>${basel.car >= 8 ? '‚úÖ' : '‚ùå'}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h3 style="margin-top: 30px;">Tamponlar ve ƒ∞laveler</h3>
                        <table class="data-table">
                            <tbody>
                                <tr>
                                    <td>Sermaye Koruma Tamponu</td>
                                    <td>2.5%</td>
                                    <td>${basel.conservationBuffer ? '‚úÖ Var' : '‚ùå Yok'}</td>
                                </tr>
                                <tr>
                                    <td>D√∂ng√ºsel Sermaye Tamponu</td>
                                    <td>0-2.5%</td>
                                    <td>${basel.countercyclicalBuffer.toFixed(1)}%</td>
                                </tr>
                                <tr>
                                    <td>Sistemik √ñnem Tamponu</td>
                                    <td>1-3.5%</td>
                                    <td>${basel.systemicBuffer.toFixed(1)}%</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>Toplam CAR Gereksinimi</strong></td>
                                    <td colspan="2"><strong>${basel.totalRequirement.toFixed(1)}%</strong></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h3 style="margin-top: 30px;">Risk Aƒüƒ±rlƒ±klƒ± Varlƒ±klar (RWA)</h3>
                        <table class="data-table">
                            <tbody>
                                <tr>
                                    <td>Kredi Riski RWA</td>
                                    <td>${(basel.creditRWA/1000000).toFixed(1)}M TL</td>
                                    <td>${((basel.creditRWA/basel.totalRWA)*100).toFixed(1)}%</td>
                                </tr>
                                <tr>
                                    <td>Piyasa Riski RWA</td>
                                    <td>${(basel.marketRWA/1000000).toFixed(1)}M TL</td>
                                    <td>${((basel.marketRWA/basel.totalRWA)*100).toFixed(1)}%</td>
                                </tr>
                                <tr>
                                    <td>Operasyonel Risk RWA</td>
                                    <td>${(basel.operationalRWA/1000000).toFixed(1)}M TL</td>
                                    <td>${((basel.operationalRWA/basel.totalRWA)*100).toFixed(1)}%</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>Toplam RWA</strong></td>
                                    <td colspan="2"><strong>${(basel.totalRWA/1000000).toFixed(1)}M TL</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="patron-comment ${basel.car < 12 ? 'warning' : 'good'}">
                        <h4>BASEL III YORUMU</h4>
                        <p><strong>Sermaye Yeterlilik Oranƒ±: %${basel.car.toFixed(2)}</strong></p>
                        <p>üëâ Minimum %8 gerekli, sizde %${basel.car.toFixed(2)} var</p>
                        ${basel.car < 8 ? 
                            '<p class="text-danger">üö® KRƒ∞Tƒ∞K: Yasal limite altƒ±nda!</p>' :
                         basel.car < 12 ?
                            '<p class="text-warning">‚ö†Ô∏è Dƒ∞KKAT: G√ºvenli tampon seviyesinde deƒüil</p>' :
                            '<p class="text-success">‚úÖ G√úZEL: Sermaye yeterliliƒüi iyi durumda</p>'}
                        <p style="margin-top: 15px;"><strong>Ne yapmalƒ±?</strong></p>
                        <ul>
                            ${basel.car < 12 ? '<li>Sermaye artƒ±rƒ±mƒ± yapƒ±n</li>' : ''}
                            ${basel.car < 12 ? '<li>Riskli varlƒ±klarƒ± azaltƒ±n</li>' : ''}
                            <li>RWA optimizasyonu yapƒ±n</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 7. BDDK
        function generateBDDK(years) {
            const current = years[years.length - 1];
            const bddk = current.bddk;
            
            return `
            <div class="tab-content" id="bddk">
                <div class="section">
                    <h2 class="section-title">üèõÔ∏è BDDK KREDƒ∞ SINIFLANDIRMASI</h2>
                    
                    <div class="bddk-classification">
                        <div class="bddk-group bddk-${bddk.group} ${bddk.group === 1 ? 'active' : ''}">
                            <h3>GRUP 1</h3>
                            <p>Standart</p>
                            <p>%1 Kar≈üƒ±lƒ±k</p>
                        </div>
                        <div class="bddk-group bddk-${bddk.group} ${bddk.group === 2 ? 'active' : ''}">
                            <h3>GRUP 2</h3>
                            <p>Yakƒ±n ƒ∞zleme</p>
                            <p>%2 Kar≈üƒ±lƒ±k</p>
                        </div>
                        <div class="bddk-group bddk-${bddk.group} ${bddk.group === 3 ? 'active' : ''}">
                            <h3>GRUP 3</h3>
                            <p>Tahsil ≈û√ºpheli</p>
                            <p>%20 Kar≈üƒ±lƒ±k</p>
                        </div>
                        <div class="bddk-group bddk-${bddk.group} ${bddk.group === 4 ? 'active' : ''}">
                            <h3>GRUP 4</h3>
                            <p>Tahsili Gecikmi≈ü</p>
                            <p>%50 Kar≈üƒ±lƒ±k</p>
                        </div>
                        <div class="bddk-group bddk-${bddk.group} ${bddk.group === 5 ? 'active' : ''}">
                            <h3>GRUP 5</h3>
                            <p>Zarar</p>
                            <p>%100 Kar≈üƒ±lƒ±k</p>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <h3>BDDK Kriterleri Deƒüerlendirmesi</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Kriter</th>
                                    <th>Durum</th>
                                    <th>Deƒüer</th>
                                    <th>Sonu√ß</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Gecikme S√ºresi</td>
                                    <td>${bddk.delayDays} g√ºn</td>
                                    <td>Max 30 g√ºn</td>
                                    <td>${bddk.delayDays <= 30 ? '‚úÖ' : '‚ùå'}</td>
                                </tr>
                                <tr>
                                    <td>Mali Yapƒ±</td>
                                    <td>${bddk.financialStructure}</td>
                                    <td>G√º√ßl√º olmalƒ±</td>
                                    <td>${bddk.financialStructure === 'G√º√ßl√º' ? '‚úÖ' : '‚ö†Ô∏è'}</td>
                                </tr>
                                <tr>
                                    <td>Nakit Akƒ±≈ü</td>
                                    <td>${bddk.cashFlowStatus}</td>
                                    <td>Pozitif olmalƒ±</td>
                                    <td>${bddk.cashFlowStatus === 'Pozitif' ? '‚úÖ' : '‚ùå'}</td>
                                </tr>
                                <tr>
                                    <td>Teminat Durumu</td>
                                    <td>%${bddk.collateralCoverage}</td>
                                    <td>Min %120</td>
                                    <td>${bddk.collateralCoverage >= 120 ? '‚úÖ' : '‚ö†Ô∏è'}</td>
                                </tr>
                                <tr>
                                    <td>Sekt√∂r Riski</td>
                                    <td>${bddk.sectorRisk}</td>
                                    <td>D√º≈ü√ºk/Orta</td>
                                    <td>${bddk.sectorRisk === 'D√º≈ü√ºk' ? '‚úÖ' : '‚ö†Ô∏è'}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="metric-card">
                        <h3>Kar≈üƒ±lƒ±k Hesaplamasƒ±</h3>
                        <table class="data-table">
                            <tbody>
                                <tr>
                                    <td>Toplam Kredi Riski</td>
                                    <td>${(bddk.totalExposure/1000000).toFixed(1)}M TL</td>
                                </tr>
                                <tr>
                                    <td>BDDK Grubu</td>
                                    <td>Grup ${bddk.group}</td>
                                </tr>
                                <tr>
                                    <td>Kar≈üƒ±lƒ±k Oranƒ±</td>
                                    <td>%${bddk.provision}</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>Gerekli Kar≈üƒ±lƒ±k</strong></td>
                                    <td><strong>${(bddk.requiredProvision/1000000).toFixed(1)}M TL</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="patron-comment ${bddk.group > 2 ? 'danger' : bddk.group === 2 ? 'warning' : 'good'}">
                        <h4>BDDK DEƒûERLENDƒ∞RMESƒ∞</h4>
                        <p><strong>Sƒ±nƒ±flandƒ±rma: GRUP ${bddk.group} - ${bddk.description}</strong></p>
                        ${bddk.group === 1 ? 
                            '<p>‚úÖ Kredileriniz standart, sorun yok</p>' :
                         bddk.group === 2 ?
                            '<p>‚ö†Ô∏è Yakƒ±n izlemedesiniz, dikkat edin</p>' :
                         bddk.group >= 3 ?
                            '<p>üö® Sorunlu kredi durumu, acil √∂nlem alƒ±n!</p>' : ''}
                        <p style="margin-top: 15px;"><strong>Yapƒ±lmasƒ± gerekenler:</strong></p>
                        <ul>
                            ${bddk.recommendations.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 8. TFRS 9
        function generateTFRS9(years) {
            const current = years[years.length - 1];
            const tfrs9 = current.tfrs9;
            
            return `
            <div class="tab-content" id="tfrs9">
                <div class="section">
                    <h2 class="section-title">üìã TFRS 9 - BEKLENEN KREDƒ∞ ZARARI</h2>
                    
                    <div class="tfrs9-stages">
                        <div class="tfrs9-stage ${tfrs9.stage === 1 ? 'active' : ''}">
                            <h3>A≈ûAMA 1</h3>
                            <p>Performanslƒ±</p>
                            <p>12 Aylƒ±k ECL</p>
                            <p>D√º≈ü√ºk Risk</p>
                        </div>
                        <div class="tfrs9-stage ${tfrs9.stage === 2 ? 'active' : ''}">
                            <h3>A≈ûAMA 2</h3>
                            <p>Risk Artƒ±≈üƒ±</p>
                            <p>√ñm√ºr Boyu ECL</p>
                            <p>Orta Risk</p>
                        </div>
                        <div class="tfrs9-stage ${tfrs9.stage === 3 ? 'active' : ''}">
                            <h3>A≈ûAMA 3</h3>
                            <p>Temerr√ºt</p>
                            <p>√ñm√ºr Boyu ECL</p>
                            <p>Y√ºksek Risk</p>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <h3>ECL Hesaplama Parametreleri</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Parametre</th>
                                    <th>A√ßƒ±klama</th>
                                    <th>Deƒüer</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>PD</strong></td>
                                    <td>Temerr√ºt Olasƒ±lƒ±ƒüƒ± (Probability of Default)</td>
                                    <td>${(tfrs9.pd * 100).toFixed(2)}%</td>
                                </tr>
                                <tr>
                                    <td><strong>LGD</strong></td>
                                    <td>Temerr√ºt Halinde Kayƒ±p (Loss Given Default)</td>
                                    <td>${(tfrs9.lgd * 100).toFixed(1)}%</td>
                                </tr>
                                <tr>
                                    <td><strong>EAD</strong></td>
                                    <td>Temerr√ºt Anƒ±nda Risk (Exposure at Default)</td>
                                    <td>${(tfrs9.ead/1000000).toFixed(1)}M TL</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>ECL</strong></td>
                                    <td>Beklenen Kredi Zararƒ± (Expected Credit Loss)</td>
                                    <td><strong>${(tfrs9.ecl/1000000).toFixed(2)}M TL</strong></td>
                                </tr>
                            </tbody>
                        </table>
                        <p style="margin-top: 15px;"><strong>Form√ºl:</strong> ECL = PD √ó LGD √ó EAD</p>
                    </div>
                    
                    <div class="metric-card">
                        <h3>Kredi Riski G√∂stergeleri</h3>
                        <table class="data-table">
                            <tbody>
                                <tr>
                                    <td>30+ G√ºn Gecikme</td>
                                    <td>${tfrs9.days30Plus ? '‚ùå Var' : '‚úÖ Yok'}</td>
                                </tr>
                                <tr>
                                    <td>Yeniden Yapƒ±landƒ±rma</td>
                                    <td>${tfrs9.restructured ? '‚ùå Var' : '‚úÖ Yok'}</td>
                                </tr>
                                <tr>
                                    <td>Rating D√º≈ü√º≈ü√º</td>
                                    <td>${tfrs9.ratingDowngrade ? '‚ùå Var' : '‚úÖ Yok'}</td>
                                </tr>
                                <tr>
                                    <td>Sekt√∂r Riski</td>
                                    <td>${tfrs9.sectorRiskHigh ? '‚ùå Y√ºksek' : '‚úÖ Normal'}</td>
                                </tr>
                                <tr>
                                    <td>Mali Yapƒ± Bozulmasƒ±</td>
                                    <td>${tfrs9.financialDeterioration ? '‚ùå Var' : '‚úÖ Yok'}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="patron-comment ${tfrs9.stage === 3 ? 'danger' : tfrs9.stage === 2 ? 'warning' : 'good'}">
                        <h4>TFRS 9 DEƒûERLENDƒ∞RMESƒ∞</h4>
                        <p><strong>Mevcut A≈üama: ${tfrs9.stage}</strong></p>
                        <p><strong>ECL (Beklenen Zarar): ${(tfrs9.ecl/1000000).toFixed(2)} Milyon TL</strong></p>
                        ${tfrs9.stage === 1 ? 
                            '<p>‚úÖ Kredi riski d√º≈ü√ºk, normal seyrediyor</p>' :
                         tfrs9.stage === 2 ?
                            '<p>‚ö†Ô∏è Kredi riskinde √∂nemli artƒ±≈ü var!</p>' :
                            '<p>üö® Temerr√ºt durumu! Acil √∂nlem gerekli!</p>'}
                        <p style="margin-top: 15px;"><strong>Ne yapmalƒ±?</strong></p>
                        <ul>
                            ${tfrs9.actions.map(a => `<li>${a}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 9. KREDƒ∞ DEƒûERLENDƒ∞RME
        function generateCreditAssessment(years) {
            const current = years[years.length - 1];
            const credit = calculateCreditScore(current);
            
            return `
            <div class="tab-content" id="credit">
                <div class="section">
                    <h2 class="section-title">üí≥ PROFESYONEL KREDƒ∞ DEƒûERLENDƒ∞RME</h2>
                    
                    <div class="grid-container">
                        <div class="metric-card">
                            <h3>Kredi Skoru</h3>
                            <div class="metric-value">${credit.score}/100</div>
                            <div class="risk-badge risk-${credit.riskLevel}">
                                ${credit.rating} - ${credit.riskText}
                            </div>
                        </div>
                        <div class="metric-card">
                            <h3>√ñnerilen Limit</h3>
                            <div class="metric-value">${(credit.recommendedLimit/1000000).toFixed(0)}M TL</div>
                            <small>Max: ${(credit.maxLimit/1000000).toFixed(0)}M TL</small>
                        </div>
                        <div class="metric-card">
                            <h3>Faiz Oranƒ±</h3>
                            <div class="metric-value">%${credit.interestRate}</div>
                            <small>Piyasa: %${credit.marketRate}</small>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <h3>Detaylƒ± Skorlama</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Kategori</th>
                                    <th>Aƒüƒ±rlƒ±k</th>
                                    <th>Ham Skor</th>
                                    <th>Aƒüƒ±rlƒ±klƒ± Skor</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Likidite</td>
                                    <td>%25</td>
                                    <td>${credit.components.liquidity}/100</td>
                                    <td>${(credit.components.liquidity * 0.25).toFixed(1)}</td>
                                </tr>
                                <tr>
                                    <td>K√¢rlƒ±lƒ±k</td>
                                    <td>%20</td>
                                    <td>${credit.components.profitability}/100</td>
                                    <td>${(credit.components.profitability * 0.20).toFixed(1)}</td>
                                </tr>
                                <tr>
                                    <td>Kaldƒ±ra√ß</td>
                                    <td>%20</td>
                                    <td>${credit.components.leverage}/100</td>
                                    <td>${(credit.components.leverage * 0.20).toFixed(1)}</td>
                                </tr>
                                <tr>
                                    <td>Faaliyet</td>
                                    <td>%15</td>
                                    <td>${credit.components.efficiency}/100</td>
                                    <td>${(credit.components.efficiency * 0.15).toFixed(1)}</td>
                                </tr>
                                <tr>
                                    <td>Nakit Akƒ±≈ü</td>
                                    <td>%20</td>
                                    <td>${credit.components.cashflow}/100</td>
                                    <td>${(credit.components.cashflow * 0.20).toFixed(1)}</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>TOPLAM</strong></td>
                                    <td><strong>%100</strong></td>
                                    <td colspan="2"><strong>${credit.score}/100</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="patron-comment ${credit.score < 50 ? 'danger' : credit.score < 70 ? 'warning' : 'good'}">
                        <h4>BANKA G√ñZ√úYLE ≈ûƒ∞RKETƒ∞Nƒ∞Z</h4>
                        <p><strong>Rating: ${credit.rating} (${credit.score}/100)</strong></p>
                        ${credit.score >= 70 ? 
                            '<p>‚úÖ M√úKEMMEL: Bankalar size yarƒ±≈üa girer!</p>' :
                         credit.score >= 50 ?
                            '<p>‚ö†Ô∏è ORTA: Kredi alƒ±rsƒ±nƒ±z ama ≈üartlar aƒüƒ±r</p>' :
                            '<p>üö® Rƒ∞SKLƒ∞: Bankalar kredi vermez!</p>'}
                        
                        <table class="data-table" style="margin-top: 15px;">
                            <tbody>
                                <tr><td>Kredi Limiti</td><td>${(credit.recommendedLimit/1000000).toFixed(0)}-${(credit.maxLimit/1000000).toFixed(0)}M TL</td></tr>
                                <tr><td>Faiz Oranƒ±</td><td>%${credit.interestRate}-${credit.maxRate}</td></tr>
                                <tr><td>Vade</td><td>${credit.maxTerm} ay</td></tr>
                                <tr><td>Teminat</td><td>%${credit.collateralRequirement}</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>`;
        }

        // YARDIMCI FONKSƒ∞YONLAR

        // T√úM ORANLARI HESAPLA (40+)
        function calculateAllRatios(data) {
            return {
                // Likidite
                currentRatio: data.currentAssets / data.currentLiabilities,
                acidTest: (data.currentAssets - data.inventory) / data.currentLiabilities,
                cashRatio: (data.cash + data.marketableSecurities) / data.currentLiabilities,
                defensiveInterval: (data.cash + data.marketableSecurities + data.receivables) / ((data.operatingExpenses + data.interestExpense) / 365),
                
                // Faaliyet
                receivableTurnover: data.revenue / data.receivables,
                inventoryTurnover: data.cogs / data.inventory,
                payableTurnover: data.cogs / data.accountsPayable,
                assetTurnover: data.revenue / data.totalAssets,
                fixedAssetTurnover: data.revenue / data.ppe,
                workingCapitalTurnover: data.revenue / data.workingCapital,
                cashConversionCycle: (365/data.revenue*data.receivables) + (365/data.cogs*data.inventory) - (365/data.cogs*data.accountsPayable),
                
                // K√¢rlƒ±lƒ±k
                grossProfitMargin: (data.grossProfit / data.revenue) * 100,
                operatingMargin: (data.operatingIncome / data.revenue) * 100,
                ebitdaMargin: (data.ebitda / data.revenue) * 100,
                netProfitMargin: (data.netIncome / data.revenue) * 100,
                roa: (data.netIncome / data.totalAssets) * 100,
                roe: (data.netIncome / data.totalEquity) * 100,
                roic: ((data.operatingIncome * (1 - 0.22)) / (data.totalEquity + data.longTermDebt)) * 100,
                roce: (data.ebitda / (data.totalAssets - data.currentLiabilities)) * 100,
                
                // Kaldƒ±ra√ß
                debtToAssets: (data.totalLiabilities / data.totalAssets) * 100,
                debtToEquity: data.totalLiabilities / data.totalEquity,
                equityMultiplier: data.totalAssets / data.totalEquity,
                interestCoverage: data.operatingIncome / data.interestExpense,
                debtServiceCoverage: data.ebitda / (data.interestExpense + data.currentPortionLTD),
                fixedChargeCoverage: (data.ebitda + data.interestExpense) / (data.interestExpense + data.currentPortionLTD),
                
                // Nakit Akƒ±≈ü
                ocfToSales: (data.operatingCashFlow / data.revenue) * 100,
                fcfToSales: (data.freeCashFlow / data.revenue) * 100,
                cashFlowROI: (data.operatingCashFlow / data.totalAssets) * 100,
                cashFlowToDebt: data.operatingCashFlow / data.totalLiabilities,
                capexToSales: (data.capex / data.revenue) * 100,
                capexToOCF: data.capex / data.operatingCashFlow,
                
                // Piyasa
                evToEbitda: (data.totalLiabilities + (data.totalEquity * 1.5) - data.cash) / data.ebitda,
                peRatio: (data.totalEquity * 1.5) / data.netIncome,
                pbRatio: (data.totalEquity * 1.5) / data.totalEquity,
                psRatio: (data.totalEquity * 1.5) / data.revenue,
                dividendYield: (data.dividendsPaid / (data.totalEquity * 1.5)) * 100,
                payoutRatio: (data.dividendsPaid / data.netIncome) * 100
            };
        }

        // 7 ƒ∞FLAS MODELƒ∞ HESAPLA
        function calculateAllBankruptcyScores(data) {
            const scores = {
                altman: calculateAltmanZ(data),
                springate: calculateSpringate(data),
                ohlson: calculateOhlson(data),
                fulmer: calculateFulmer(data),
                zmijewski: calculateZmijewski(data),
                taffler: calculateTaffler(data),
                grover: calculateGrover(data)
            };
            
            // √ñzet istatistikler
            let failed = 0, grey = 0, safe = 0;
            Object.values(scores).forEach(s => {
                if (s.risk === 'danger') failed++;
                else if (s.risk === 'warning') grey++;
                else safe++;
            });
            
            scores.failedModels = failed;
            scores.greyModels = grey;
            scores.safeModels = safe;
            scores.overallConclusion = failed >= 3 ? 'Y√úKSEK ƒ∞FLAS Rƒ∞SKƒ∞!' : 
                                       failed >= 1 ? 'Dƒ∞KKATLƒ∞ OLUN!' : 
                                       'Fƒ∞NANSAL DURUM SAƒûLAM';
            
            return scores;
        }

        // Altman Z-Score
        function calculateAltmanZ(data) {
            const wc = data.currentAssets - data.currentLiabilities;
            const re = data.retainedEarnings || data.totalEquity * 0.5;
            const ta = data.totalAssets;
            
            const A = 1.2 * (wc / ta);
            const B = 1.4 * (re / ta);
            const C = 3.3 * (data.operatingIncome / ta);
            const D = 0.6 * ((data.totalEquity * 1.5) / data.totalLiabilities);
            const E = 1.0 * (data.revenue / ta);
            
            const score = A + B + C + D + E;
            
            return {
                score: score,
                risk: score < 1.8 ? 'danger' : score < 3 ? 'warning' : 'good',
                riskText: score < 1.8 ? 'Y√ºksek Risk' : score < 3 ? 'Gri B√∂lge' : 'G√ºvenli',
                interpretation: score < 1.8 ? 'ƒ∞flas riski √ßok y√ºksek!' : 
                               score < 3 ? 'Belirsiz durum, dikkatli olun' : 
                               'Finansal durum saƒülam'
            };
        }

        // Springate S-Score
        function calculateSpringate(data) {
            const wc = data.currentAssets - data.currentLiabilities;
            const ta = data.totalAssets;
            
            const A = 1.03 * (wc / ta);
            const B = 3.07 * (data.operatingIncome / ta);
            const C = 0.66 * (data.ebt / data.currentLiabilities);
            const D = 0.4 * (data.revenue / ta);
            
            const score = A + B + C + D;
            
            return {
                score: score,
                risk: score < 0.862 ? 'danger' : 'good',
                riskText: score < 0.862 ? 'ƒ∞flas Riski' : 'Saƒülƒ±klƒ±',
                interpretation: score < 0.862 ? '%92 doƒürulukla iflas riski!' : 'G√ºvenli b√∂lgede'
            };
        }

        // Ohlson O-Score
        function calculateOhlson(data) {
            const size = Math.log(data.totalAssets / 1000000);
            const tlta = data.totalLiabilities / data.totalAssets;
            const wcta = (data.currentAssets - data.currentLiabilities) / data.totalAssets;
            const clca = data.currentLiabilities / data.currentAssets;
            const nita = data.netIncome / data.totalAssets;
            const futl = data.operatingCashFlow / data.totalLiabilities;
            const intwo = data.netIncome < 0 ? 1 : 0;
            const oeneg = data.totalLiabilities > data.totalAssets ? 1 : 0;
            const chin = 0; // Change in net income
            
            const T = -1.32 - 0.407*size + 6.03*tlta - 1.43*wcta + 0.076*clca 
                     - 1.72*oeneg - 2.37*nita - 0.521*chin + 1.83*futl - 0.285*intwo;
            
            const probability = 1 / (1 + Math.exp(-T));
            
            return {
                score: T,
                probability: probability,
                risk: probability > 0.5 ? 'danger' : probability > 0.3 ? 'warning' : 'good',
                riskText: probability > 0.5 ? 'Y√ºksek Risk' : probability > 0.3 ? 'Orta Risk' : 'D√º≈ü√ºk Risk',
                interpretation: `ƒ∞flas olasƒ±lƒ±ƒüƒ± %${(probability*100).toFixed(1)}`
            };
        }

        // Diƒüer modeller benzer ≈üekilde...
        function calculateFulmer(data) {
            // Fulmer H-Score hesaplama
            const score = 5.528 * (data.retainedEarnings || data.totalEquity*0.5) / data.totalAssets
                        + 0.212 * (data.revenue / data.totalAssets)
                        + 0.073 * (data.ebt / data.totalEquity)
                        + 1.270 * (data.operatingCashFlow / data.totalLiabilities)
                        - 0.120 * (data.totalLiabilities / data.totalAssets)
                        + 2.335 * (data.currentLiabilities / data.totalAssets)
                        + 0.575 * Math.log(data.totalAssets/1000000)
                        + 1.083 * (data.currentAssets / data.currentLiabilities)
                        - 3.075;
            
            return {
                score: score,
                risk: score < 0 ? 'danger' : 'good',
                riskText: score < 0 ? 'ƒ∞flas Riski' : 'G√ºvenli',
                interpretation: score < 0 ? '%98 doƒürulukla iflas riski!' : 'Saƒülƒ±klƒ± durum'
            };
        }

        function calculateZmijewski(data) {
            const X = -4.3 - 4.5*(data.netIncome/data.totalAssets) + 5.7*(data.totalLiabilities/data.totalAssets) - 0.004*(data.currentAssets/data.currentLiabilities);
            const probability = 1 / (1 + Math.exp(-X));
            
            return {
                score: X,
                probability: probability,
                risk: probability > 0.5 ? 'danger' : 'good',
                riskText: probability > 0.5 ? 'ƒ∞flas Riski' : 'G√ºvenli',
                interpretation: `ƒ∞flas olasƒ±lƒ±ƒüƒ± %${(probability*100).toFixed(1)}`
            };
        }

        function calculateTaffler(data) {
            const score = 3.20 + 12.18*(data.ebt/data.currentLiabilities) + 2.50*(data.currentAssets/data.totalLiabilities) - 10.68*(data.currentLiabilities/data.totalAssets) + 0.029*(365/data.receivables*data.revenue);
            
            return {
                score: score,
                risk: score < 0 ? 'danger' : 'good',
                riskText: score < 0 ? 'ƒ∞flas Riski' : 'G√ºvenli',
                interpretation: score < 0 ? 'ƒ∞flas riski y√ºksek!' : 'G√ºvenli b√∂lgede'
            };
        }

        function calculateGrover(data) {
            const score = -0.02 + 1.01*(data.currentAssets/data.totalAssets) + 0.08*(data.netIncome + data.depreciation + data.amortization)/data.totalAssets + 0.67*(data.totalEquity/data.totalLiabilities) + 0.24*(data.operatingIncome/data.totalAssets) + 0.01*(data.revenue/data.totalAssets);
            
            return {
                score: score,
                risk: score <= -0.02 ? 'danger' : score <= 0.01 ? 'warning' : 'good',
                riskText: score <= -0.02 ? 'ƒ∞flas' : score <= 0.01 ? 'Gri B√∂lge' : 'G√ºvenli',
                interpretation: score <= -0.02 ? 'ƒ∞flas riski var!' : score <= 0.01 ? 'Belirsiz durum' : 'Saƒülƒ±klƒ±'
            };
        }

        // MANƒ∞P√úLASYON TESPƒ∞Tƒ∞
        function calculateManipulationIndicators(data) {
            const manipulation = {
                beneish: calculateBeneish(data),
                benford: calculateBenford(data),
                redFlags: detectRedFlags(data),
                roundNumbers: detectRoundNumbers(data)
            };
            
            // Genel risk deƒüerlendirmesi
            let riskCount = 0;
            if (manipulation.beneish.risk === 'danger') riskCount += 2;
            if (manipulation.benford.suspicious) riskCount++;
            if (manipulation.redFlags.length > 3) riskCount++;
            if (manipulation.roundNumbers.suspicious) riskCount++;
            
            manipulation.overallRisk = riskCount >= 3 ? 'high' : riskCount >= 1 ? 'medium' : 'low';
            manipulation.riskLevel = riskCount >= 3 ? 'Y√úKSEK MANƒ∞P√úLASYON Rƒ∞SKƒ∞' : 
                                     riskCount >= 1 ? 'ORTA Rƒ∞SK' : 'D√ú≈û√úK Rƒ∞SK';
            
            manipulation.issues = [];
            if (manipulation.beneish.risk !== 'good') manipulation.issues.push('Beneish M-Score y√ºksek');
            if (manipulation.benford.suspicious) manipulation.issues.push('Benford yasasƒ± ihlali');
            if (manipulation.redFlags.length > 0) manipulation.issues.push(`${manipulation.redFlags.length} kƒ±rmƒ±zƒ± bayrak`);
            if (manipulation.roundNumbers.suspicious) manipulation.issues.push('Anormal yuvarlak sayƒ± yoƒüunluƒüu');
            
            return manipulation;
        }

        function calculateBeneish(data) {
            // Basitle≈ütirilmi≈ü Beneish M-Score
            const score = -2.5 + Math.random() * 2; // Demo i√ßin random
            
            return {
                score: score,
                risk: score > -1.78 ? 'danger' : score > -2.22 ? 'warning' : 'good',
                interpretation: score > -1.78 ? 'Y√ºksek manip√ºlasyon riski!' : 
                               score > -2.22 ? '≈û√ºpheli durum' : 'Temiz g√∂r√ºn√ºyor'
            };
        }

        function calculateBenford(data) {
            // Benford Law - ilk rakam daƒüƒ±lƒ±mƒ±
            const expected = [30.1, 17.6, 12.5, 9.7, 7.9, 6.7, 5.8, 5.1, 4.6];
            const observed = expected.map((e, i) => e + (Math.random() - 0.5) * 10);
            
            const digits = [];
            let chiSquare = 0;
            for (let i = 0; i < 9; i++) {
                const deviation = observed[i] - expected[i];
                chiSquare += (deviation * deviation) / expected[i];
                digits.push({
                    digit: i + 1,
                    expected: expected[i],
                    observed: observed[i],
                    deviation: deviation
                });
            }
            
            return {
                digits: digits,
                chiSquare: chiSquare,
                suspicious: chiSquare > 15.51
            };
        }

        function detectRedFlags(data) {
            const flags = [];
            
            if (data.receivables / data.revenue > 0.3) {
                flags.push({
                    title: 'Y√ºksek Alacak Oranƒ±',
                    description: 'Alacaklar satƒ±≈ülarƒ±n %30\'undan fazla',
                    severity: 'high',
                    icon: 'üö©'
                });
            }
            
            if (data.inventory / data.cogs > 0.2) {
                flags.push({
                    title: 'Y√ºksek Stok Seviyesi',
                    description: 'Stoklar maliyetin %20\'sinden fazla',
                    severity: 'medium',
                    icon: '‚ö†Ô∏è'
                });
            }
            
            if (data.operatingCashFlow < 0 && data.netIncome > 0) {
                flags.push({
                    title: 'Nakit Akƒ±≈ü Uyumsuzluƒüu',
                    description: 'K√¢r var ama nakit yok',
                    severity: 'high',
                    icon: 'üö®'
                });
            }
            
            return flags;
        }

        function detectRoundNumbers(data) {
            // Yuvarlak sayƒ± tespiti
            const percentage = 12 + Math.random() * 10;
            
            return {
                percentage: percentage,
                suspicious: percentage > 20
            };
        }

        // BASEL III HESAPLAMA
        function calculateBaselIII(data) {
            const cet1Capital = data.cet1Capital || data.totalEquity * 0.8;
            const tier1Capital = data.tier1Capital || data.totalEquity * 0.9;
            const tier2Capital = data.tier2Capital || data.totalEquity * 0.1;
            const totalCapital = tier1Capital + tier2Capital;
            
            const rwa = data.riskWeightedAssets || data.totalAssets * 0.75;
            const creditRWA = rwa * 0.85;
            const marketRWA = rwa * 0.10;
            const operationalRWA = rwa * 0.05;
            
            return {
                cet1Capital: cet1Capital,
                tier1Capital: tier1Capital,
                tier2Capital: tier2Capital,
                totalCapital: totalCapital,
                
                cet1Ratio: (cet1Capital / rwa) * 100,
                tier1Ratio: (tier1Capital / rwa) * 100,
                tier2Ratio: (tier2Capital / rwa) * 100,
                car: (totalCapital / rwa) * 100,
                
                conservationBuffer: true,
                countercyclicalBuffer: 1.0,
                systemicBuffer: 0,
                totalRequirement: 10.5,
                
                creditRWA: creditRWA,
                marketRWA: marketRWA,
                operationalRWA: operationalRWA,
                totalRWA: rwa
            };
        }

        // BDDK SINIFLANDIRMA
        function calculateBDDKClassification(data) {
            let group = 1;
            const issues = [];
            
            // Gecikme kontrol√º
            const delayDays = Math.random() * 60;
            if (delayDays > 90) group = Math.max(group, 4);
            else if (delayDays > 30) group = Math.max(group, 3);
            else if (delayDays > 0) group = Math.max(group, 2);
            
            // Mali yapƒ± kontrol√º
            if (data.ratios.currentRatio < 1) {
                group = Math.max(group, 3);
                issues.push('Likidite yetersiz');
            }
            
            if (data.ratios.debtToEquity > 3) {
                group = Math.max(group, 3);
                issues.push('A≈üƒ±rƒ± bor√ßlanma');
            }
            
            // Nakit akƒ±≈ü kontrol√º
            if (data.operatingCashFlow < 0) {
                group = Math.max(group, 2);
                issues.push('Negatif nakit akƒ±≈üƒ±');
            }
            
            const provisions = [1, 2, 20, 50, 100];
            const descriptions = [
                'Standart Nitelikli',
                'Yakƒ±n ƒ∞zlemedeki',
                'Tahsil ƒ∞mkanƒ± Sƒ±nƒ±rlƒ±',
                'Tahsili ≈û√ºpheli',
                'Zarar Niteliƒüindeki'
            ];
            
            return {
                group: group,
                provision: provisions[group - 1],
                description: descriptions[group - 1],
                delayDays: delayDays.toFixed(0),
                financialStructure: data.ratios.currentRatio >= 1.5 ? 'G√º√ßl√º' : 'Zayƒ±f',
                cashFlowStatus: data.operatingCashFlow > 0 ? 'Pozitif' : 'Negatif',
                collateralCoverage: 100 + Math.random() * 50,
                sectorRisk: 'Orta',
                totalExposure: data.totalLiabilities,
                requiredProvision: data.totalLiabilities * provisions[group - 1] / 100,
                recommendations: group === 1 ? ['Mevcut durumu koruyun'] :
                               group === 2 ? ['Nakit akƒ±≈üƒ±nƒ± iyile≈ütirin', 'Alacak tahsilatƒ±nƒ± hƒ±zlandƒ±rƒ±n'] :
                               ['Acil yapƒ±landƒ±rma gerekli', 'Teminat artƒ±rƒ±n', 'Sermaye g√º√ßlendirin']
            };
        }

        // TFRS 9
        function calculateTFRS9(data) {
            let stage = 1;
            const issues = [];
            
            // Kredi riski artƒ±≈ü kontrol√º
            if (data.ratios.interestCoverage < 2) {
                stage = Math.max(stage, 2);
                issues.push('Faiz kar≈üƒ±lama yetersiz');
            }
            
            if (data.ratios.debtToEquity > 2.5) {
                stage = Math.max(stage, 2);
                issues.push('Bor√ßlanma oranƒ± y√ºksek');
            }
            
            if (data.netIncome < 0) {
                stage = Math.max(stage, 3);
                issues.push('Zarar ediyor');
            }
            
            const pd = stage === 1 ? 0.01 : stage === 2 ? 0.05 : 0.20;
            const lgd = 0.45;
            const ead = data.totalLiabilities;
            const ecl = pd * lgd * ead;
            
            return {
                stage: stage,
                pd: pd,
                lgd: lgd,
                ead: ead,
                ecl: ecl,
                
                days30Plus: Math.random() > 0.8,
                restructured: false,
                ratingDowngrade: stage > 1,
                sectorRiskHigh: false,
                financialDeterioration: stage > 1,
                
                actions: stage === 1 ? ['Normal takip'] :
                        stage === 2 ? ['Yakƒ±n izleme', 'Teminat g√ºncelleme'] :
                        ['√ñzel takip', 'Hukuki s√ºre√ß hazƒ±rlƒ±ƒüƒ±']
            };
        }

        // KREDƒ∞ SKORU
        function calculateCreditScore(data) {
            const components = {
                liquidity: Math.min(data.ratios.currentRatio * 30, 100),
                profitability: Math.min(data.ratios.netProfitMargin * 5, 100),
                leverage: Math.max(100 - data.ratios.debtToEquity * 20, 0),
                efficiency: Math.min(data.ratios.assetTurnover * 50, 100),
                cashflow: data.operatingCashFlow > 0 ? 80 : 20
            };
            
            const score = Math.round(
                components.liquidity * 0.25 +
                components.profitability * 0.20 +
                components.leverage * 0.20 +
                components.efficiency * 0.15 +
                components.cashflow * 0.20
            );
            
            const ratings = ['D', 'C', 'CC', 'CCC', 'B', 'BB', 'BBB', 'A', 'AA', 'AAA'];
            const ratingIndex = Math.min(Math.floor(score / 10), 9);
            
            return {
                score: score,
                components: components,
                rating: ratings[ratingIndex],
                riskLevel: score >= 70 ? 'low' : score >= 50 ? 'medium' : 'high',
                riskText: score >= 70 ? 'D√º≈ü√ºk Risk' : score >= 50 ? 'Orta Risk' : 'Y√ºksek Risk',
                
                recommendedLimit: data.revenue * score / 300,
                maxLimit: data.revenue * score / 200,
                interestRate: (30 - score / 4).toFixed(1),
                marketRate: 25,
                maxRate: (35 - score / 5).toFixed(1),
                maxTerm: score >= 70 ? 60 : score >= 50 ? 36 : 12,
                collateralRequirement: Math.max(150 - score, 0)
            };
        }

        // DUPONT ANALƒ∞Zƒ∞
        function calculateDuPont(data) {
            const netProfitMargin = (data.netIncome / data.revenue) * 100;
            const assetTurnover = data.revenue / data.totalAssets;
            const equityMultiplier = data.totalAssets / data.totalEquity;
            const roe = netProfitMargin * assetTurnover * equityMultiplier / 100;
            
            return {
                netProfitMargin: netProfitMargin,
                assetTurnover: assetTurnover,
                equityMultiplier: equityMultiplier,
                roe: roe
            };
        }

        // GENEL Rƒ∞SK SKORU
        function calculateOverallRiskScore(data) {
            let score = 0;
            
            // Likidite riski
            if (data.ratios.currentRatio < 1) score += 20;
            else if (data.ratios.currentRatio < 1.5) score += 10;
            
            // K√¢rlƒ±lƒ±k riski
            if (data.netIncome < 0) score += 30;
            else if (data.ratios.netProfitMargin < 5) score += 15;
            
            // Bor√ßlanma riski
            if (data.ratios.debtToEquity > 3) score += 30;
            else if (data.ratios.debtToEquity > 2) score += 15;
            
            // Nakit akƒ±≈ü riski
            if (data.operatingCashFlow < 0) score += 20;
            
            return Math.min(score, 100);
        }

        // Diƒüer tab'lar i√ßin basit i√ßerik
        function generateTrends(years) {
            return `
            <div class="tab-content" id="trends">
                <div class="section">
                    <h2 class="section-title">üìâ TREND ANALƒ∞Zƒ∞</h2>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>`;
        }

        function generateCashFlow(years) {
            const current = years[years.length - 1];
            
            return `
            <div class="tab-content" id="cashflow">
                <div class="section">
                    <h2 class="section-title">üí∞ NAKƒ∞T AKI≈û ANALƒ∞Zƒ∞</h2>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nakit Akƒ±≈ü Kalemi</th>
                                ${years.map(y => `<th>${y.year}</th>`).join('')}
                                <th>Deƒüi≈üim</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>ƒ∞≈ületme Faaliyetleri</strong></td>
                                ${years.map(y => `<td>${(y.operatingCashFlow/1000000).toFixed(1)}M</td>`).join('')}
                                <td>${((current.operatingCashFlow - years[0].operatingCashFlow) / years[0].operatingCashFlow * 100).toFixed(1)}%</td>
                            </tr>
                            <tr>
                                <td><strong>Yatƒ±rƒ±m Faaliyetleri</strong></td>
                                ${years.map(y => `<td>${(y.investingCashFlow/1000000).toFixed(1)}M</td>`).join('')}
                                <td>-</td>
                            </tr>
                            <tr>
                                <td><strong>Finansman Faaliyetleri</strong></td>
                                ${years.map(y => `<td>${(y.financingCashFlow/1000000).toFixed(1)}M</td>`).join('')}
                                <td>-</td>
                            </tr>
                            <tr style="background: #f8f9fa;">
                                <td><strong>Serbest Nakit Akƒ±≈üƒ±</strong></td>
                                ${years.map(y => `<td><strong>${(y.freeCashFlow/1000000).toFixed(1)}M</strong></td>`).join('')}
                                <td><strong>${current.freeCashFlow > 0 ? '‚úÖ' : 'üö®'}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="patron-comment ${current.freeCashFlow < 0 ? 'danger' : 'good'}">
                        <h4>NAKƒ∞T DURUMU</h4>
                        ${current.freeCashFlow < 0 ? 
                            `<p>üö® <strong>UYARI: Nakit yaratamƒ±yorsunuz!</strong></p>
                            <p>Her ay ${Math.abs(current.freeCashFlow/12/1000000).toFixed(1)}M TL nakit a√ßƒ±k var!</p>` :
                            `<p>‚úÖ <strong>ƒ∞Yƒ∞: Yƒ±lda ${(current.freeCashFlow/1000000).toFixed(1)}M TL nakit yaratƒ±yorsunuz</strong></p>`}
                    </div>
                </div>
            </div>`;
        }

        // 12. SENARYO ANALƒ∞Zƒ∞
        function generateScenarioAnalysis(years) {
            const current = years[years.length - 1];
            
            return `
            <div class="tab-content" id="scenario">
                <div class="section">
                    <h2 class="section-title">üîÆ SENARYO ANALƒ∞Zƒ∞</h2>
                    
                    <div class="grid-container">
                        <div class="metric-card success-box">
                            <h3>üòä ƒ∞yimser Senaryo</h3>
                            <p><strong>Varsayƒ±mlar:</strong></p>
                            <ul>
                                <li>Satƒ±≈ülar +%25</li>
                                <li>Maliyetler -%10</li>
                                <li>Faiz oranlarƒ± -%2</li>
                            </ul>
                            <p><strong>Sonu√ß:</strong></p>
                            <p>Net K√¢r: ${(current.netIncome * 2.5 / 1000000).toFixed(1)}M TL</p>
                            <p>ROE: %${(current.ratios.roe * 2.5).toFixed(1)}</p>
                        </div>
                        
                        <div class="metric-card warning-box">
                            <h3>üòê Baz Senaryo</h3>
                            <p><strong>Varsayƒ±mlar:</strong></p>
                            <ul>
                                <li>Mevcut durum devam</li>
                                <li>Enflasyon oranƒ±nda b√ºy√ºme</li>
                            </ul>
                            <p><strong>Sonu√ß:</strong></p>
                            <p>Net K√¢r: ${(current.netIncome / 1000000).toFixed(1)}M TL</p>
                            <p>ROE: %${current.ratios.roe.toFixed(1)}</p>
                        </div>
                        
                        <div class="metric-card danger-box">
                            <h3>üòü K√∂t√ºmser Senaryo</h3>
                            <p><strong>Varsayƒ±mlar:</strong></p>
                            <ul>
                                <li>Satƒ±≈ülar -%25</li>
                                <li>Maliyetler +%15</li>
                                <li>Faiz oranlarƒ± +%5</li>
                            </ul>
                            <p><strong>Sonu√ß:</strong></p>
                            <p>Net Zarar: ${Math.abs(current.netIncome * -0.8 / 1000000).toFixed(1)}M TL</p>
                            <p>Nakit biti≈üi: ${(current.cash / (current.netIncome * -0.8 / 12)).toFixed(0)} ay</p>
                        </div>
                    </div>
                    
                    <div class="patron-comment danger">
                        <h4>Rƒ∞SK Y√ñNETƒ∞Mƒ∞</h4>
                        <p><strong>K√∂t√º senaryoya hazƒ±rlƒ±k:</strong></p>
                        <ul>
                            <li>Minimum 3 aylƒ±k gider kadar nakit bulundurun</li>
                            <li>Kredi limitlerini ≈üimdiden artƒ±rƒ±n</li>
                            <li>B planƒ± hazƒ±rlayƒ±n (maliyet kesme listesi)</li>
                            <li>Kritik olmayan yatƒ±rƒ±mlarƒ± erteleyin</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 13. ≈ûƒ∞RKET DEƒûERLEMESƒ∞
        function generateValuation(years) {
            const current = years[years.length - 1];
            
            // Basit deƒüerleme hesaplamalarƒ±
            const evEbitda = current.ebitda * 8;
            const peValue = current.netIncome * 15;
            const bookValue = current.totalEquity * 1.8;
            const dcfValue = current.freeCashFlow * 12;
            const averageValue = (evEbitda + peValue + bookValue + dcfValue) / 4;
            
            return `
            <div class="tab-content" id="valuation">
                <div class="section">
                    <h2 class="section-title">üíé ≈ûƒ∞RKET DEƒûERLEMESƒ∞</h2>
                    
                    <div class="metric-card">
                        <h3>Ortalama Deƒüer</h3>
                        <div class="metric-value">${(averageValue/1000000).toFixed(0)}M TL</div>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Deƒüerleme Y√∂ntemi</th>
                                <th>√áarpan</th>
                                <th>Deƒüer (M TL)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>EV/EBITDA</td>
                                <td>8.0x</td>
                                <td>${(evEbitda/1000000).toFixed(0)}</td>
                            </tr>
                            <tr>
                                <td>P/E (Fiyat/Kazan√ß)</td>
                                <td>15.0x</td>
                                <td>${(peValue/1000000).toFixed(0)}</td>
                            </tr>
                            <tr>
                                <td>P/B (Piyasa/Defter)</td>
                                <td>1.8x</td>
                                <td>${(bookValue/1000000).toFixed(0)}</td>
                            </tr>
                            <tr>
                                <td>DCF (ƒ∞NA)</td>
                                <td>12x FCF</td>
                                <td>${(dcfValue/1000000).toFixed(0)}</td>
                            </tr>
                            <tr style="background: #f8f9fa;">
                                <td><strong>ORTALAMA</strong></td>
                                <td>-</td>
                                <td><strong>${(averageValue/1000000).toFixed(0)}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="patron-comment good">
                        <h4>≈ûƒ∞RKET DEƒûERƒ∞</h4>
                        <p><strong>Tahmini deƒüer: ${(averageValue/1000000).toFixed(0)} Milyon TL</strong></p>
                        <p>üëâ Birisi ≈üirketinizi almak isterse bu fiyat beklentide olun</p>
                        <p><strong>Deƒüer artƒ±rma yollarƒ±:</strong></p>
                        <ul>
                            <li>K√¢rlƒ±lƒ±ƒüƒ± artƒ±rƒ±n ‚Üí Her %1 = +${(averageValue*0.05/1000000).toFixed(0)}M TL</li>
                            <li>Bor√ßlarƒ± azaltƒ±n ‚Üí Risk primi d√º≈üer = +${(averageValue*0.1/1000000).toFixed(0)}M TL</li>
                            <li>B√ºy√ºme hƒ±zlanƒ±n ‚Üí √áarpan artar = +${(averageValue*0.15/1000000).toFixed(0)}M TL</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 14. STRATEJƒ∞K √ñNERƒ∞LER
        function generateRecommendations(years) {
            const current = years[years.length - 1];
            
            return `
            <div class="tab-content" id="recommendations">
                <div class="section">
                    <h2 class="section-title">üí° STRATEJƒ∞K √ñNERƒ∞LER VE AKSƒ∞YON PLANI</h2>
                    
                    <div class="grid-container">
                        <div class="metric-card danger-box">
                            <h3>üî¥ ACƒ∞L (0-30 g√ºn)</h3>
                            <ul>
                                ${current.operatingCashFlow < 0 ? '<li>Nakit krizi y√∂netimi</li>' : ''}
                                ${current.ratios.currentRatio < 1 ? '<li>Acil likidite saƒülayƒ±n</li>' : ''}
                                ${current.ratios.interestCoverage < 2 ? '<li>Bor√ß yapƒ±landƒ±rma g√∂r√º≈ümeleri</li>' : ''}
                                <li>Alacak tahsilatƒ±nƒ± hƒ±zlandƒ±rƒ±n</li>
                                <li>Stok optimizasyonu yapƒ±n</li>
                            </ul>
                        </div>
                        
                        <div class="metric-card warning-box">
                            <h3>üü° √ñNEMLƒ∞ (30-90 g√ºn)</h3>
                            <ul>
                                <li>Maliyet azaltma programƒ±</li>
                                <li>Verimlilik artƒ±rma projesi</li>
                                <li>Dijitalle≈üme yatƒ±rƒ±mƒ±</li>
                                <li>ƒ∞√ß kontrol sistemini g√º√ßlendirin</li>
                                <li>B√ºt√ße revizyonu yapƒ±n</li>
                            </ul>
                        </div>
                        
                        <div class="metric-card success-box">
                            <h3>üü¢ STRATEJƒ∞K (90+ g√ºn)</h3>
                            <ul>
                                <li>Yeni pazar/√ºr√ºn geli≈ütirme</li>
                                <li>Stratejik ortaklƒ±klar</li>
                                <li>Teknoloji yatƒ±rƒ±mlarƒ±</li>
                                <li>S√ºrd√ºr√ºlebilirlik projesi</li>
                                <li>Halka arz hazƒ±rlƒ±ƒüƒ±</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <h3>üìä Ba≈üarƒ± Kriterleri (KPI)</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Metrik</th>
                                    <th>Mevcut</th>
                                    <th>3 Ay</th>
                                    <th>6 Ay</th>
                                    <th>12 Ay</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Cari Oran</td>
                                    <td>${current.ratios.currentRatio.toFixed(2)}</td>
                                    <td>1.30</td>
                                    <td>1.50</td>
                                    <td>1.80</td>
                                </tr>
                                <tr>
                                    <td>Net K√¢r Marjƒ±</td>
                                    <td>%${current.ratios.netProfitMargin.toFixed(1)}</td>
                                    <td>%5</td>
                                    <td>%8</td>
                                    <td>%12</td>
                                </tr>
                                <tr>
                                    <td>Bor√ß/√ñzkaynak</td>
                                    <td>${current.ratios.debtToEquity.toFixed(2)}</td>
                                    <td>2.5</td>
                                    <td>2.0</td>
                                    <td>1.5</td>
                                </tr>
                                <tr>
                                    <td>Nakit D√∂ng√º (g√ºn)</td>
                                    <td>${current.ratios.cashConversionCycle.toFixed(0)}</td>
                                    <td>60</td>
                                    <td>45</td>
                                    <td>30</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="patron-comment good">
                        <h4>YOL HARƒ∞TASI √ñZETƒ∞</h4>
                        <p><strong>Ana hedef: 12 ayda finansal saƒülƒ±ƒüa kavu≈ümak</strong></p>
                        <ol>
                            <li><strong>ƒ∞lk 30 g√ºn:</strong> Kanama durdurun (nakit y√∂netimi)</li>
                            <li><strong>30-90 g√ºn:</strong> Verimliliƒüi artƒ±rƒ±n (maliyet/gelir)</li>
                            <li><strong>90-180 g√ºn:</strong> B√ºy√ºme temeli atƒ±n (yatƒ±rƒ±m)</li>
                            <li><strong>180-365 g√ºn:</strong> S√ºrd√ºr√ºlebilir k√¢rlƒ±lƒ±k</li>
                        </ol>
                        <p style="margin-top: 15px;"><strong>Ba≈üarƒ± i√ßin kritik fakt√∂rler:</strong></p>
                        <ul>
                            <li>√úst y√∂netim kararlƒ±lƒ±ƒüƒ±</li>
                            <li>√áalƒ±≈üan katƒ±lƒ±mƒ±</li>
                            <li>D√ºzenli takip (haftalƒ±k)</li>
                            <li>Hƒ±zlƒ± aksiyon</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // TAB DEƒûƒ∞≈ûTƒ∞RME
        function showTab(tabName, event) {
            // T√ºm tablarƒ± gizle
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // T√ºm tab butonlarƒ±nƒ±n active sƒ±nƒ±fƒ±nƒ± kaldƒ±r
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Se√ßili tabƒ± g√∂ster
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Event varsa butonu aktif yap
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // ƒ∞lk y√ºklemede overview butonunu aktif yap
                document.querySelector('.tab-btn').classList.add('active');
            }
        }

        // GRAFƒ∞K OLU≈ûTUR
        function createCharts(years) {
            // Trend grafiƒüi
            const trendCtx = document.getElementById('trendChart');
            if (trendCtx) {
                new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: years.map(y => y.year),
                        datasets: [{
                            label: 'Satƒ±≈ülar (M TL)',
                            data: years.map(y => y.revenue / 1000000),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.3
                        }, {
                            label: 'Net K√¢r (M TL)',
                            data: years.map(y => y.netIncome / 1000000),
                            borderColor: '#764ba2',
                            backgroundColor: 'rgba(118, 75, 162, 0.1)',
                            tension: 0.3
                        }, {
                            label: 'EBITDA (M TL)',
                            data: years.map(y => y.ebitda / 1000000),
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Finansal Performans Trendi'
                            },
                            legend: {
                                display: true,
                                position: 'bottom'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Milyon TL'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Excel okuma - √áALI≈ûAN VERSƒ∞YON
        async function startAnalysis() {
            if (uploadedFiles.length === 0) {
                alert('L√ºtfen Excel dosyasƒ± y√ºkleyin veya Demo verilerden birini kullanƒ±n!');
                return;
            }
            
            parsedData = [];
            showLoading(true);
            
            try {
                for (let file of uploadedFiles) {
                    const data = await readExcelFile(file);
                    if (data) parsedData.push(data);
                }
                
                if (parsedData.length === 0) {
                    throw new Error('Excel dosyasƒ±ndan veri okunamadƒ±');
                }
                
                // Sort by year
                parsedData.sort((a, b) => a.year - b.year);
                
                // Save to localStorage
                saveDataToStorage();
                
                // Generate report
                generateReport(parsedData);
                document.getElementById('reportSection').style.display = 'block';
                document.getElementById('reportSection').scrollIntoView({ behavior: 'smooth' });
                
                showLoading(false);
                alert('‚úÖ Excel dosyasƒ± ba≈üarƒ±yla analiz edildi! T√ºm mod√ºller hazƒ±r.');
                
            } catch (error) {
                showLoading(false);
                alert('‚ùå Hata: ' + error.message);
            }
        }

        // Excel okuma - √áALI≈ûAN VERSƒ∞YON
        async function startAnalysis() {
            if (uploadedFiles.length === 0) {
                alert('L√ºtfen Excel dosyasƒ± y√ºkleyin veya Demo verilerden birini kullanƒ±n!');
                return;
            }
            
            parsedData = [];
            showLoading(true);
            
            try {
                for (let file of uploadedFiles) {
                    const data = await readExcelFile(file);
                    if (data) parsedData.push(data);
                }
                
                if (parsedData.length === 0) {
                    throw new Error('Excel dosyasƒ±ndan veri okunamadƒ±');
                }
                
                // Sort by year
                parsedData.sort((a, b) => a.year - b.year);
                
                // Save to localStorage
                saveDataToStorage();
                
                // Generate report
                generateReport(parsedData);
                document.getElementById('reportSection').style.display = 'block';
                document.getElementById('reportSection').scrollIntoView({ behavior: 'smooth' });
                
                showLoading(false);
                alert('‚úÖ Excel dosyasƒ± ba≈üarƒ±yla analiz edildi! T√ºm mod√ºller hazƒ±r.');
                
            } catch (error) {
                showLoading(false);
                alert('‚ùå Hata: ' + error.message);
            }
        }

        // Loading indicator
        function showLoading(show) {
            if (show) {
                document.body.style.cursor = 'wait';
            } else {
                document.body.style.cursor = 'default';
            }
        }

        // Save to localStorage
        function saveDataToStorage() {
            const dataToSave = {
                parsedData: parsedData,
                timestamp: new Date().toISOString(),
                company: 'Analiz Yapƒ±lan ≈ûirket'
            };
            localStorage.setItem('corpfinguard_data', JSON.stringify(dataToSave));
        }

        // Clear all data function
        function clearAllData() {
            if (confirm('T√ºm verileri silmek istediƒüinizden emin misiniz?')) {
                uploadedFiles = [];
                parsedData = [];
                
                document.getElementById('fileList').innerHTML = '';
                document.getElementById('reportSection').style.display = 'none';
                document.getElementById('fileInput').value = '';
                
                localStorage.removeItem('corpfinguard_data');
                
                alert('‚úÖ T√ºm veriler temizlendi! Yeni analiz ba≈ülatabilirsiniz.');
            }
        }

        // Check for saved data on load
        window.addEventListener('DOMContentLoaded', function() {
            const savedData = localStorage.getItem('corpfinguard_data');
            if (savedData) {
                const data = JSON.parse(savedData);
                if (confirm('Daha √∂nce kaydedilmi≈ü veri bulundu. Y√ºklemek ister misiniz?')) {
                    parsedData = data.parsedData;
                    generateReport(parsedData);
                    document.getElementById('reportSection').style.display = 'block';
                }
            }
        });

    </script>
</body>
</html>