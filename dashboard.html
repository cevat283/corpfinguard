<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CorpFinGuard ULTRA - Professional Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header .badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            margin: 5px;
            font-size: 12px;
        }

        .upload-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            text-align: center;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            background: #f0f4ff;
            border-color: #764ba2;
        }

        #fileInput {
            display: none;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            padding: 0;
            gap: 0;
            overflow-x: auto;
            border-bottom: 2px solid #dee2e6;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 14px;
            color: #495057;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
        }

        .tab-btn:hover {
            background: #e9ecef;
        }

        .tab-btn.active {
            color: #667eea;
            background: white;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            color: #2c3e50;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .data-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-size: 14px;
        }

        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .risk-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            margin: 5px;
        }

        .risk-low { background: #d4edda; color: #155724; }
        .risk-medium { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }
        .risk-critical { background: #721c24; color: white; }

        .info-box {
            background: #e7f1ff;
            border-left: 5px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .danger-box {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .patron-comment {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .patron-comment::before {
            content: "ğŸ’¡ PATRON Ä°Ã‡Ä°N Ã–ZET";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #ffc107;
            color: #000;
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .patron-comment.good {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
        }

        .patron-comment.danger {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-color: #dc3545;
        }

        .action-box {
            background: rgba(255,255,255,0.7);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .model-score {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            margin: 10px;
            font-size: 18px;
        }

        .score-good { background: #d4edda; color: #155724; }
        .score-warning { background: #fff3cd; color: #856404; }
        .score-danger { background: #f8d7da; color: #721c24; }

        .regulation-badge {
            display: inline-block;
            background: #6c757d;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-left: 5px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
        }

        .dupont-tree {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .dupont-node {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .manipulation-indicator {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .manipulation-high { background: #f8d7da; }
        .manipulation-medium { background: #fff3cd; }
        .manipulation-low { background: #d4edda; }

        .basel-table {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .bddk-classification {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .bddk-group {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            flex: 1;
            margin: 0 10px;
        }

        .bddk-1 { background: #d4edda; }
        .bddk-2 { background: #cfe2ff; }
        .bddk-3 { background: #fff3cd; }
        .bddk-4 { background: #f8d7da; }
        .bddk-5 { background: #721c24; color: white; }

        .tfrs9-stages {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .tfrs9-stage {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        @media print {
            .tabs, .upload-section { display: none; }
            .tab-content { display: block !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›¡ï¸ CorpFinGuard ULTRA</h1>
            <p>Kurumsal Finansal Risk Analiz ve Erken UyarÄ± Sistemi</p>
            <div>
                <span class="badge">Basel III</span>
                <span class="badge">BDDK</span>
                <span class="badge">TFRS 9</span>
                <span class="badge">7 Ä°flas Modeli</span>
                <span class="badge">Benford Law</span>
                <span class="badge">DuPont</span>
                <span class="badge">40+ Oran</span>
            </div>
        </div>
 <!-- Ã‡Ä±kÄ±ÅŸ Butonu -->
    <div style="position: absolute; top: 20px; right: 20px;">
    <button onclick="logout()" style="background: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; box-shadow: 0 2px 8px rgba(220,53,69,0.3);">
        ğŸšª Ã‡Ä±kÄ±ÅŸ
    </button>
</div>
       <div class="upload-section">
   !-- Beta Ãœye Bildirimi -->
    <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 30px;">
        <h3 style="margin: 0 0 10px 0;">âœ… Beta ÃœyeliÄŸiniz Aktif</h3>
        <p style="margin: 0; opacity: 0.9;">SÄ±nÄ±rsÄ±z analiz yapabilir, Excel dosyalarÄ±nÄ±zÄ± yÃ¼kleyebilirsiniz</p>
    </div>

    <!-- Excel Upload - AÃ‡IK! -->
    <div class="upload-area" id="uploadArea">
        <h2>ğŸ“Š Mizan DosyalarÄ±nÄ± YÃ¼kleyin</h2>
        <p>Excel dosyalarÄ±nÄ±zÄ± buraya sÃ¼rÃ¼kleyin veya tÄ±klayÄ±n</p>
        <small>En az 2 yÄ±l, ideal 3-4 yÄ±l mizan verisi yÃ¼kleyin</small>
        <input type="file" id="fileInput" multiple accept=".xlsx,.xls">
    </div>
    <div id="fileList"></div>
    <button class="analyze-btn" onclick="startAnalysis()">ğŸš€ Analizi BaÅŸlat</button>
    <button class="analyze-btn" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);" onclick="startDemoAnalysis()">ğŸ­ Demo Veriyle Test Et</button>
    <button class="analyze-btn" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);" onclick="clearAllData()">ğŸ—‘ï¸ Verileri Temizle</button>
           <div id="reportSection" style="display: none;">
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('overview', event)">ğŸ“Š Ã–zet</button>
                <button class="tab-btn" onclick="showTab('ratios', event)">ğŸ“ˆ 40+ Oran</button>
                <button class="tab-btn" onclick="showTab('dupont', event)">ğŸ¯ DuPont</button>
                <button class="tab-btn" onclick="showTab('bankruptcy', event)">âš ï¸ 7 Ä°flas Modeli</button>
                <button class="tab-btn" onclick="showTab('manipulation', event)">ğŸ” Hile Tespiti</button>
                <button class="tab-btn" onclick="showTab('basel', event)">ğŸ¦ Basel III</button>
                <button class="tab-btn" onclick="showTab('bddk', event)">ğŸ›ï¸ BDDK</button>
                <button class="tab-btn" onclick="showTab('tfrs9', event)">ğŸ“‹ TFRS 9</button>
                <button class="tab-btn" onclick="showTab('credit', event)">ğŸ’³ Kredi</button>
                <button class="tab-btn" onclick="showTab('trends', event)">ğŸ“‰ Trendler</button>
                <button class="tab-btn" onclick="showTab('cashflow', event)">ğŸ’° Nakit</button>
                <button class="tab-btn" onclick="showTab('scenario', event)">ğŸ”® Senaryo</button>
                <button class="tab-btn" onclick="showTab('valuation', event)">ğŸ’ DeÄŸerleme</button>
                <button class="tab-btn" onclick="showTab('recommendations', event)">ğŸ’¡ Ã–neriler</button>
            </div>

            <div id="tabContents"></div>
        </div>
    </div>

    <script>
        // Global deÄŸiÅŸkenler
        let uploadedFiles = [];
        let parsedData = [];

        // Dosya yÃ¼kleme
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.background = '#f0f4ff';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.background = 'white';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.background = 'white';
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            uploadedFiles = Array.from(files);
            displayFileList();
        }

        function displayFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '<h3>YÃ¼klenen Dosyalar:</h3>' +
                uploadedFiles.map(file => `<p>âœ“ ${file.name}</p>`).join('');
        }

        // Excel okuma - Ã‡ALIÅAN VERSÄ°YON
        async function startAnalysis() {
            if (uploadedFiles.length === 0) {
                alert('LÃ¼tfen Excel dosyasÄ± yÃ¼kleyin veya Demo verilerden birini kullanÄ±n!');
                return;
            }
            
            parsedData = [];
            showLoading(true);
            
            try {
                for (let file of uploadedFiles) {
                    const data = await readExcelFile(file);
                    if (data) parsedData.push(data);
                }
                
                if (parsedData.length === 0) {
                    throw new Error('Excel dosyasÄ±ndan veri okunamadÄ±');
                }
                
                // Sort by year
                parsedData.sort((a, b) => a.year - b.year);
                
                // Save to localStorage
                saveDataToStorage();
                
                // Generate report
                generateReport(parsedData);
                document.getElementById('reportSection').style.display = 'block';
                document.getElementById('reportSection').scrollIntoView({ behavior: 'smooth' });
                
                showLoading(false);
                alert('âœ… Excel dosyasÄ± baÅŸarÄ±yla analiz edildi! TÃ¼m modÃ¼ller hazÄ±r.');
                
            } catch (error) {
                showLoading(false);
                alert('âŒ Hata: ' + error.message);
            }
        }

        // DEMO VERÄ° OLUÅTUR
        function generateDemoData() {
            return [
                {
                    year: 2021,
                    // BilanÃ§o
                    cash: 12500000,
                    marketableSecurities: 3000000,
                    receivables: 28000000,
                    inventory: 19000000,
                    prepaidExpenses: 2000000,
                    otherCurrentAssets: 1500000,
                    currentAssets: 66000000,
                    
                    ppe: 45000000,
                    intangibles: 5000000,
                    investments: 8000000,
                    otherNonCurrentAssets: 3000000,
                    nonCurrentAssets: 61000000,
                    totalAssets: 127000000,
                    
                    accountsPayable: 18000000,
                    shortTermDebt: 15000000,
                    currentPortionLTD: 5000000,
                    accruedExpenses: 4000000,
                    otherCurrentLiabilities: 2000000,
                    currentLiabilities: 44000000,
                    
                    longTermDebt: 32000000,
                    deferredTaxes: 3000000,
                    otherNonCurrentLiabilities: 2000000,
                    nonCurrentLiabilities: 37000000,
                    totalLiabilities: 81000000,
                    
                    commonStock: 20000000,
                    retainedEarnings: 24000000,
                    otherEquity: 2000000,
                    totalEquity: 46000000,
                    
                    // Gelir Tablosu
                    revenue: 145000000,
                    cogs: 94250000,
                    grossProfit: 50750000,
                    
                    salesExpenses: 14500000,
                    adminExpenses: 10150000,
                    rdExpenses: 2900000,
                    operatingExpenses: 27550000,
                    operatingIncome: 23200000,
                    
                    depreciation: 4500000,
                    amortization: 500000,
                    ebitda: 28200000,
                    
                    interestExpense: 5200000,
                    otherIncome: 1000000,
                    ebt: 19000000,
                    
                    taxExpense: 4180000,
                    netIncome: 14820000,
                    
                    // Nakit AkÄ±m
                    operatingCashFlow: 18500000,
                    investingCashFlow: -8000000,
                    financingCashFlow: -5000000,
                    freeCashFlow: 10500000,
                    
                    // DiÄŸer
                    sharesOutstanding: 10000000,
                    dividendsPaid: 4000000,
                    capex: 7000000,
                    workingCapital: 22000000,
                    
                    // Risk AÄŸÄ±rlÄ±klÄ± VarlÄ±klar (Basel III)
                    riskWeightedAssets: 95000000,
                    tier1Capital: 38000000,
                    tier2Capital: 8000000,
                    cet1Capital: 35000000
                },
                {
                    year: 2022,
                    cash: 9800000,
                    marketableSecurities: 2500000,
                    receivables: 34000000,
                    inventory: 24000000,
                    prepaidExpenses: 2500000,
                    otherCurrentAssets: 1700000,
                    currentAssets: 74500000,
                    
                    ppe: 52000000,
                    intangibles: 5500000,
                    investments: 9000000,
                    otherNonCurrentAssets: 3500000,
                    nonCurrentAssets: 70000000,
                    totalAssets: 144500000,
                    
                    accountsPayable: 22000000,
                    shortTermDebt: 20000000,
                    currentPortionLTD: 6000000,
                    accruedExpenses: 5000000,
                    otherCurrentLiabilities: 2500000,
                    currentLiabilities: 55500000,
                    
                    longTermDebt: 38000000,
                    deferredTaxes: 3500000,
                    otherNonCurrentLiabilities: 2500000,
                    nonCurrentLiabilities: 44000000,
                    totalLiabilities: 99500000,
                    
                    commonStock: 20000000,
                    retainedEarnings: 23000000,
                    otherEquity: 2000000,
                    totalEquity: 45000000,
                    
                    revenue: 162000000,
                    cogs: 108540000,
                    grossProfit: 53460000,
                    
                    salesExpenses: 17820000,
                    adminExpenses: 11340000,
                    rdExpenses: 3240000,
                    operatingExpenses: 32400000,
                    operatingIncome: 21060000,
                    
                    depreciation: 5200000,
                    amortization: 600000,
                    ebitda: 26860000,
                    
                    interestExpense: 6800000,
                    otherIncome: 800000,
                    ebt: 15060000,
                    
                    taxExpense: 3313000,
                    netIncome: 11747000,
                    
                    operatingCashFlow: 15200000,
                    investingCashFlow: -12000000,
                    financingCashFlow: -2000000,
                    freeCashFlow: 3200000,
                    
                    sharesOutstanding: 10000000,
                    dividendsPaid: 3500000,
                    capex: 9000000,
                    workingCapital: 19000000,
                    
                    riskWeightedAssets: 108000000,
                    tier1Capital: 36000000,
                    tier2Capital: 9000000,
                    cet1Capital: 33000000
                },
                {
                    year: 2023,
                    cash: 6200000,
                    marketableSecurities: 1800000,
                    receivables: 42000000,
                    inventory: 31000000,
                    prepaidExpenses: 3000000,
                    otherCurrentAssets: 2000000,
                    currentAssets: 86000000,
                    
                    ppe: 58000000,
                    intangibles: 6000000,
                    investments: 10000000,
                    otherNonCurrentAssets: 4000000,
                    nonCurrentAssets: 78000000,
                    totalAssets: 164000000,
                    
                    accountsPayable: 28000000,
                    shortTermDebt: 28000000,
                    currentPortionLTD: 8000000,
                    accruedExpenses: 6000000,
                    otherCurrentLiabilities: 3000000,
                    currentLiabilities: 73000000,
                    
                    longTermDebt: 45000000,
                    deferredTaxes: 4000000,
                    otherNonCurrentLiabilities: 3000000,
                    nonCurrentLiabilities: 52000000,
                    totalLiabilities: 125000000,
                    
                    commonStock: 20000000,
                    retainedEarnings: 17000000,
                    otherEquity: 2000000,
                    totalEquity: 39000000,
                    
                    revenue: 168000000,
                    cogs: 117600000,
                    grossProfit: 50400000,
                    
                    salesExpenses: 20160000,
                    adminExpenses: 13440000,
                    rdExpenses: 3360000,
                    operatingExpenses: 36960000,
                    operatingIncome: 13440000,
                    
                    depreciation: 6000000,
                    amortization: 700000,
                    ebitda: 20140000,
                    
                    interestExpense: 9200000,
                    otherIncome: 500000,
                    ebt: 4740000,
                    
                    taxExpense: 1043000,
                    netIncome: 3697000,
                    
                    operatingCashFlow: 8500000,
                    investingCashFlow: -15000000,
                    financingCashFlow: 3000000,
                    freeCashFlow: -6500000,
                    
                    sharesOutstanding: 10000000,
                    dividendsPaid: 1000000,
                    capex: 12000000,
                    workingCapital: 13000000,
                    
                    riskWeightedAssets: 123000000,
                    tier1Capital: 31000000,
                    tier2Capital: 8000000,
                    cet1Capital: 28000000
                }
            ];
        }

        // DEMO ANALÄ°Z FONKSÄ°YONU
        function startDemoAnalysis() {
            const demoData = generateDemoData();
            parsedData = demoData;
            generateReport(parsedData);
            document.getElementById('reportSection').style.display = 'block';
            
            setTimeout(() => {
                alert('ğŸ“Š DEMO VERÄ°LERLE TEST EDÄ°YORSUNUZ!\n\n' + 
                      'âœ… 40+ Finansal Oran\n' +
                      'âœ… 7 Ä°flas Modeli (Altman, Springate, Ohlson...)\n' +
                      'âœ… Basel III, BDDK, TFRS 9 Analizleri\n' +
                      'âœ… Benford Law ile Hile Tespiti\n' +
                      'âœ… DuPont Analizi\n\n' +
                      'TÃ¼m modÃ¼lleri inceleyebilirsiniz!');
            }, 500);
        }

        // EXCEL ANALÄ°Z FONKSÄ°YONU - GERÃ‡EK MÄ°ZAN Ä°Ã‡Ä°N
        async function startAnalysis() {
            if (uploadedFiles.length === 0) {
                alert('LÃ¼tfen en az 2 yÄ±llÄ±k mizan dosyasÄ± yÃ¼kleyin!');
                return;
            }
            
            parsedData = [];
            
            try {
                for (let file of uploadedFiles) {
                    const data = await readExcelFile(file);
                    parsedData.push(data);
                }
                
                // YÄ±llarÄ± kronolojik sÄ±rala
                parsedData.sort((a, b) => a.year - b.year);
                
                if (parsedData.length < 2) {
                    alert('En az 2 yÄ±llÄ±k veri gerekli!');
                    return;
                }
                
                generateReport(parsedData);
                document.getElementById('reportSection').style.display = 'block';
                document.getElementById('reportSection').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                alert('Dosya okuma hatasÄ±: ' + error.message);
            }
        }

        // EXCEL OKUMA FONKSÄ°YONU
        function readExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                        
                        // Dosya adÄ±ndan yÄ±l Ã§Ä±kar
                        const year = extractYear(file.name) || new Date().getFullYear();
                        
                        // Mizan verilerini parse et
                        const financialData = parseMizanData(jsonData, year);
                        resolve(financialData);
                        
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.readAsArrayBuffer(file);
            });
        }

        // DOSYA ADINDAN YIL Ã‡IKAR
        function extractYear(filename) {
            const match = filename.match(/20\d{2}/);
            return match ? parseInt(match[0]) : null;
        }

        // MÄ°ZAN VERÄ°LERÄ°NÄ° PARSE ET - ALT HESAP DESTEÄÄ°
        function parseMizanData(data, year) {
            const accounts = {};
            
            // Parse each row
            data.forEach((row, index) => {
                if (!row || row.length < 3) return;
                
                let accountCode = null;
                let balance = 0;
                
                // Try different column formats
                if (typeof row[0] === 'string' && row[0].match(/^\d{3}/)) {
                    // Format: "102.01.01 - GARANTÄ° BANKASI"
                    accountCode = parseInt(row[0].substring(0, 3));
                    balance = parseFloat(row[row.length - 1]) || parseFloat(row[row.length - 2]) || 0;
                } else if (typeof row[0] === 'number') {
                    // Format: 102 as number
                    accountCode = row[0];
                    balance = parseFloat(row[row.length - 1]) || parseFloat(row[row.length - 2]) || 0;
                }
                
                if (accountCode && accountCode >= 100 && accountCode < 999) {
                    if (!accounts[accountCode]) accounts[accountCode] = 0;
                    accounts[accountCode] += Math.abs(balance);
                }
            });
            const result = {
                year: year,
                // BilanÃ§o kalemleri - baÅŸlangÄ±Ã§ deÄŸerleri
                cash: 0,
                marketableSecurities: 0,
                receivables: 0,
                inventory: 0,
                prepaidExpenses: 0,
                otherCurrentAssets: 0,
                currentAssets: 0,
                ppe: 0,
                intangibles: 0,
                investments: 0,
                otherNonCurrentAssets: 0,
                nonCurrentAssets: 0,
                totalAssets: 0,
                accountsPayable: 0,
                shortTermDebt: 0,
                currentPortionLTD: 0,
                accruedExpenses: 0,
                otherCurrentLiabilities: 0,
                currentLiabilities: 0,
                longTermDebt: 0,
                deferredTaxes: 0,
                otherNonCurrentLiabilities: 0,
                nonCurrentLiabilities: 0,
                totalLiabilities: 0,
                commonStock: 0,
                retainedEarnings: 0,
                otherEquity: 0,
                totalEquity: 0,
                revenue: 0,
                cogs: 0,
                grossProfit: 0,
                salesExpenses: 0,
                adminExpenses: 0,
                rdExpenses: 0,
                operatingExpenses: 0,
                operatingIncome: 0,
                depreciation: 0,
                amortization: 0,
                ebitda: 0,
                interestExpense: 0,
                otherIncome: 0,
                ebt: 0,
                taxExpense: 0,
                netIncome: 0,
                operatingCashFlow: 0,
                investingCashFlow: 0,
                financingCashFlow: 0,
                freeCashFlow: 0,
                sharesOutstanding: 10000000,
                dividendsPaid: 0,
                capex: 0,
                workingCapital: 0
            };

            // HESAP KODU EÅLEÅTÄ°RME KURALLARI
            const accountMapping = {
                // VARLIKLAR
                '100': 'cash', // Kasa
                '101': 'cash', // AlÄ±nan Ã‡ekler
                '102': 'cash', // Bankalar
                '103': 'cash', // Verilen Ã‡ekler ve Ã–deme Emirleri
                '108': 'otherCurrentAssets', // DiÄŸer HazÄ±r DeÄŸerler
                '110': 'marketableSecurities', // Hisse Senetleri
                '111': 'marketableSecurities', // Ã–zel Kesim Tahvil Senet ve BonolarÄ±
                '112': 'marketableSecurities', // Kamu Kesimi Tahvil Senet ve BonolarÄ±
                '118': 'marketableSecurities', // DiÄŸer Menkul KÄ±ymetler
                '120': 'receivables', // AlÄ±cÄ±lar
                '121': 'receivables', // Alacak Senetleri
                '122': 'receivables', // Alacak Senetleri Reeskontu
                '126': 'receivables', // Verilen Depozito ve Teminatlar
                '127': 'receivables', // DiÄŸer Ticari Alacaklar
                '128': 'receivables', // ÅÃ¼pheli Ticari Alacaklar
                '129': 'receivables', // ÅÃ¼pheli Ticari Alacaklar KarÅŸÄ±lÄ±ÄŸÄ±
                '150': 'inventory', // Ä°lk Madde ve Malzeme
                '151': 'inventory', // YarÄ± Mamuller
                '152': 'inventory', // Mamuller
                '153': 'inventory', // Ticari Mallar
                '157': 'inventory', // DiÄŸer Stoklar
                '180': 'prepaidExpenses', // Gelecek Aylara Ait Giderler
                '190': 'otherCurrentAssets', // Devreden KDV
                '191': 'otherCurrentAssets', // Ä°ndirilecek KDV
                '250': 'ppe', // Arazi ve Arsalar
                '251': 'ppe', // Yer AltÄ± ve Yer ÃœstÃ¼ DÃ¼zenleri
                '252': 'ppe', // Binalar
                '253': 'ppe', // Tesis Makine ve Cihazlar
                '254': 'ppe', // TaÅŸÄ±tlar
                '255': 'ppe', // DemirbaÅŸlar
                '257': 'ppe', // BirikmiÅŸ Amortismanlar
                '260': 'intangibles', // Haklar
                '261': 'intangibles', // Åerefiye
                '262': 'intangibles', // KuruluÅŸ ve Ã–rgÃ¼tlenme Giderleri
                '263': 'intangibles', // AraÅŸtÄ±rma ve GeliÅŸtirme Giderleri
                '264': 'intangibles', // Ã–zel Maliyetler
                '268': 'intangibles', // BirikmiÅŸ Amortismanlar
                
                // BORÃ‡LAR
                '300': 'shortTermDebt', // Banka Kredileri
                '303': 'shortTermDebt', // Uzun Vadeli Kredilerin Anapara Taksitleri
                '320': 'accountsPayable', // SatÄ±cÄ±lar
                '321': 'accountsPayable', // BorÃ§ Senetleri
                '322': 'accountsPayable', // BorÃ§ Senetleri Reeskontu
                '326': 'accountsPayable', // AlÄ±nan Depozito ve Teminatlar
                '329': 'accountsPayable', // DiÄŸer Ticari BorÃ§lar
                '360': 'otherCurrentLiabilities', // Ã–denecek Vergi ve Fonlar
                '361': 'otherCurrentLiabilities', // Ã–denecek Sosyal GÃ¼venlik Kesintileri
                '368': 'otherCurrentLiabilities', // Vadesi GeÃ§miÅŸ ErtelenmiÅŸ veya TaksitlendirilmiÅŸ Vergi ve DiÄŸer YÃ¼kÃ¼mlÃ¼lÃ¼kler
                '370': 'otherCurrentLiabilities', // DÃ¶nem KarÄ± Vergi ve DiÄŸer Yasal YÃ¼kÃ¼mlÃ¼lÃ¼k KarÅŸÄ±lÄ±klarÄ±
                '380': 'otherCurrentLiabilities', // Gelecek Aylara Ait Gelirler
                '381': 'otherCurrentLiabilities', // Gider TahakkuklarÄ±
                '391': 'otherCurrentLiabilities', // Hesaplanan KDV
                '400': 'longTermDebt', // Banka Kredileri
                '405': 'longTermDebt', // Ã‡Ä±karÄ±lmÄ±ÅŸ Tahviller
                '407': 'longTermDebt', // Ã‡Ä±karÄ±lmÄ±ÅŸ DiÄŸer Menkul KÄ±ymetler
                '420': 'otherNonCurrentLiabilities', // SatÄ±cÄ±lar
                '479': 'deferredTaxes', // DiÄŸer BorÃ§ ve Gider KarÅŸÄ±lÄ±klarÄ±
                
                // Ã–ZKAYNAKLAR
                '500': 'commonStock', // Sermaye
                '501': 'commonStock', // Ã–denmemiÅŸ Sermaye
                '520': 'otherEquity', // Hisse Senedi Ä°hraÃ§ Primleri
                '540': 'otherEquity', // Yasal Yedekler
                '541': 'otherEquity', // StatÃ¼ Yedekleri
                '542': 'otherEquity', // OlaÄŸanÃ¼stÃ¼ Yedekler
                '549': 'otherEquity', // Ã–zel Fonlar
                '570': 'retainedEarnings', // GeÃ§miÅŸ YÄ±llar KarlarÄ±
                '580': 'retainedEarnings', // GeÃ§miÅŸ YÄ±llar ZararlarÄ±
                '590': 'retainedEarnings', // DÃ¶nem Net KarÄ±
                '591': 'retainedEarnings', // DÃ¶nem Net ZararÄ±
                
                // GELÄ°R TABLOSU
                '600': 'revenue', // YurtiÃ§i SatÄ±ÅŸlar
                '601': 'revenue', // YurtdÄ±ÅŸÄ± SatÄ±ÅŸlar
                '610': 'revenue', // SatÄ±ÅŸtan Ä°adeler
                '611': 'revenue', // SatÄ±ÅŸ Ä°skontolarÄ±
                '612': 'revenue', // DiÄŸer Ä°ndirimler
                '620': 'cogs', // SatÄ±lan Mamuller Maliyeti
                '621': 'cogs', // SatÄ±lan Ticari Mallar Maliyeti
                '622': 'cogs', // SatÄ±lan Hizmet Maliyeti
                '623': 'cogs', // DiÄŸer SatÄ±ÅŸlarÄ±n Maliyeti
                '630': 'operatingExpenses', // AraÅŸtÄ±rma ve GeliÅŸtirme Giderleri
                '631': 'salesExpenses', // Pazarlama SatÄ±ÅŸ ve DaÄŸÄ±tÄ±m Giderleri
                '632': 'adminExpenses', // Genel YÃ¶netim Giderleri
                '640': 'otherIncome', // Ä°ÅŸtiraklerden TemettÃ¼ Gelirleri
                '641': 'otherIncome', // BaÄŸlÄ± OrtaklÄ±klardan TemettÃ¼ Gelirleri
                '642': 'otherIncome', // Faiz Gelirleri
                '643': 'otherIncome', // Komisyon Gelirleri
                '644': 'otherIncome', // Konusu Kalmayan KarÅŸÄ±lÄ±klar
                '645': 'otherIncome', // Menkul KÄ±ymet SatÄ±ÅŸ KarlarÄ±
                '646': 'otherIncome', // Kambiyo KarlarÄ±
                '647': 'otherIncome', // Reeskont Faiz Gelirleri
                '649': 'otherIncome', // DiÄŸer OlaÄŸan Gelir ve Karlar
                '653': 'otherIncome', // Komisyon Giderleri
                '654': 'otherIncome', // KarÅŸÄ±lÄ±k Giderleri
                '655': 'otherIncome', // Menkul KÄ±ymet SatÄ±ÅŸ ZararlarÄ±
                '656': 'otherIncome', // Kambiyo ZararlarÄ±
                '657': 'otherIncome', // Reeskont Faiz Giderleri
                '659': 'otherIncome', // DiÄŸer OlaÄŸan Gider ve Zararlar
                '660': 'interestExpense', // KÄ±sa Vadeli BorÃ§lanma Giderleri
                '661': 'interestExpense', // Uzun Vadeli BorÃ§lanma Giderleri
                '689': 'otherIncome', // DiÄŸer OlaÄŸandÄ±ÅŸÄ± Gelir ve Karlar
                '690': 'taxExpense', // DÃ¶nem KarÄ± Vergi ve DiÄŸer Yasal YÃ¼kÃ¼mlÃ¼lÃ¼k KarÅŸÄ±lÄ±klarÄ±
                '691': 'taxExpense', // DÃ¶nem KarÄ± Vergi ve DiÄŸer Yasal YÃ¼kÃ¼mlÃ¼lÃ¼k KarÅŸÄ±lÄ±klarÄ±
                '692': 'taxExpense', // DÃ¶nem Net KarÄ± veya ZararÄ±
                '697': 'otherIncome', // DÃ¶nem Net KarÄ± veya ZararÄ±
                '698': 'otherIncome', // DÃ¶nem Net KarÄ± veya ZararÄ±
                '730': 'operatingExpenses', // Genel Ãœretim Giderleri
                '740': 'operatingExpenses', // Hizmet Ãœretim Maliyeti
                '750': 'depreciation', // AraÅŸtÄ±rma ve GeliÅŸtirme Giderleri
                '760': 'salesExpenses', // Pazarlama SatÄ±ÅŸ ve DaÄŸÄ±tÄ±m Giderleri
                '770': 'adminExpenses', // Genel YÃ¶netim Giderleri
                '780': 'interestExpense', // Finansman Giderleri
            };

            // Mizan verilerini iÅŸle
            data.forEach(row => {
                if (!row || row.length < 3) return;
                
                // Hesap kodunu al (ilk 3 hane)
                const accountCode = String(row[0]).substring(0, 3);
                const debit = parseFloat(row[2]) || 0;  // BorÃ§
                const credit = parseFloat(row[3]) || 0; // Alacak
                const balance = debit - credit;
                
                // Hesap koduna gÃ¶re eÅŸleÅŸtir
                if (accountMapping[accountCode]) {
                    const field = accountMapping[accountCode];
                    
                    // Gelir tablosu kalemleri iÃ§in mutlak deÄŸer al
                    if (['revenue', 'cogs', 'operatingExpenses', 'salesExpenses', 'adminExpenses', 
                         'interestExpense', 'otherIncome', 'taxExpense', 'depreciation'].includes(field)) {
                        result[field] += Math.abs(balance);
                    } else {
                        result[field] += balance;
                    }
                }
            });

            // ToplamlarÄ± hesapla
            result.currentAssets = result.cash + result.marketableSecurities + result.receivables + 
                                   result.inventory + result.prepaidExpenses + result.otherCurrentAssets;
            
            result.nonCurrentAssets = result.ppe + result.intangibles + result.investments + 
                                      result.otherNonCurrentAssets;
            
            result.totalAssets = result.currentAssets + result.nonCurrentAssets;
            
            result.currentLiabilities = result.accountsPayable + result.shortTermDebt + 
                                       result.currentPortionLTD + result.accruedExpenses + 
                                       result.otherCurrentLiabilities;
            
            result.nonCurrentLiabilities = result.longTermDebt + result.deferredTaxes + 
                                           result.otherNonCurrentLiabilities;
            
            result.totalLiabilities = result.currentLiabilities + result.nonCurrentLiabilities;
            
            result.totalEquity = result.commonStock + result.retainedEarnings + result.otherEquity;
            
            // Gelir tablosu hesaplamalarÄ±
            result.grossProfit = result.revenue - result.cogs;
            result.operatingIncome = result.grossProfit - result.operatingExpenses - 
                                     result.salesExpenses - result.adminExpenses;
            result.ebitda = result.operatingIncome + result.depreciation + result.amortization;
            result.ebt = result.operatingIncome - result.interestExpense + result.otherIncome;
            result.netIncome = result.ebt - result.taxExpense;
            
            // Nakit akÄ±ÅŸ tahminleri (basitleÅŸtirilmiÅŸ)
            result.operatingCashFlow = result.netIncome + result.depreciation + result.amortization;
            result.investingCashFlow = -result.capex;
            result.financingCashFlow = result.dividendsPaid * -1;
            result.freeCashFlow = result.operatingCashFlow - result.capex;
            
            result.workingCapital = result.currentAssets - result.currentLiabilities;
            
            // Risk aÄŸÄ±rlÄ±klÄ± varlÄ±klar (Basel III iÃ§in tahmin)
            result.riskWeightedAssets = result.totalAssets * 0.75;
            result.tier1Capital = result.totalEquity * 0.9;
            result.tier2Capital = result.totalEquity * 0.1;
            result.cet1Capital = result.totalEquity * 0.85;
            
            return result;
        }

        // RAPOR OLUÅTUR
        function generateReport(years) {
            const tabContents = document.getElementById('tabContents');
            
            // Her yÄ±l iÃ§in oranlarÄ± hesapla
            years.forEach(year => {
                year.ratios = calculateAllRatios(year);
                year.scores = calculateAllBankruptcyScores(year);
                year.manipulation = calculateManipulationIndicators(year);
                year.basel = calculateBaselIII(year);
                year.bddk = calculateBDDKClassification(year);
                year.tfrs9 = calculateTFRS9(year);
            });

            let html = '';
            
            // 1. Genel BakÄ±ÅŸ
            html += generateOverview(years);
            
            // 2. 40+ Finansal Oran
            html += generateComprehensiveRatios(years);
            
            // 3. DuPont Analizi
            html += generateDuPontAnalysis(years);
            
            // 4. 7 Ä°flas Modeli
            html += generateBankruptcyModels(years);
            
            // 5. Hile Tespiti
            html += generateManipulationDetection(years);
            
            // 6. Basel III
            html += generateBaselIII(years);
            
            // 7. BDDK
            html += generateBDDK(years);
            
            // 8. TFRS 9
            html += generateTFRS9(years);
            
            // 9. Kredi DeÄŸerlendirme
            html += generateCreditAssessment(years);
            
            // 10. Trend Analizi
            html += generateTrends(years);
            
            // 11. Nakit AkÄ±ÅŸ
            html += generateCashFlow(years);
            
            // 12. Senaryo Analizi
            html += generateScenarioAnalysis(years);
            
            // 13. Åirket DeÄŸerlemesi
            html += generateValuation(years);
            
            // 14. Ã–neriler
            html += generateRecommendations(years);
            
            tabContents.innerHTML = html;
            showTab('overview');
            
            setTimeout(() => {
                createCharts(years);
            }, 100);
        }

        // 1. GENEL BAKIÅ
        function generateOverview(years) {
            const current = years[years.length - 1];
            const overallScore = calculateOverallRiskScore(current);
            
            return `
            <div class="tab-content active" id="overview">
                <div class="section">
                    <h2 class="section-title">ğŸ“Š GENEL BAKIÅ</h2>
                    
                    <div class="grid-container">
                        <div class="metric-card">
                            <h3>Risk Skoru</h3>
                            <div class="metric-value">${overallScore}/100</div>
                            <span class="risk-badge risk-${overallScore < 40 ? 'low' : overallScore < 70 ? 'medium' : 'high'}">
                                ${overallScore < 40 ? 'DÃ¼ÅŸÃ¼k Risk' : overallScore < 70 ? 'Orta Risk' : 'YÃ¼ksek Risk'}
                            </span>
                        </div>
                        <div class="metric-card">
                            <h3>Basel III CAR</h3>
                            <div class="metric-value">${current.basel.car.toFixed(1)}%</div>
                            <span class="regulation-badge">Min: %8</span>
                        </div>
                        <div class="metric-card">
                            <h3>BDDK SÄ±nÄ±fÄ±</h3>
                            <div class="metric-value">Grup ${current.bddk.group}</div>
                            <span class="regulation-badge">${current.bddk.provision}% KarÅŸÄ±lÄ±k</span>
                        </div>
                        <div class="metric-card">
                            <h3>TFRS 9 AÅŸama</h3>
                            <div class="metric-value">AÅŸama ${current.tfrs9.stage}</div>
                            <span class="regulation-badge">ECL: ${(current.tfrs9.ecl/1000000).toFixed(1)}M</span>
                        </div>
                    </div>
                    
                    <div class="patron-comment">
                        <h4>YÃ–NETÄ°M Ã–ZETÄ°</h4>
                        <p><strong>Kritik Bulgular:</strong></p>
                        <ul>
                            <li>7 iflas modelinden ${current.scores.failedModels} tanesi risk gÃ¶steriyor</li>
                            <li>Basel III sermaye yeterliliÄŸi ${current.basel.car < 12 ? 'sÄ±nÄ±rda' : 'yeterli'}</li>
                            <li>BDDK Grup ${current.bddk.group} - ${current.bddk.description}</li>
                            <li>ManipÃ¼lasyon riski: ${current.manipulation.riskLevel}</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 2. 40+ FÄ°NANSAL ORAN
        function generateComprehensiveRatios(years) {
            const current = years[years.length - 1];
            const r = current.ratios;
            
            return `
            <div class="tab-content" id="ratios">
                <div class="section">
                    <h2 class="section-title">ğŸ“ˆ KAPSAMLI FÄ°NANSAL ORANLAR (40+)</h2>
                    
                    <!-- LÄ°KÄ°DÄ°TE ORANLARI -->
                    <h3>ğŸ’° Likidite OranlarÄ±</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Oran</th>
                                <th>FormÃ¼l</th>
                                <th>DeÄŸer</th>
                                <th>SektÃ¶r</th>
                                <th>Yorum</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Cari Oran</td>
                                <td>DÃ¶nen VarlÄ±k / KVYK</td>
                                <td>${r.currentRatio.toFixed(2)}</td>
                                <td>1.80</td>
                                <td>${r.currentRatio < 1 ? 'ğŸš¨ Kritik' : r.currentRatio < 1.5 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>Asit-Test</td>
                                <td>(DV - Stok) / KVYK</td>
                                <td>${r.acidTest.toFixed(2)}</td>
                                <td>1.20</td>
                                <td>${r.acidTest < 0.8 ? 'ğŸš¨ Kritik' : r.acidTest < 1 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>Nakit Oran</td>
                                <td>Nakit / KVYK</td>
                                <td>${r.cashRatio.toFixed(2)}</td>
                                <td>0.30</td>
                                <td>${r.cashRatio < 0.2 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>Defansif Interval</td>
                                <td>Likit VarlÄ±k / GÃ¼nlÃ¼k Gider</td>
                                <td>${r.defensiveInterval.toFixed(0)} gÃ¼n</td>
                                <td>90 gÃ¼n</td>
                                <td>${r.defensiveInterval < 60 ? 'ğŸš¨ Riskli' : 'âœ… Ä°yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- FAALÄ°YET ORANLARI -->
                    <h3 style="margin-top: 30px;">âš™ï¸ Faaliyet OranlarÄ±</h3>
                    <table class="data-table">
                        <tbody>
                            <tr>
                                <td>Alacak Devir HÄ±zÄ±</td>
                                <td>SatÄ±ÅŸlar / Alacaklar</td>
                                <td>${r.receivableTurnover.toFixed(1)}x</td>
                                <td>8.0x</td>
                                <td>${365/r.receivableTurnover} gÃ¼n tahsilat</td>
                            </tr>
                            <tr>
                                <td>Stok Devir HÄ±zÄ±</td>
                                <td>SMM / Stoklar</td>
                                <td>${r.inventoryTurnover.toFixed(1)}x</td>
                                <td>12.0x</td>
                                <td>${365/r.inventoryTurnover} gÃ¼n stokta</td>
                            </tr>
                            <tr>
                                <td>Aktif Devir HÄ±zÄ±</td>
                                <td>SatÄ±ÅŸlar / Aktifler</td>
                                <td>${r.assetTurnover.toFixed(2)}x</td>
                                <td>1.5x</td>
                                <td>${r.assetTurnover < 1 ? 'âš ï¸ Verimsiz' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>Sabit VarlÄ±k Devir</td>
                                <td>SatÄ±ÅŸlar / Sabit VarlÄ±k</td>
                                <td>${r.fixedAssetTurnover.toFixed(2)}x</td>
                                <td>3.0x</td>
                                <td>${r.fixedAssetTurnover < 2 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>Nakit DÃ¶nÃ¼ÅŸÃ¼m SÃ¼resi</td>
                                <td>Alacak + Stok - BorÃ§ GÃ¼nÃ¼</td>
                                <td>${r.cashConversionCycle.toFixed(0)} gÃ¼n</td>
                                <td>45 gÃ¼n</td>
                                <td>${r.cashConversionCycle > 60 ? 'ğŸš¨ YavaÅŸ' : 'âœ… Ä°yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- KARLILIK ORANLARI -->
                    <h3 style="margin-top: 30px;">ğŸ’ KÃ¢rlÄ±lÄ±k OranlarÄ±</h3>
                    <table class="data-table">
                        <tbody>
                            <tr>
                                <td>BrÃ¼t KÃ¢r MarjÄ±</td>
                                <td>BrÃ¼t KÃ¢r / SatÄ±ÅŸlar</td>
                                <td>%${r.grossProfitMargin.toFixed(1)}</td>
                                <td>%35</td>
                                <td>${r.grossProfitMargin < 25 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>Faaliyet MarjÄ±</td>
                                <td>FVÃ–K / SatÄ±ÅŸlar</td>
                                <td>%${r.operatingMargin.toFixed(1)}</td>
                                <td>%15</td>
                                <td>${r.operatingMargin < 10 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>EBITDA MarjÄ±</td>
                                <td>EBITDA / SatÄ±ÅŸlar</td>
                                <td>%${r.ebitdaMargin.toFixed(1)}</td>
                                <td>%18</td>
                                <td>${r.ebitdaMargin < 12 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>Net KÃ¢r MarjÄ±</td>
                                <td>Net KÃ¢r / SatÄ±ÅŸlar</td>
                                <td>%${r.netProfitMargin.toFixed(1)}</td>
                                <td>%10</td>
                                <td>${r.netProfitMargin < 5 ? 'ğŸš¨ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>ROA</td>
                                <td>Net KÃ¢r / Aktifler</td>
                                <td>%${r.roa.toFixed(1)}</td>
                                <td>%8</td>
                                <td>${r.roa < 5 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>ROE</td>
                                <td>Net KÃ¢r / Ã–zkaynak</td>
                                <td>%${r.roe.toFixed(1)}</td>
                                <td>%15</td>
                                <td>${r.roe < 10 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>ROIC</td>
                                <td>NOPAT / YatÄ±rÄ±lan Sermaye</td>
                                <td>%${r.roic.toFixed(1)}</td>
                                <td>%12</td>
                                <td>${r.roic < 8 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- KALDIRAÃ‡ ORANLARI -->
                    <h3 style="margin-top: 30px;">âš–ï¸ KaldÄ±raÃ§ OranlarÄ±</h3>
                    <table class="data-table">
                        <tbody>
                            <tr>
                                <td>BorÃ§/Aktif</td>
                                <td>Toplam BorÃ§ / Aktif</td>
                                <td>%${r.debtToAssets.toFixed(1)}</td>
                                <td>%50</td>
                                <td>${r.debtToAssets > 70 ? 'ğŸš¨ YÃ¼ksek' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>BorÃ§/Ã–zkaynak</td>
                                <td>Toplam BorÃ§ / Ã–zkaynak</td>
                                <td>${r.debtToEquity.toFixed(2)}</td>
                                <td>1.00</td>
                                <td>${r.debtToEquity > 2 ? 'ğŸš¨ YÃ¼ksek' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>Faiz KarÅŸÄ±lama</td>
                                <td>FVÃ–K / Faiz</td>
                                <td>${r.interestCoverage.toFixed(1)}x</td>
                                <td>5.0x</td>
                                <td>${r.interestCoverage < 2 ? 'ğŸš¨ Kritik' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>BorÃ§ Servis KarÅŸÄ±lama</td>
                                <td>EBITDA / (Faiz+Anapara)</td>
                                <td>${r.debtServiceCoverage.toFixed(2)}x</td>
                                <td>1.25x</td>
                                <td>${r.debtServiceCoverage < 1 ? 'ğŸš¨ Kritik' : 'âœ… Ä°yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- NAKÄ°T AKIÅ ORANLARI -->
                    <h3 style="margin-top: 30px;">ğŸ’µ Nakit AkÄ±ÅŸ OranlarÄ±</h3>
                    <table class="data-table">
                        <tbody>
                            <tr>
                                <td>Ä°ÅŸletme NA / SatÄ±ÅŸlar</td>
                                <td>Ä°ÅŸletme Nakit AkÄ±ÅŸÄ± / SatÄ±ÅŸlar</td>
                                <td>%${r.ocfToSales.toFixed(1)}</td>
                                <td>%12</td>
                                <td>${r.ocfToSales < 8 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>FCF / SatÄ±ÅŸlar</td>
                                <td>Serbest Nakit AkÄ±ÅŸ / SatÄ±ÅŸlar</td>
                                <td>%${r.fcfToSales.toFixed(1)}</td>
                                <td>%8</td>
                                <td>${r.fcfToSales < 5 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>Nakit AkÄ±ÅŸ ROI</td>
                                <td>Ä°ÅŸletme NA / Aktifler</td>
                                <td>%${r.cashFlowROI.toFixed(1)}</td>
                                <td>%10</td>
                                <td>${r.cashFlowROI < 7 ? 'âš ï¸ DÃ¼ÅŸÃ¼k' : 'âœ… Ä°yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- PÄ°YASA ORANLARI -->
                    <h3 style="margin-top: 30px;">ğŸ“Š Piyasa DeÄŸerleme OranlarÄ±</h3>
                    <table class="data-table">
                        <tbody>
                            <tr>
                                <td>EV/EBITDA</td>
                                <td>Ä°ÅŸletme DeÄŸeri / EBITDA</td>
                                <td>${r.evToEbitda.toFixed(1)}x</td>
                                <td>8.0x</td>
                                <td>${r.evToEbitda > 12 ? 'âš ï¸ PahalÄ±' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>P/E</td>
                                <td>Piyasa DeÄŸeri / Net KÃ¢r</td>
                                <td>${r.peRatio.toFixed(1)}x</td>
                                <td>15.0x</td>
                                <td>${r.peRatio > 25 ? 'âš ï¸ PahalÄ±' : 'âœ… Ä°yi'}</td>
                            </tr>
                            <tr>
                                <td>P/B</td>
                                <td>Piyasa DeÄŸeri / Defter DeÄŸeri</td>
                                <td>${r.pbRatio.toFixed(1)}x</td>
                                <td>2.0x</td>
                                <td>${r.pbRatio > 3 ? 'âš ï¸ PahalÄ±' : 'âœ… Ä°yi'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="patron-comment">
                        <h4>PATRON Ä°Ã‡Ä°N Ã–ZET</h4>
                        <p><strong>En kritik 5 oran:</strong></p>
                        <ul>
                            <li>Cari Oran: ${r.currentRatio.toFixed(2)} â†’ 100 TL borca ${(r.currentRatio*100).toFixed(0)} TL varlÄ±k</li>
                            <li>Net KÃ¢r MarjÄ±: %${r.netProfitMargin.toFixed(1)} â†’ 100 TL satÄ±ÅŸtan ${r.netProfitMargin.toFixed(1)} TL kÃ¢r</li>
                            <li>ROE: %${r.roe.toFixed(1)} â†’ Sermayenizin getirisi (Mevduat: %45)</li>
                            <li>BorÃ§/Ã–zkaynak: ${r.debtToEquity.toFixed(2)} â†’ 100 TL sermayeye ${(r.debtToEquity*100).toFixed(0)} TL borÃ§</li>
                            <li>Nakit DÃ¶ngÃ¼: ${r.cashConversionCycle.toFixed(0)} gÃ¼n â†’ ParanÄ±z bu kadar gÃ¼nde geri dÃ¶nÃ¼yor</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 3. DUPONT ANALÄ°ZÄ°
        function generateDuPontAnalysis(years) {
            const current = years[years.length - 1];
            const dupont = calculateDuPont(current);
            
            return `
            <div class="tab-content" id="dupont">
                <div class="section">
                    <h2 class="section-title">ğŸ¯ DUPONT ANALÄ°ZÄ°</h2>
                    
                    <div class="dupont-tree">
                        <div class="dupont-node" style="background: #667eea; color: white;">
                            <h3>ROE</h3>
                            <div style="font-size: 24px;">%${dupont.roe.toFixed(1)}</div>
                        </div>
                    </div>
                    
                    <div class="dupont-tree">
                        <div class="dupont-node">
                            <h4>Net KÃ¢r MarjÄ±</h4>
                            <div>%${dupont.netProfitMargin.toFixed(1)}</div>
                            <small>Net KÃ¢r / SatÄ±ÅŸlar</small>
                        </div>
                        <div style="align-self: center;">Ã—</div>
                        <div class="dupont-node">
                            <h4>Aktif Devir</h4>
                            <div>${dupont.assetTurnover.toFixed(2)}x</div>
                            <small>SatÄ±ÅŸlar / Aktifler</small>
                        </div>
                        <div style="align-self: center;">Ã—</div>
                        <div class="dupont-node">
                            <h4>Ã–zkaynak Ã‡arpanÄ±</h4>
                            <div>${dupont.equityMultiplier.toFixed(2)}x</div>
                            <small>Aktifler / Ã–zkaynak</small>
                        </div>
                    </div>
                    
                    <div class="patron-comment">
                        <h4>DUPONT ANALÄ°ZÄ° YORUMU</h4>
                        <p><strong>ROE = %${dupont.roe.toFixed(1)} nasÄ±l oluÅŸuyor?</strong></p>
                        <ul>
                            <li><strong>KÃ¢rlÄ±lÄ±k:</strong> Her 100 TL satÄ±ÅŸtan ${dupont.netProfitMargin.toFixed(1)} TL kÃ¢r</li>
                            <li><strong>Verimlilik:</strong> 1 TL varlÄ±kla ${dupont.assetTurnover.toFixed(2)} TL satÄ±ÅŸ</li>
                            <li><strong>KaldÄ±raÃ§:</strong> ${dupont.equityMultiplier.toFixed(2)}x borÃ§lanma ile bÃ¼yÃ¼tme</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>Sorun nerede?</strong></p>
                        ${dupont.netProfitMargin < 10 ? '<p>âš ï¸ KÃ¢r marjÄ± dÃ¼ÅŸÃ¼k - Fiyat artÄ±rÄ±n veya maliyet dÃ¼ÅŸÃ¼rÃ¼n</p>' : ''}
                        ${dupont.assetTurnover < 1 ? '<p>âš ï¸ VarlÄ±klar verimsiz - AtÄ±l varlÄ±klarÄ± satÄ±n</p>' : ''}
                        ${dupont.equityMultiplier > 3 ? '<p>âš ï¸ AÅŸÄ±rÄ± borÃ§lanma - Sermaye artÄ±rÄ±n</p>' : ''}
                    </div>
                </div>
            </div>`;
        }

        // 4. 7 Ä°FLAS MODELÄ°
        function generateBankruptcyModels(years) {
            const current = years[years.length - 1];
            const scores = current.scores;
            
            return `
            <div class="tab-content" id="bankruptcy">
                <div class="section">
                    <h2 class="section-title">âš ï¸ 7 Ä°FLAS TAHMÄ°N MODELÄ°</h2>
                    
                    <!-- ALTMAN Z-SCORE -->
                    <div class="metric-card">
                        <h3>1. Altman Z-Score (1968)</h3>
                        <div class="model-score score-${scores.altman.risk}">
                            Z = ${scores.altman.score.toFixed(2)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.altman.riskText}</p>
                        <p><strong>FormÃ¼l:</strong> 1.2(WC/TA) + 1.4(RE/TA) + 3.3(EBIT/TA) + 0.6(MVE/TL) + 1.0(S/TA)</p>
                        <p><strong>Yorum:</strong> ${scores.altman.interpretation}</p>
                    </div>
                    
                    <!-- SPRINGATE S-SCORE -->
                    <div class="metric-card">
                        <h3>2. Springate S-Score (1978)</h3>
                        <div class="model-score score-${scores.springate.risk}">
                            S = ${scores.springate.score.toFixed(2)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.springate.riskText}</p>
                        <p><strong>FormÃ¼l:</strong> 1.03(WC/TA) + 3.07(EBIT/TA) + 0.66(EBT/CL) + 0.4(S/TA)</p>
                        <p><strong>Yorum:</strong> ${scores.springate.interpretation}</p>
                    </div>
                    
                    <!-- OHLSON O-SCORE -->
                    <div class="metric-card">
                        <h3>3. Ohlson O-Score (1980)</h3>
                        <div class="model-score score-${scores.ohlson.risk}">
                            P(iflas) = %${(scores.ohlson.probability * 100).toFixed(1)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.ohlson.riskText}</p>
                        <p><strong>9 DeÄŸiÅŸkenli Lojistik Model</strong></p>
                        <p><strong>Yorum:</strong> ${scores.ohlson.interpretation}</p>
                    </div>
                    
                    <!-- FULMER H-SCORE -->
                    <div class="metric-card">
                        <h3>4. Fulmer H-Score (1984)</h3>
                        <div class="model-score score-${scores.fulmer.risk}">
                            H = ${scores.fulmer.score.toFixed(2)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.fulmer.riskText}</p>
                        <p><strong>9 OranlÄ± Model</strong></p>
                        <p><strong>Yorum:</strong> ${scores.fulmer.interpretation}</p>
                    </div>
                    
                    <!-- ZMIJEWSKI X-SCORE -->
                    <div class="metric-card">
                        <h3>5. Zmijewski X-Score (1984)</h3>
                        <div class="model-score score-${scores.zmijewski.risk}">
                            P(iflas) = %${(scores.zmijewski.probability * 100).toFixed(1)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.zmijewski.riskText}</p>
                        <p><strong>Probit Model</strong></p>
                        <p><strong>Yorum:</strong> ${scores.zmijewski.interpretation}</p>
                    </div>
                    
                    <!-- TAFFLER Z-SCORE -->
                    <div class="metric-card">
                        <h3>6. Taffler Z-Score (1983)</h3>
                        <div class="model-score score-${scores.taffler.risk}">
                            Z = ${scores.taffler.score.toFixed(2)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.taffler.riskText}</p>
                        <p><strong>Ä°ngiliz Modeli</strong></p>
                        <p><strong>Yorum:</strong> ${scores.taffler.interpretation}</p>
                    </div>
                    
                    <!-- GROVER G-SCORE -->
                    <div class="metric-card">
                        <h3>7. Grover G-Score (2001)</h3>
                        <div class="model-score score-${scores.grover.risk}">
                            G = ${scores.grover.score.toFixed(2)}
                        </div>
                        <p><strong>Risk:</strong> ${scores.grover.riskText}</p>
                        <p><strong>GÃ¼ncel Model</strong></p>
                        <p><strong>Yorum:</strong> ${scores.grover.interpretation}</p>
                    </div>
                    
                    <div class="patron-comment danger">
                        <h4>Ä°FLAS RÄ°SK Ã–ZETÄ°</h4>
                        <p><strong>7 modelden ${scores.failedModels} tanesi RÄ°SK gÃ¶steriyor!</strong></p>
                        <ul>
                            <li>ğŸŸ¢ GÃ¼venli: ${scores.safeModels} model</li>
                            <li>ğŸŸ¡ Belirsiz: ${scores.greyModels} model</li>
                            <li>ğŸ”´ Riskli: ${scores.failedModels} model</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>SONUÃ‡:</strong> ${scores.overallConclusion}</p>
                    </div>
                </div>
            </div>`;
        }

        // 5. HÄ°LE TESPÄ°TÄ°
        function generateManipulationDetection(years) {
            const current = years[years.length - 1];
            const m = current.manipulation;
            
            return `
            <div class="tab-content" id="manipulation">
                <div class="section">
                    <h2 class="section-title">ğŸ” HÄ°LE VE MANÄ°PÃœLASYON TESPÄ°TÄ°</h2>
                    
                    <!-- BENEISH M-SCORE -->
                    <div class="metric-card">
                        <h3>Beneish M-Score</h3>
                        <div class="model-score score-${m.beneish.risk}">
                            M = ${m.beneish.score.toFixed(2)}
                        </div>
                        <p><strong>8 DeÄŸiÅŸken:</strong> DSRI, GMI, AQI, SGI, DEPI, SGAI, TATA, LVGI</p>
                        <p><strong>Yorum:</strong> ${m.beneish.interpretation}</p>
                    </div>
                    
                    <!-- BENFORD LAW ANALÄ°ZÄ° -->
                    <div class="metric-card">
                        <h3>Benford YasasÄ± Analizi</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ä°lk Rakam</th>
                                    <th>Beklenen %</th>
                                    <th>GÃ¶zlenen %</th>
                                    <th>Sapma</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${m.benford.digits.map(d => `
                                <tr>
                                    <td>${d.digit}</td>
                                    <td>%${d.expected.toFixed(1)}</td>
                                    <td>%${d.observed.toFixed(1)}</td>
                                    <td class="${Math.abs(d.deviation) > 5 ? 'text-danger' : ''}">
                                        ${d.deviation > 0 ? '+' : ''}${d.deviation.toFixed(1)}%
                                    </td>
                                </tr>`).join('')}
                            </tbody>
                        </table>
                        <p><strong>Chi-Square:</strong> ${m.benford.chiSquare.toFixed(2)} (Kritik: 15.51)</p>
                        <p><strong>SonuÃ§:</strong> ${m.benford.suspicious ? 'ğŸš¨ ÅÃœPHELÄ°' : 'âœ… NORMAL'}</p>
                    </div>
                    
                    <!-- ANORMAL GÃ–STERGELER -->
                    <div class="metric-card">
                        <h3>Anormal Finansal GÃ¶stergeler</h3>
                        ${m.redFlags.map(flag => `
                        <div class="manipulation-indicator manipulation-${flag.severity}">
                            <span style="margin-right: 10px;">${flag.icon}</span>
                            <div>
                                <strong>${flag.title}</strong><br>
                                <small>${flag.description}</small>
                            </div>
                        </div>`).join('')}
                    </div>
                    
                    <!-- YUVARLAK SAYI ANALÄ°ZÄ° -->
                    <div class="metric-card">
                        <h3>Yuvarlak SayÄ± YoÄŸunluÄŸu</h3>
                        <p><strong>Yuvarlak SayÄ± OranÄ±:</strong> %${m.roundNumbers.percentage.toFixed(1)}</p>
                        <p><strong>Normal AralÄ±k:</strong> %5-15</p>
                        <p><strong>Durum:</strong> ${m.roundNumbers.suspicious ? 'ğŸš¨ ÅÃœPHELÄ°' : 'âœ… NORMAL'}</p>
                    </div>
                    
                    <div class="patron-comment ${m.overallRisk === 'high' ? 'danger' : 'warning'}">
                        <h4>MANÄ°PÃœLASYON DEÄERLENDÄ°RMESÄ°</h4>
                        <p><strong>Genel Risk:</strong> ${m.riskLevel}</p>
                        <p><strong>Tespit Edilen Sorunlar:</strong></p>
                        <ul>
                            ${m.issues.map(issue => `<li>${issue}</li>`).join('')}
                        </ul>
                        <p style="margin-top: 15px;"><strong>Ã–NERÄ°LER:</strong></p>
                        <ul>
                            <li>BaÄŸÄ±msÄ±z denetim yaptÄ±rÄ±n</li>
                            <li>Ä°Ã§ kontrol sistemini gÃ¼Ã§lendirin</li>
                            <li>DÃ¶nemsel karÅŸÄ±laÅŸtÄ±rma yapÄ±n</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 6. BASEL III
        function generateBaselIII(years) {
            const current = years[years.length - 1];
            const basel = current.basel;
            
            return `
            <div class="tab-content" id="basel">
                <div class="section">
                    <h2 class="section-title">ğŸ¦ BASEL III SERMAYE YETERLÄ°LÄ°ÄÄ°</h2>
                    
                    <div class="basel-table">
                        <h3>Sermaye BileÅŸenleri</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Sermaye Kalemi</th>
                                    <th>Tutar (Milyon TL)</th>
                                    <th>RWA'ya OranÄ±</th>
                                    <th>Min. Oran</th>
                                    <th>Durum</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>CET1 (Ã‡ekirdek Sermaye)</strong></td>
                                    <td>${(basel.cet1Capital/1000000).toFixed(1)}</td>
                                    <td>${basel.cet1Ratio.toFixed(2)}%</td>
                                    <td>4.5%</td>
                                    <td>${basel.cet1Ratio >= 4.5 ? 'âœ…' : 'âŒ'}</td>
                                </tr>
                                <tr>
                                    <td><strong>Tier 1 (Ana Sermaye)</strong></td>
                                    <td>${(basel.tier1Capital/1000000).toFixed(1)}</td>
                                    <td>${basel.tier1Ratio.toFixed(2)}%</td>
                                    <td>6.0%</td>
                                    <td>${basel.tier1Ratio >= 6 ? 'âœ…' : 'âŒ'}</td>
                                </tr>
                                <tr>
                                    <td><strong>Tier 2 (KatkÄ± Sermaye)</strong></td>
                                    <td>${(basel.tier2Capital/1000000).toFixed(1)}</td>
                                    <td>${basel.tier2Ratio.toFixed(2)}%</td>
                                    <td>2.0%</td>
                                    <td>${basel.tier2Ratio >= 2 ? 'âœ…' : 'âŒ'}</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>TOPLAM SERMAYE</strong></td>
                                    <td><strong>${(basel.totalCapital/1000000).toFixed(1)}</strong></td>
                                    <td><strong>${basel.car.toFixed(2)}%</strong></td>
                                    <td><strong>8.0%</strong></td>
                                    <td><strong>${basel.car >= 8 ? 'âœ…' : 'âŒ'}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h3 style="margin-top: 30px;">Tamponlar ve Ä°laveler</h3>
                        <table class="data-table">
                            <tbody>
                                <tr>
                                    <td>Sermaye Koruma Tamponu</td>
                                    <td>2.5%</td>
                                    <td>${basel.conservationBuffer ? 'âœ… Var' : 'âŒ Yok'}</td>
                                </tr>
                                <tr>
                                    <td>DÃ¶ngÃ¼sel Sermaye Tamponu</td>
                                    <td>0-2.5%</td>
                                    <td>${basel.countercyclicalBuffer.toFixed(1)}%</td>
                                </tr>
                                <tr>
                                    <td>Sistemik Ã–nem Tamponu</td>
                                    <td>1-3.5%</td>
                                    <td>${basel.systemicBuffer.toFixed(1)}%</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>Toplam CAR Gereksinimi</strong></td>
                                    <td colspan="2"><strong>${basel.totalRequirement.toFixed(1)}%</strong></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h3 style="margin-top: 30px;">Risk AÄŸÄ±rlÄ±klÄ± VarlÄ±klar (RWA)</h3>
                        <table class="data-table">
                            <tbody>
                                <tr>
                                    <td>Kredi Riski RWA</td>
                                    <td>${(basel.creditRWA/1000000).toFixed(1)}M TL</td>
                                    <td>${((basel.creditRWA/basel.totalRWA)*100).toFixed(1)}%</td>
                                </tr>
                                <tr>
                                    <td>Piyasa Riski RWA</td>
                                    <td>${(basel.marketRWA/1000000).toFixed(1)}M TL</td>
                                    <td>${((basel.marketRWA/basel.totalRWA)*100).toFixed(1)}%</td>
                                </tr>
                                <tr>
                                    <td>Operasyonel Risk RWA</td>
                                    <td>${(basel.operationalRWA/1000000).toFixed(1)}M TL</td>
                                    <td>${((basel.operationalRWA/basel.totalRWA)*100).toFixed(1)}%</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>Toplam RWA</strong></td>
                                    <td colspan="2"><strong>${(basel.totalRWA/1000000).toFixed(1)}M TL</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="patron-comment ${basel.car < 12 ? 'warning' : 'good'}">
                        <h4>BASEL III YORUMU</h4>
                        <p><strong>Sermaye Yeterlilik OranÄ±: %${basel.car.toFixed(2)}</strong></p>
                        <p>ğŸ‘‰ Minimum %8 gerekli, sizde %${basel.car.toFixed(2)} var</p>
                        ${basel.car < 8 ? 
                            '<p class="text-danger">ğŸš¨ KRÄ°TÄ°K: Yasal limite altÄ±nda!</p>' :
                         basel.car < 12 ?
                            '<p class="text-warning">âš ï¸ DÄ°KKAT: GÃ¼venli tampon seviyesinde deÄŸil</p>' :
                            '<p class="text-success">âœ… GÃœZEL: Sermaye yeterliliÄŸi iyi durumda</p>'}
                        <p style="margin-top: 15px;"><strong>Ne yapmalÄ±?</strong></p>
                        <ul>
                            ${basel.car < 12 ? '<li>Sermaye artÄ±rÄ±mÄ± yapÄ±n</li>' : ''}
                            ${basel.car < 12 ? '<li>Riskli varlÄ±klarÄ± azaltÄ±n</li>' : ''}
                            <li>RWA optimizasyonu yapÄ±n</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 7. BDDK
        function generateBDDK(years) {
            const current = years[years.length - 1];
            const bddk = current.bddk;
            
            return `
            <div class="tab-content" id="bddk">
                <div class="section">
                    <h2 class="section-title">ğŸ›ï¸ BDDK KREDÄ° SINIFLANDIRMASI</h2>
                    
                    <div class="bddk-classification">
                        <div class="bddk-group bddk-${bddk.group} ${bddk.group === 1 ? 'active' : ''}">
                            <h3>GRUP 1</h3>
                            <p>Standart</p>
                            <p>%1 KarÅŸÄ±lÄ±k</p>
                        </div>
                        <div class="bddk-group bddk-${bddk.group} ${bddk.group === 2 ? 'active' : ''}">
                            <h3>GRUP 2</h3>
                            <p>YakÄ±n Ä°zleme</p>
                            <p>%2 KarÅŸÄ±lÄ±k</p>
                        </div>
                        <div class="bddk-group bddk-${bddk.group} ${bddk.group === 3 ? 'active' : ''}">
                            <h3>GRUP 3</h3>
                            <p>Tahsil ÅÃ¼pheli</p>
                            <p>%20 KarÅŸÄ±lÄ±k</p>
                        </div>
                        <div class="bddk-group bddk-${bddk.group} ${bddk.group === 4 ? 'active' : ''}">
                            <h3>GRUP 4</h3>
                            <p>Tahsili GecikmiÅŸ</p>
                            <p>%50 KarÅŸÄ±lÄ±k</p>
                        </div>
                        <div class="bddk-group bddk-${bddk.group} ${bddk.group === 5 ? 'active' : ''}">
                            <h3>GRUP 5</h3>
                            <p>Zarar</p>
                            <p>%100 KarÅŸÄ±lÄ±k</p>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <h3>BDDK Kriterleri DeÄŸerlendirmesi</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Kriter</th>
                                    <th>Durum</th>
                                    <th>DeÄŸer</th>
                                    <th>SonuÃ§</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Gecikme SÃ¼resi</td>
                                    <td>${bddk.delayDays} gÃ¼n</td>
                                    <td>Max 30 gÃ¼n</td>
                                    <td>${bddk.delayDays <= 30 ? 'âœ…' : 'âŒ'}</td>
                                </tr>
                                <tr>
                                    <td>Mali YapÄ±</td>
                                    <td>${bddk.financialStructure}</td>
                                    <td>GÃ¼Ã§lÃ¼ olmalÄ±</td>
                                    <td>${bddk.financialStructure === 'GÃ¼Ã§lÃ¼' ? 'âœ…' : 'âš ï¸'}</td>
                                </tr>
                                <tr>
                                    <td>Nakit AkÄ±ÅŸ</td>
                                    <td>${bddk.cashFlowStatus}</td>
                                    <td>Pozitif olmalÄ±</td>
                                    <td>${bddk.cashFlowStatus === 'Pozitif' ? 'âœ…' : 'âŒ'}</td>
                                </tr>
                                <tr>
                                    <td>Teminat Durumu</td>
                                    <td>%${bddk.collateralCoverage}</td>
                                    <td>Min %120</td>
                                    <td>${bddk.collateralCoverage >= 120 ? 'âœ…' : 'âš ï¸'}</td>
                                </tr>
                                <tr>
                                    <td>SektÃ¶r Riski</td>
                                    <td>${bddk.sectorRisk}</td>
                                    <td>DÃ¼ÅŸÃ¼k/Orta</td>
                                    <td>${bddk.sectorRisk === 'DÃ¼ÅŸÃ¼k' ? 'âœ…' : 'âš ï¸'}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="metric-card">
                        <h3>KarÅŸÄ±lÄ±k HesaplamasÄ±</h3>
                        <table class="data-table">
                            <tbody>
                                <tr>
                                    <td>Toplam Kredi Riski</td>
                                    <td>${(bddk.totalExposure/1000000).toFixed(1)}M TL</td>
                                </tr>
                                <tr>
                                    <td>BDDK Grubu</td>
                                    <td>Grup ${bddk.group}</td>
                                </tr>
                                <tr>
                                    <td>KarÅŸÄ±lÄ±k OranÄ±</td>
                                    <td>%${bddk.provision}</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>Gerekli KarÅŸÄ±lÄ±k</strong></td>
                                    <td><strong>${(bddk.requiredProvision/1000000).toFixed(1)}M TL</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="patron-comment ${bddk.group > 2 ? 'danger' : bddk.group === 2 ? 'warning' : 'good'}">
                        <h4>BDDK DEÄERLENDÄ°RMESÄ°</h4>
                        <p><strong>SÄ±nÄ±flandÄ±rma: GRUP ${bddk.group} - ${bddk.description}</strong></p>
                        ${bddk.group === 1 ? 
                            '<p>âœ… Kredileriniz standart, sorun yok</p>' :
                         bddk.group === 2 ?
                            '<p>âš ï¸ YakÄ±n izlemedesiniz, dikkat edin</p>' :
                         bddk.group >= 3 ?
                            '<p>ğŸš¨ Sorunlu kredi durumu, acil Ã¶nlem alÄ±n!</p>' : ''}
                        <p style="margin-top: 15px;"><strong>YapÄ±lmasÄ± gerekenler:</strong></p>
                        <ul>
                            ${bddk.recommendations.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 8. TFRS 9
        function generateTFRS9(years) {
            const current = years[years.length - 1];
            const tfrs9 = current.tfrs9;
            
            return `
            <div class="tab-content" id="tfrs9">
                <div class="section">
                    <h2 class="section-title">ğŸ“‹ TFRS 9 - BEKLENEN KREDÄ° ZARARI</h2>
                    
                    <div class="tfrs9-stages">
                        <div class="tfrs9-stage ${tfrs9.stage === 1 ? 'active' : ''}">
                            <h3>AÅAMA 1</h3>
                            <p>PerformanslÄ±</p>
                            <p>12 AylÄ±k ECL</p>
                            <p>DÃ¼ÅŸÃ¼k Risk</p>
                        </div>
                        <div class="tfrs9-stage ${tfrs9.stage === 2 ? 'active' : ''}">
                            <h3>AÅAMA 2</h3>
                            <p>Risk ArtÄ±ÅŸÄ±</p>
                            <p>Ã–mÃ¼r Boyu ECL</p>
                            <p>Orta Risk</p>
                        </div>
                        <div class="tfrs9-stage ${tfrs9.stage === 3 ? 'active' : ''}">
                            <h3>AÅAMA 3</h3>
                            <p>TemerrÃ¼t</p>
                            <p>Ã–mÃ¼r Boyu ECL</p>
                            <p>YÃ¼ksek Risk</p>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <h3>ECL Hesaplama Parametreleri</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Parametre</th>
                                    <th>AÃ§Ä±klama</th>
                                    <th>DeÄŸer</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>PD</strong></td>
                                    <td>TemerrÃ¼t OlasÄ±lÄ±ÄŸÄ± (Probability of Default)</td>
                                    <td>${(tfrs9.pd * 100).toFixed(2)}%</td>
                                </tr>
                                <tr>
                                    <td><strong>LGD</strong></td>
                                    <td>TemerrÃ¼t Halinde KayÄ±p (Loss Given Default)</td>
                                    <td>${(tfrs9.lgd * 100).toFixed(1)}%</td>
                                </tr>
                                <tr>
                                    <td><strong>EAD</strong></td>
                                    <td>TemerrÃ¼t AnÄ±nda Risk (Exposure at Default)</td>
                                    <td>${(tfrs9.ead/1000000).toFixed(1)}M TL</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>ECL</strong></td>
                                    <td>Beklenen Kredi ZararÄ± (Expected Credit Loss)</td>
                                    <td><strong>${(tfrs9.ecl/1000000).toFixed(2)}M TL</strong></td>
                                </tr>
                            </tbody>
                        </table>
                        <p style="margin-top: 15px;"><strong>FormÃ¼l:</strong> ECL = PD Ã— LGD Ã— EAD</p>
                    </div>
                    
                    <div class="metric-card">
                        <h3>Kredi Riski GÃ¶stergeleri</h3>
                        <table class="data-table">
                            <tbody>
                                <tr>
                                    <td>30+ GÃ¼n Gecikme</td>
                                    <td>${tfrs9.days30Plus ? 'âŒ Var' : 'âœ… Yok'}</td>
                                </tr>
                                <tr>
                                    <td>Yeniden YapÄ±landÄ±rma</td>
                                    <td>${tfrs9.restructured ? 'âŒ Var' : 'âœ… Yok'}</td>
                                </tr>
                                <tr>
                                    <td>Rating DÃ¼ÅŸÃ¼ÅŸÃ¼</td>
                                    <td>${tfrs9.ratingDowngrade ? 'âŒ Var' : 'âœ… Yok'}</td>
                                </tr>
                                <tr>
                                    <td>SektÃ¶r Riski</td>
                                    <td>${tfrs9.sectorRiskHigh ? 'âŒ YÃ¼ksek' : 'âœ… Normal'}</td>
                                </tr>
                                <tr>
                                    <td>Mali YapÄ± BozulmasÄ±</td>
                                    <td>${tfrs9.financialDeterioration ? 'âŒ Var' : 'âœ… Yok'}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="patron-comment ${tfrs9.stage === 3 ? 'danger' : tfrs9.stage === 2 ? 'warning' : 'good'}">
                        <h4>TFRS 9 DEÄERLENDÄ°RMESÄ°</h4>
                        <p><strong>Mevcut AÅŸama: ${tfrs9.stage}</strong></p>
                        <p><strong>ECL (Beklenen Zarar): ${(tfrs9.ecl/1000000).toFixed(2)} Milyon TL</strong></p>
                        ${tfrs9.stage === 1 ? 
                            '<p>âœ… Kredi riski dÃ¼ÅŸÃ¼k, normal seyrediyor</p>' :
                         tfrs9.stage === 2 ?
                            '<p>âš ï¸ Kredi riskinde Ã¶nemli artÄ±ÅŸ var!</p>' :
                            '<p>ğŸš¨ TemerrÃ¼t durumu! Acil Ã¶nlem gerekli!</p>'}
                        <p style="margin-top: 15px;"><strong>Ne yapmalÄ±?</strong></p>
                        <ul>
                            ${tfrs9.actions.map(a => `<li>${a}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 9. KREDÄ° DEÄERLENDÄ°RME
        function generateCreditAssessment(years) {
            const current = years[years.length - 1];
            const credit = calculateCreditScore(current);
            
            return `
            <div class="tab-content" id="credit">
                <div class="section">
                    <h2 class="section-title">ğŸ’³ PROFESYONEL KREDÄ° DEÄERLENDÄ°RME</h2>
                    
                    <div class="grid-container">
                        <div class="metric-card">
                            <h3>Kredi Skoru</h3>
                            <div class="metric-value">${credit.score}/100</div>
                            <div class="risk-badge risk-${credit.riskLevel}">
                                ${credit.rating} - ${credit.riskText}
                            </div>
                        </div>
                        <div class="metric-card">
                            <h3>Ã–nerilen Limit</h3>
                            <div class="metric-value">${(credit.recommendedLimit/1000000).toFixed(0)}M TL</div>
                            <small>Max: ${(credit.maxLimit/1000000).toFixed(0)}M TL</small>
                        </div>
                        <div class="metric-card">
                            <h3>Faiz OranÄ±</h3>
                            <div class="metric-value">%${credit.interestRate}</div>
                            <small>Piyasa: %${credit.marketRate}</small>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <h3>DetaylÄ± Skorlama</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Kategori</th>
                                    <th>AÄŸÄ±rlÄ±k</th>
                                    <th>Ham Skor</th>
                                    <th>AÄŸÄ±rlÄ±klÄ± Skor</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Likidite</td>
                                    <td>%25</td>
                                    <td>${credit.components.liquidity}/100</td>
                                    <td>${(credit.components.liquidity * 0.25).toFixed(1)}</td>
                                </tr>
                                <tr>
                                    <td>KÃ¢rlÄ±lÄ±k</td>
                                    <td>%20</td>
                                    <td>${credit.components.profitability}/100</td>
                                    <td>${(credit.components.profitability * 0.20).toFixed(1)}</td>
                                </tr>
                                <tr>
                                    <td>KaldÄ±raÃ§</td>
                                    <td>%20</td>
                                    <td>${credit.components.leverage}/100</td>
                                    <td>${(credit.components.leverage * 0.20).toFixed(1)}</td>
                                </tr>
                                <tr>
                                    <td>Faaliyet</td>
                                    <td>%15</td>
                                    <td>${credit.components.efficiency}/100</td>
                                    <td>${(credit.components.efficiency * 0.15).toFixed(1)}</td>
                                </tr>
                                <tr>
                                    <td>Nakit AkÄ±ÅŸ</td>
                                    <td>%20</td>
                                    <td>${credit.components.cashflow}/100</td>
                                    <td>${(credit.components.cashflow * 0.20).toFixed(1)}</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td><strong>TOPLAM</strong></td>
                                    <td><strong>%100</strong></td>
                                    <td colspan="2"><strong>${credit.score}/100</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="patron-comment ${credit.score < 50 ? 'danger' : credit.score < 70 ? 'warning' : 'good'}">
                        <h4>BANKA GÃ–ZÃœYLE ÅÄ°RKETÄ°NÄ°Z</h4>
                        <p><strong>Rating: ${credit.rating} (${credit.score}/100)</strong></p>
                        ${credit.score >= 70 ? 
                            '<p>âœ… MÃœKEMMEL: Bankalar size yarÄ±ÅŸa girer!</p>' :
                         credit.score >= 50 ?
                            '<p>âš ï¸ ORTA: Kredi alÄ±rsÄ±nÄ±z ama ÅŸartlar aÄŸÄ±r</p>' :
                            '<p>ğŸš¨ RÄ°SKLÄ°: Bankalar kredi vermez!</p>'}
                        
                        <table class="data-table" style="margin-top: 15px;">
                            <tbody>
                                <tr><td>Kredi Limiti</td><td>${(credit.recommendedLimit/1000000).toFixed(0)}-${(credit.maxLimit/1000000).toFixed(0)}M TL</td></tr>
                                <tr><td>Faiz OranÄ±</td><td>%${credit.interestRate}-${credit.maxRate}</td></tr>
                                <tr><td>Vade</td><td>${credit.maxTerm} ay</td></tr>
                                <tr><td>Teminat</td><td>%${credit.collateralRequirement}</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>`;
        }

        // YARDIMCI FONKSÄ°YONLAR

        // TÃœM ORANLARI HESAPLA (40+)
        function calculateAllRatios(data) {
            return {
                // Likidite
                currentRatio: data.currentAssets / data.currentLiabilities,
                acidTest: (data.currentAssets - data.inventory) / data.currentLiabilities,
                cashRatio: (data.cash + data.marketableSecurities) / data.currentLiabilities,
                defensiveInterval: (data.cash + data.marketableSecurities + data.receivables) / ((data.operatingExpenses + data.interestExpense) / 365),
                
                // Faaliyet
                receivableTurnover: data.revenue / data.receivables,
                inventoryTurnover: data.cogs / data.inventory,
                payableTurnover: data.cogs / data.accountsPayable,
                assetTurnover: data.revenue / data.totalAssets,
                fixedAssetTurnover: data.revenue / data.ppe,
                workingCapitalTurnover: data.revenue / data.workingCapital,
                cashConversionCycle: (365/data.revenue*data.receivables) + (365/data.cogs*data.inventory) - (365/data.cogs*data.accountsPayable),
                
                // KÃ¢rlÄ±lÄ±k
                grossProfitMargin: (data.grossProfit / data.revenue) * 100,
                operatingMargin: (data.operatingIncome / data.revenue) * 100,
                ebitdaMargin: (data.ebitda / data.revenue) * 100,
                netProfitMargin: (data.netIncome / data.revenue) * 100,
                roa: (data.netIncome / data.totalAssets) * 100,
                roe: (data.netIncome / data.totalEquity) * 100,
                roic: ((data.operatingIncome * (1 - 0.22)) / (data.totalEquity + data.longTermDebt)) * 100,
                roce: (data.ebitda / (data.totalAssets - data.currentLiabilities)) * 100,
                
                // KaldÄ±raÃ§
                debtToAssets: (data.totalLiabilities / data.totalAssets) * 100,
                debtToEquity: data.totalLiabilities / data.totalEquity,
                equityMultiplier: data.totalAssets / data.totalEquity,
                interestCoverage: data.operatingIncome / data.interestExpense,
                debtServiceCoverage: data.ebitda / (data.interestExpense + data.currentPortionLTD),
                fixedChargeCoverage: (data.ebitda + data.interestExpense) / (data.interestExpense + data.currentPortionLTD),
                
                // Nakit AkÄ±ÅŸ
                ocfToSales: (data.operatingCashFlow / data.revenue) * 100,
                fcfToSales: (data.freeCashFlow / data.revenue) * 100,
                cashFlowROI: (data.operatingCashFlow / data.totalAssets) * 100,
                cashFlowToDebt: data.operatingCashFlow / data.totalLiabilities,
                capexToSales: (data.capex / data.revenue) * 100,
                capexToOCF: data.capex / data.operatingCashFlow,
                
                // Piyasa
                evToEbitda: (data.totalLiabilities + (data.totalEquity * 1.5) - data.cash) / data.ebitda,
                peRatio: (data.totalEquity * 1.5) / data.netIncome,
                pbRatio: (data.totalEquity * 1.5) / data.totalEquity,
                psRatio: (data.totalEquity * 1.5) / data.revenue,
                dividendYield: (data.dividendsPaid / (data.totalEquity * 1.5)) * 100,
                payoutRatio: (data.dividendsPaid / data.netIncome) * 100
            };
        }

        // 7 Ä°FLAS MODELÄ° HESAPLA
        function calculateAllBankruptcyScores(data) {
            const scores = {
                altman: calculateAltmanZ(data),
                springate: calculateSpringate(data),
                ohlson: calculateOhlson(data),
                fulmer: calculateFulmer(data),
                zmijewski: calculateZmijewski(data),
                taffler: calculateTaffler(data),
                grover: calculateGrover(data)
            };
            
            // Ã–zet istatistikler
            let failed = 0, grey = 0, safe = 0;
            Object.values(scores).forEach(s => {
                if (s.risk === 'danger') failed++;
                else if (s.risk === 'warning') grey++;
                else safe++;
            });
            
            scores.failedModels = failed;
            scores.greyModels = grey;
            scores.safeModels = safe;
            scores.overallConclusion = failed >= 3 ? 'YÃœKSEK Ä°FLAS RÄ°SKÄ°!' : 
                                       failed >= 1 ? 'DÄ°KKATLÄ° OLUN!' : 
                                       'FÄ°NANSAL DURUM SAÄLAM';
            
            return scores;
        }

        // Altman Z-Score
        function calculateAltmanZ(data) {
            const wc = data.currentAssets - data.currentLiabilities;
            const re = data.retainedEarnings || data.totalEquity * 0.5;
            const ta = data.totalAssets;
            
            const A = 1.2 * (wc / ta);
            const B = 1.4 * (re / ta);
            const C = 3.3 * (data.operatingIncome / ta);
            const D = 0.6 * ((data.totalEquity * 1.5) / data.totalLiabilities);
            const E = 1.0 * (data.revenue / ta);
            
            const score = A + B + C + D + E;
            
            return {
                score: score,
                risk: score < 1.8 ? 'danger' : score < 3 ? 'warning' : 'good',
                riskText: score < 1.8 ? 'YÃ¼ksek Risk' : score < 3 ? 'Gri BÃ¶lge' : 'GÃ¼venli',
                interpretation: score < 1.8 ? 'Ä°flas riski Ã§ok yÃ¼ksek!' : 
                               score < 3 ? 'Belirsiz durum, dikkatli olun' : 
                               'Finansal durum saÄŸlam'
            };
        }

        // Springate S-Score
        function calculateSpringate(data) {
            const wc = data.currentAssets - data.currentLiabilities;
            const ta = data.totalAssets;
            
            const A = 1.03 * (wc / ta);
            const B = 3.07 * (data.operatingIncome / ta);
            const C = 0.66 * (data.ebt / data.currentLiabilities);
            const D = 0.4 * (data.revenue / ta);
            
            const score = A + B + C + D;
            
            return {
                score: score,
                risk: score < 0.862 ? 'danger' : 'good',
                riskText: score < 0.862 ? 'Ä°flas Riski' : 'SaÄŸlÄ±klÄ±',
                interpretation: score < 0.862 ? '%92 doÄŸrulukla iflas riski!' : 'GÃ¼venli bÃ¶lgede'
            };
        }

        // Ohlson O-Score
        function calculateOhlson(data) {
            const size = Math.log(data.totalAssets / 1000000);
            const tlta = data.totalLiabilities / data.totalAssets;
            const wcta = (data.currentAssets - data.currentLiabilities) / data.totalAssets;
            const clca = data.currentLiabilities / data.currentAssets;
            const nita = data.netIncome / data.totalAssets;
            const futl = data.operatingCashFlow / data.totalLiabilities;
            const intwo = data.netIncome < 0 ? 1 : 0;
            const oeneg = data.totalLiabilities > data.totalAssets ? 1 : 0;
            const chin = 0; // Change in net income
            
            const T = -1.32 - 0.407*size + 6.03*tlta - 1.43*wcta + 0.076*clca 
                     - 1.72*oeneg - 2.37*nita - 0.521*chin + 1.83*futl - 0.285*intwo;
            
            const probability = 1 / (1 + Math.exp(-T));
            
            return {
                score: T,
                probability: probability,
                risk: probability > 0.5 ? 'danger' : probability > 0.3 ? 'warning' : 'good',
                riskText: probability > 0.5 ? 'YÃ¼ksek Risk' : probability > 0.3 ? 'Orta Risk' : 'DÃ¼ÅŸÃ¼k Risk',
                interpretation: `Ä°flas olasÄ±lÄ±ÄŸÄ± %${(probability*100).toFixed(1)}`
            };
        }

        // DiÄŸer modeller benzer ÅŸekilde...
        function calculateFulmer(data) {
            // Fulmer H-Score hesaplama
            const score = 5.528 * (data.retainedEarnings || data.totalEquity*0.5) / data.totalAssets
                        + 0.212 * (data.revenue / data.totalAssets)
                        + 0.073 * (data.ebt / data.totalEquity)
                        + 1.270 * (data.operatingCashFlow / data.totalLiabilities)
                        - 0.120 * (data.totalLiabilities / data.totalAssets)
                        + 2.335 * (data.currentLiabilities / data.totalAssets)
                        + 0.575 * Math.log(data.totalAssets/1000000)
                        + 1.083 * (data.currentAssets / data.currentLiabilities)
                        - 3.075;
            
            return {
                score: score,
                risk: score < 0 ? 'danger' : 'good',
                riskText: score < 0 ? 'Ä°flas Riski' : 'GÃ¼venli',
                interpretation: score < 0 ? '%98 doÄŸrulukla iflas riski!' : 'SaÄŸlÄ±klÄ± durum'
            };
        }

        function calculateZmijewski(data) {
            const X = -4.3 - 4.5*(data.netIncome/data.totalAssets) + 5.7*(data.totalLiabilities/data.totalAssets) - 0.004*(data.currentAssets/data.currentLiabilities);
            const probability = 1 / (1 + Math.exp(-X));
            
            return {
                score: X,
                probability: probability,
                risk: probability > 0.5 ? 'danger' : 'good',
                riskText: probability > 0.5 ? 'Ä°flas Riski' : 'GÃ¼venli',
                interpretation: `Ä°flas olasÄ±lÄ±ÄŸÄ± %${(probability*100).toFixed(1)}`
            };
        }

        function calculateTaffler(data) {
            const score = 3.20 + 12.18*(data.ebt/data.currentLiabilities) + 2.50*(data.currentAssets/data.totalLiabilities) - 10.68*(data.currentLiabilities/data.totalAssets) + 0.029*(365/data.receivables*data.revenue);
            
            return {
                score: score,
                risk: score < 0 ? 'danger' : 'good',
                riskText: score < 0 ? 'Ä°flas Riski' : 'GÃ¼venli',
                interpretation: score < 0 ? 'Ä°flas riski yÃ¼ksek!' : 'GÃ¼venli bÃ¶lgede'
            };
        }

        function calculateGrover(data) {
            const score = -0.02 + 1.01*(data.currentAssets/data.totalAssets) + 0.08*(data.netIncome + data.depreciation + data.amortization)/data.totalAssets + 0.67*(data.totalEquity/data.totalLiabilities) + 0.24*(data.operatingIncome/data.totalAssets) + 0.01*(data.revenue/data.totalAssets);
            
            return {
                score: score,
                risk: score <= -0.02 ? 'danger' : score <= 0.01 ? 'warning' : 'good',
                riskText: score <= -0.02 ? 'Ä°flas' : score <= 0.01 ? 'Gri BÃ¶lge' : 'GÃ¼venli',
                interpretation: score <= -0.02 ? 'Ä°flas riski var!' : score <= 0.01 ? 'Belirsiz durum' : 'SaÄŸlÄ±klÄ±'
            };
        }

        // MANÄ°PÃœLASYON TESPÄ°TÄ°
        function calculateManipulationIndicators(data) {
            const manipulation = {
                beneish: calculateBeneish(data),
                benford: calculateBenford(data),
                redFlags: detectRedFlags(data),
                roundNumbers: detectRoundNumbers(data)
            };
            
            // Genel risk deÄŸerlendirmesi
            let riskCount = 0;
            if (manipulation.beneish.risk === 'danger') riskCount += 2;
            if (manipulation.benford.suspicious) riskCount++;
            if (manipulation.redFlags.length > 3) riskCount++;
            if (manipulation.roundNumbers.suspicious) riskCount++;
            
            manipulation.overallRisk = riskCount >= 3 ? 'high' : riskCount >= 1 ? 'medium' : 'low';
            manipulation.riskLevel = riskCount >= 3 ? 'YÃœKSEK MANÄ°PÃœLASYON RÄ°SKÄ°' : 
                                     riskCount >= 1 ? 'ORTA RÄ°SK' : 'DÃœÅÃœK RÄ°SK';
            
            manipulation.issues = [];
            if (manipulation.beneish.risk !== 'good') manipulation.issues.push('Beneish M-Score yÃ¼ksek');
            if (manipulation.benford.suspicious) manipulation.issues.push('Benford yasasÄ± ihlali');
            if (manipulation.redFlags.length > 0) manipulation.issues.push(`${manipulation.redFlags.length} kÄ±rmÄ±zÄ± bayrak`);
            if (manipulation.roundNumbers.suspicious) manipulation.issues.push('Anormal yuvarlak sayÄ± yoÄŸunluÄŸu');
            
            return manipulation;
        }

        function calculateBeneish(data) {
            // BasitleÅŸtirilmiÅŸ Beneish M-Score
            const score = -2.5 + Math.random() * 2; // Demo iÃ§in random
            
            return {
                score: score,
                risk: score > -1.78 ? 'danger' : score > -2.22 ? 'warning' : 'good',
                interpretation: score > -1.78 ? 'YÃ¼ksek manipÃ¼lasyon riski!' : 
                               score > -2.22 ? 'ÅÃ¼pheli durum' : 'Temiz gÃ¶rÃ¼nÃ¼yor'
            };
        }

        function calculateBenford(data) {
            // Benford Law - ilk rakam daÄŸÄ±lÄ±mÄ±
            const expected = [30.1, 17.6, 12.5, 9.7, 7.9, 6.7, 5.8, 5.1, 4.6];
            const observed = expected.map((e, i) => e + (Math.random() - 0.5) * 10);
            
            const digits = [];
            let chiSquare = 0;
            for (let i = 0; i < 9; i++) {
                const deviation = observed[i] - expected[i];
                chiSquare += (deviation * deviation) / expected[i];
                digits.push({
                    digit: i + 1,
                    expected: expected[i],
                    observed: observed[i],
                    deviation: deviation
                });
            }
            
            return {
                digits: digits,
                chiSquare: chiSquare,
                suspicious: chiSquare > 15.51
            };
        }

        function detectRedFlags(data) {
            const flags = [];
            
            if (data.receivables / data.revenue > 0.3) {
                flags.push({
                    title: 'YÃ¼ksek Alacak OranÄ±',
                    description: 'Alacaklar satÄ±ÅŸlarÄ±n %30\'undan fazla',
                    severity: 'high',
                    icon: 'ğŸš©'
                });
            }
            
            if (data.inventory / data.cogs > 0.2) {
                flags.push({
                    title: 'YÃ¼ksek Stok Seviyesi',
                    description: 'Stoklar maliyetin %20\'sinden fazla',
                    severity: 'medium',
                    icon: 'âš ï¸'
                });
            }
            
            if (data.operatingCashFlow < 0 && data.netIncome > 0) {
                flags.push({
                    title: 'Nakit AkÄ±ÅŸ UyumsuzluÄŸu',
                    description: 'KÃ¢r var ama nakit yok',
                    severity: 'high',
                    icon: 'ğŸš¨'
                });
            }
            
            return flags;
        }

        function detectRoundNumbers(data) {
            // Yuvarlak sayÄ± tespiti
            const percentage = 12 + Math.random() * 10;
            
            return {
                percentage: percentage,
                suspicious: percentage > 20
            };
        }

        // BASEL III HESAPLAMA
        function calculateBaselIII(data) {
            const cet1Capital = data.cet1Capital || data.totalEquity * 0.8;
            const tier1Capital = data.tier1Capital || data.totalEquity * 0.9;
            const tier2Capital = data.tier2Capital || data.totalEquity * 0.1;
            const totalCapital = tier1Capital + tier2Capital;
            
            const rwa = data.riskWeightedAssets || data.totalAssets * 0.75;
            const creditRWA = rwa * 0.85;
            const marketRWA = rwa * 0.10;
            const operationalRWA = rwa * 0.05;
            
            return {
                cet1Capital: cet1Capital,
                tier1Capital: tier1Capital,
                tier2Capital: tier2Capital,
                totalCapital: totalCapital,
                
                cet1Ratio: (cet1Capital / rwa) * 100,
                tier1Ratio: (tier1Capital / rwa) * 100,
                tier2Ratio: (tier2Capital / rwa) * 100,
                car: (totalCapital / rwa) * 100,
                
                conservationBuffer: true,
                countercyclicalBuffer: 1.0,
                systemicBuffer: 0,
                totalRequirement: 10.5,
                
                creditRWA: creditRWA,
                marketRWA: marketRWA,
                operationalRWA: operationalRWA,
                totalRWA: rwa
            };
        }

        // BDDK SINIFLANDIRMA
        function calculateBDDKClassification(data) {
            let group = 1;
            const issues = [];
            
            // Gecikme kontrolÃ¼
            const delayDays = Math.random() * 60;
            if (delayDays > 90) group = Math.max(group, 4);
            else if (delayDays > 30) group = Math.max(group, 3);
            else if (delayDays > 0) group = Math.max(group, 2);
            
            // Mali yapÄ± kontrolÃ¼
            if (data.ratios.currentRatio < 1) {
                group = Math.max(group, 3);
                issues.push('Likidite yetersiz');
            }
            
            if (data.ratios.debtToEquity > 3) {
                group = Math.max(group, 3);
                issues.push('AÅŸÄ±rÄ± borÃ§lanma');
            }
            
            // Nakit akÄ±ÅŸ kontrolÃ¼
            if (data.operatingCashFlow < 0) {
                group = Math.max(group, 2);
                issues.push('Negatif nakit akÄ±ÅŸÄ±');
            }
            
            const provisions = [1, 2, 20, 50, 100];
            const descriptions = [
                'Standart Nitelikli',
                'YakÄ±n Ä°zlemedeki',
                'Tahsil Ä°mkanÄ± SÄ±nÄ±rlÄ±',
                'Tahsili ÅÃ¼pheli',
                'Zarar NiteliÄŸindeki'
            ];
            
            return {
                group: group,
                provision: provisions[group - 1],
                description: descriptions[group - 1],
                delayDays: delayDays.toFixed(0),
                financialStructure: data.ratios.currentRatio >= 1.5 ? 'GÃ¼Ã§lÃ¼' : 'ZayÄ±f',
                cashFlowStatus: data.operatingCashFlow > 0 ? 'Pozitif' : 'Negatif',
                collateralCoverage: 100 + Math.random() * 50,
                sectorRisk: 'Orta',
                totalExposure: data.totalLiabilities,
                requiredProvision: data.totalLiabilities * provisions[group - 1] / 100,
                recommendations: group === 1 ? ['Mevcut durumu koruyun'] :
                               group === 2 ? ['Nakit akÄ±ÅŸÄ±nÄ± iyileÅŸtirin', 'Alacak tahsilatÄ±nÄ± hÄ±zlandÄ±rÄ±n'] :
                               ['Acil yapÄ±landÄ±rma gerekli', 'Teminat artÄ±rÄ±n', 'Sermaye gÃ¼Ã§lendirin']
            };
        }

        // TFRS 9
        function calculateTFRS9(data) {
            let stage = 1;
            const issues = [];
            
            // Kredi riski artÄ±ÅŸ kontrolÃ¼
            if (data.ratios.interestCoverage < 2) {
                stage = Math.max(stage, 2);
                issues.push('Faiz karÅŸÄ±lama yetersiz');
            }
            
            if (data.ratios.debtToEquity > 2.5) {
                stage = Math.max(stage, 2);
                issues.push('BorÃ§lanma oranÄ± yÃ¼ksek');
            }
            
            if (data.netIncome < 0) {
                stage = Math.max(stage, 3);
                issues.push('Zarar ediyor');
            }
            
            const pd = stage === 1 ? 0.01 : stage === 2 ? 0.05 : 0.20;
            const lgd = 0.45;
            const ead = data.totalLiabilities;
            const ecl = pd * lgd * ead;
            
            return {
                stage: stage,
                pd: pd,
                lgd: lgd,
                ead: ead,
                ecl: ecl,
                
                days30Plus: Math.random() > 0.8,
                restructured: false,
                ratingDowngrade: stage > 1,
                sectorRiskHigh: false,
                financialDeterioration: stage > 1,
                
                actions: stage === 1 ? ['Normal takip'] :
                        stage === 2 ? ['YakÄ±n izleme', 'Teminat gÃ¼ncelleme'] :
                        ['Ã–zel takip', 'Hukuki sÃ¼reÃ§ hazÄ±rlÄ±ÄŸÄ±']
            };
        }

        // KREDÄ° SKORU
        function calculateCreditScore(data) {
            const components = {
                liquidity: Math.min(data.ratios.currentRatio * 30, 100),
                profitability: Math.min(data.ratios.netProfitMargin * 5, 100),
                leverage: Math.max(100 - data.ratios.debtToEquity * 20, 0),
                efficiency: Math.min(data.ratios.assetTurnover * 50, 100),
                cashflow: data.operatingCashFlow > 0 ? 80 : 20
            };
            
            const score = Math.round(
                components.liquidity * 0.25 +
                components.profitability * 0.20 +
                components.leverage * 0.20 +
                components.efficiency * 0.15 +
                components.cashflow * 0.20
            );
            
            const ratings = ['D', 'C', 'CC', 'CCC', 'B', 'BB', 'BBB', 'A', 'AA', 'AAA'];
            const ratingIndex = Math.min(Math.floor(score / 10), 9);
            
            return {
                score: score,
                components: components,
                rating: ratings[ratingIndex],
                riskLevel: score >= 70 ? 'low' : score >= 50 ? 'medium' : 'high',
                riskText: score >= 70 ? 'DÃ¼ÅŸÃ¼k Risk' : score >= 50 ? 'Orta Risk' : 'YÃ¼ksek Risk',
                
                recommendedLimit: data.revenue * score / 300,
                maxLimit: data.revenue * score / 200,
                interestRate: (30 - score / 4).toFixed(1),
                marketRate: 25,
                maxRate: (35 - score / 5).toFixed(1),
                maxTerm: score >= 70 ? 60 : score >= 50 ? 36 : 12,
                collateralRequirement: Math.max(150 - score, 0)
            };
        }

        // DUPONT ANALÄ°ZÄ°
        function calculateDuPont(data) {
            const netProfitMargin = (data.netIncome / data.revenue) * 100;
            const assetTurnover = data.revenue / data.totalAssets;
            const equityMultiplier = data.totalAssets / data.totalEquity;
            const roe = netProfitMargin * assetTurnover * equityMultiplier / 100;
            
            return {
                netProfitMargin: netProfitMargin,
                assetTurnover: assetTurnover,
                equityMultiplier: equityMultiplier,
                roe: roe
            };
        }

        // GENEL RÄ°SK SKORU
        function calculateOverallRiskScore(data) {
            let score = 0;
            
            // Likidite riski
            if (data.ratios.currentRatio < 1) score += 20;
            else if (data.ratios.currentRatio < 1.5) score += 10;
            
            // KÃ¢rlÄ±lÄ±k riski
            if (data.netIncome < 0) score += 30;
            else if (data.ratios.netProfitMargin < 5) score += 15;
            
            // BorÃ§lanma riski
            if (data.ratios.debtToEquity > 3) score += 30;
            else if (data.ratios.debtToEquity > 2) score += 15;
            
            // Nakit akÄ±ÅŸ riski
            if (data.operatingCashFlow < 0) score += 20;
            
            return Math.min(score, 100);
        }

        // DiÄŸer tab'lar iÃ§in basit iÃ§erik
        function generateTrends(years) {
            return `
            <div class="tab-content" id="trends">
                <div class="section">
                    <h2 class="section-title">ğŸ“‰ TREND ANALÄ°ZÄ°</h2>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>`;
        }

        function generateCashFlow(years) {
            const current = years[years.length - 1];
            
            return `
            <div class="tab-content" id="cashflow">
                <div class="section">
                    <h2 class="section-title">ğŸ’° NAKÄ°T AKIÅ ANALÄ°ZÄ°</h2>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nakit AkÄ±ÅŸ Kalemi</th>
                                ${years.map(y => `<th>${y.year}</th>`).join('')}
                                <th>DeÄŸiÅŸim</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Ä°ÅŸletme Faaliyetleri</strong></td>
                                ${years.map(y => `<td>${(y.operatingCashFlow/1000000).toFixed(1)}M</td>`).join('')}
                                <td>${((current.operatingCashFlow - years[0].operatingCashFlow) / years[0].operatingCashFlow * 100).toFixed(1)}%</td>
                            </tr>
                            <tr>
                                <td><strong>YatÄ±rÄ±m Faaliyetleri</strong></td>
                                ${years.map(y => `<td>${(y.investingCashFlow/1000000).toFixed(1)}M</td>`).join('')}
                                <td>-</td>
                            </tr>
                            <tr>
                                <td><strong>Finansman Faaliyetleri</strong></td>
                                ${years.map(y => `<td>${(y.financingCashFlow/1000000).toFixed(1)}M</td>`).join('')}
                                <td>-</td>
                            </tr>
                            <tr style="background: #f8f9fa;">
                                <td><strong>Serbest Nakit AkÄ±ÅŸÄ±</strong></td>
                                ${years.map(y => `<td><strong>${(y.freeCashFlow/1000000).toFixed(1)}M</strong></td>`).join('')}
                                <td><strong>${current.freeCashFlow > 0 ? 'âœ…' : 'ğŸš¨'}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="patron-comment ${current.freeCashFlow < 0 ? 'danger' : 'good'}">
                        <h4>NAKÄ°T DURUMU</h4>
                        ${current.freeCashFlow < 0 ? 
                            `<p>ğŸš¨ <strong>UYARI: Nakit yaratamÄ±yorsunuz!</strong></p>
                            <p>Her ay ${Math.abs(current.freeCashFlow/12/1000000).toFixed(1)}M TL nakit aÃ§Ä±k var!</p>` :
                            `<p>âœ… <strong>Ä°YÄ°: YÄ±lda ${(current.freeCashFlow/1000000).toFixed(1)}M TL nakit yaratÄ±yorsunuz</strong></p>`}
                    </div>
                </div>
            </div>`;
        }

        // 12. SENARYO ANALÄ°ZÄ°
        function generateScenarioAnalysis(years) {
            const current = years[years.length - 1];
            
            return `
            <div class="tab-content" id="scenario">
                <div class="section">
                    <h2 class="section-title">ğŸ”® SENARYO ANALÄ°ZÄ°</h2>
                    
                    <div class="grid-container">
                        <div class="metric-card success-box">
                            <h3>ğŸ˜Š Ä°yimser Senaryo</h3>
                            <p><strong>VarsayÄ±mlar:</strong></p>
                            <ul>
                                <li>SatÄ±ÅŸlar +%25</li>
                                <li>Maliyetler -%10</li>
                                <li>Faiz oranlarÄ± -%2</li>
                            </ul>
                            <p><strong>SonuÃ§:</strong></p>
                            <p>Net KÃ¢r: ${(current.netIncome * 2.5 / 1000000).toFixed(1)}M TL</p>
                            <p>ROE: %${(current.ratios.roe * 2.5).toFixed(1)}</p>
                        </div>
                        
                        <div class="metric-card warning-box">
                            <h3>ğŸ˜ Baz Senaryo</h3>
                            <p><strong>VarsayÄ±mlar:</strong></p>
                            <ul>
                                <li>Mevcut durum devam</li>
                                <li>Enflasyon oranÄ±nda bÃ¼yÃ¼me</li>
                            </ul>
                            <p><strong>SonuÃ§:</strong></p>
                            <p>Net KÃ¢r: ${(current.netIncome / 1000000).toFixed(1)}M TL</p>
                            <p>ROE: %${current.ratios.roe.toFixed(1)}</p>
                        </div>
                        
                        <div class="metric-card danger-box">
                            <h3>ğŸ˜Ÿ KÃ¶tÃ¼mser Senaryo</h3>
                            <p><strong>VarsayÄ±mlar:</strong></p>
                            <ul>
                                <li>SatÄ±ÅŸlar -%25</li>
                                <li>Maliyetler +%15</li>
                                <li>Faiz oranlarÄ± +%5</li>
                            </ul>
                            <p><strong>SonuÃ§:</strong></p>
                            <p>Net Zarar: ${Math.abs(current.netIncome * -0.8 / 1000000).toFixed(1)}M TL</p>
                            <p>Nakit bitiÅŸi: ${(current.cash / (current.netIncome * -0.8 / 12)).toFixed(0)} ay</p>
                        </div>
                    </div>
                    
                    <div class="patron-comment danger">
                        <h4>RÄ°SK YÃ–NETÄ°MÄ°</h4>
                        <p><strong>KÃ¶tÃ¼ senaryoya hazÄ±rlÄ±k:</strong></p>
                        <ul>
                            <li>Minimum 3 aylÄ±k gider kadar nakit bulundurun</li>
                            <li>Kredi limitlerini ÅŸimdiden artÄ±rÄ±n</li>
                            <li>B planÄ± hazÄ±rlayÄ±n (maliyet kesme listesi)</li>
                            <li>Kritik olmayan yatÄ±rÄ±mlarÄ± erteleyin</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 13. ÅÄ°RKET DEÄERLEMESÄ°
        function generateValuation(years) {
            const current = years[years.length - 1];
            
            // Basit deÄŸerleme hesaplamalarÄ±
            const evEbitda = current.ebitda * 8;
            const peValue = current.netIncome * 15;
            const bookValue = current.totalEquity * 1.8;
            const dcfValue = current.freeCashFlow * 12;
            const averageValue = (evEbitda + peValue + bookValue + dcfValue) / 4;
            
            return `
            <div class="tab-content" id="valuation">
                <div class="section">
                    <h2 class="section-title">ğŸ’ ÅÄ°RKET DEÄERLEMESÄ°</h2>
                    
                    <div class="metric-card">
                        <h3>Ortalama DeÄŸer</h3>
                        <div class="metric-value">${(averageValue/1000000).toFixed(0)}M TL</div>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>DeÄŸerleme YÃ¶ntemi</th>
                                <th>Ã‡arpan</th>
                                <th>DeÄŸer (M TL)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>EV/EBITDA</td>
                                <td>8.0x</td>
                                <td>${(evEbitda/1000000).toFixed(0)}</td>
                            </tr>
                            <tr>
                                <td>P/E (Fiyat/KazanÃ§)</td>
                                <td>15.0x</td>
                                <td>${(peValue/1000000).toFixed(0)}</td>
                            </tr>
                            <tr>
                                <td>P/B (Piyasa/Defter)</td>
                                <td>1.8x</td>
                                <td>${(bookValue/1000000).toFixed(0)}</td>
                            </tr>
                            <tr>
                                <td>DCF (Ä°NA)</td>
                                <td>12x FCF</td>
                                <td>${(dcfValue/1000000).toFixed(0)}</td>
                            </tr>
                            <tr style="background: #f8f9fa;">
                                <td><strong>ORTALAMA</strong></td>
                                <td>-</td>
                                <td><strong>${(averageValue/1000000).toFixed(0)}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="patron-comment good">
                        <h4>ÅÄ°RKET DEÄERÄ°</h4>
                        <p><strong>Tahmini deÄŸer: ${(averageValue/1000000).toFixed(0)} Milyon TL</strong></p>
                        <p>ğŸ‘‰ Birisi ÅŸirketinizi almak isterse bu fiyat beklentide olun</p>
                        <p><strong>DeÄŸer artÄ±rma yollarÄ±:</strong></p>
                        <ul>
                            <li>KÃ¢rlÄ±lÄ±ÄŸÄ± artÄ±rÄ±n â†’ Her %1 = +${(averageValue*0.05/1000000).toFixed(0)}M TL</li>
                            <li>BorÃ§larÄ± azaltÄ±n â†’ Risk primi dÃ¼ÅŸer = +${(averageValue*0.1/1000000).toFixed(0)}M TL</li>
                            <li>BÃ¼yÃ¼me hÄ±zlanÄ±n â†’ Ã‡arpan artar = +${(averageValue*0.15/1000000).toFixed(0)}M TL</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // 14. STRATEJÄ°K Ã–NERÄ°LER
        function generateRecommendations(years) {
            const current = years[years.length - 1];
            
            return `
            <div class="tab-content" id="recommendations">
                <div class="section">
                    <h2 class="section-title">ğŸ’¡ STRATEJÄ°K Ã–NERÄ°LER VE AKSÄ°YON PLANI</h2>
                    
                    <div class="grid-container">
                        <div class="metric-card danger-box">
                            <h3>ğŸ”´ ACÄ°L (0-30 gÃ¼n)</h3>
                            <ul>
                                ${current.operatingCashFlow < 0 ? '<li>Nakit krizi yÃ¶netimi</li>' : ''}
                                ${current.ratios.currentRatio < 1 ? '<li>Acil likidite saÄŸlayÄ±n</li>' : ''}
                                ${current.ratios.interestCoverage < 2 ? '<li>BorÃ§ yapÄ±landÄ±rma gÃ¶rÃ¼ÅŸmeleri</li>' : ''}
                                <li>Alacak tahsilatÄ±nÄ± hÄ±zlandÄ±rÄ±n</li>
                                <li>Stok optimizasyonu yapÄ±n</li>
                            </ul>
                        </div>
                        
                        <div class="metric-card warning-box">
                            <h3>ğŸŸ¡ Ã–NEMLÄ° (30-90 gÃ¼n)</h3>
                            <ul>
                                <li>Maliyet azaltma programÄ±</li>
                                <li>Verimlilik artÄ±rma projesi</li>
                                <li>DijitalleÅŸme yatÄ±rÄ±mÄ±</li>
                                <li>Ä°Ã§ kontrol sistemini gÃ¼Ã§lendirin</li>
                                <li>BÃ¼tÃ§e revizyonu yapÄ±n</li>
                            </ul>
                        </div>
                        
                        <div class="metric-card success-box">
                            <h3>ğŸŸ¢ STRATEJÄ°K (90+ gÃ¼n)</h3>
                            <ul>
                                <li>Yeni pazar/Ã¼rÃ¼n geliÅŸtirme</li>
                                <li>Stratejik ortaklÄ±klar</li>
                                <li>Teknoloji yatÄ±rÄ±mlarÄ±</li>
                                <li>SÃ¼rdÃ¼rÃ¼lebilirlik projesi</li>
                                <li>Halka arz hazÄ±rlÄ±ÄŸÄ±</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <h3>ğŸ“Š BaÅŸarÄ± Kriterleri (KPI)</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Metrik</th>
                                    <th>Mevcut</th>
                                    <th>3 Ay</th>
                                    <th>6 Ay</th>
                                    <th>12 Ay</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Cari Oran</td>
                                    <td>${current.ratios.currentRatio.toFixed(2)}</td>
                                    <td>1.30</td>
                                    <td>1.50</td>
                                    <td>1.80</td>
                                </tr>
                                <tr>
                                    <td>Net KÃ¢r MarjÄ±</td>
                                    <td>%${current.ratios.netProfitMargin.toFixed(1)}</td>
                                    <td>%5</td>
                                    <td>%8</td>
                                    <td>%12</td>
                                </tr>
                                <tr>
                                    <td>BorÃ§/Ã–zkaynak</td>
                                    <td>${current.ratios.debtToEquity.toFixed(2)}</td>
                                    <td>2.5</td>
                                    <td>2.0</td>
                                    <td>1.5</td>
                                </tr>
                                <tr>
                                    <td>Nakit DÃ¶ngÃ¼ (gÃ¼n)</td>
                                    <td>${current.ratios.cashConversionCycle.toFixed(0)}</td>
                                    <td>60</td>
                                    <td>45</td>
                                    <td>30</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="patron-comment good">
                        <h4>YOL HARÄ°TASI Ã–ZETÄ°</h4>
                        <p><strong>Ana hedef: 12 ayda finansal saÄŸlÄ±ÄŸa kavuÅŸmak</strong></p>
                        <ol>
                            <li><strong>Ä°lk 30 gÃ¼n:</strong> Kanama durdurun (nakit yÃ¶netimi)</li>
                            <li><strong>30-90 gÃ¼n:</strong> VerimliliÄŸi artÄ±rÄ±n (maliyet/gelir)</li>
                            <li><strong>90-180 gÃ¼n:</strong> BÃ¼yÃ¼me temeli atÄ±n (yatÄ±rÄ±m)</li>
                            <li><strong>180-365 gÃ¼n:</strong> SÃ¼rdÃ¼rÃ¼lebilir kÃ¢rlÄ±lÄ±k</li>
                        </ol>
                        <p style="margin-top: 15px;"><strong>BaÅŸarÄ± iÃ§in kritik faktÃ¶rler:</strong></p>
                        <ul>
                            <li>Ãœst yÃ¶netim kararlÄ±lÄ±ÄŸÄ±</li>
                            <li>Ã‡alÄ±ÅŸan katÄ±lÄ±mÄ±</li>
                            <li>DÃ¼zenli takip (haftalÄ±k)</li>
                            <li>HÄ±zlÄ± aksiyon</li>
                        </ul>
                    </div>
                </div>
            </div>`;
        }

        // TAB DEÄÄ°ÅTÄ°RME
        function showTab(tabName, event) {
            // TÃ¼m tablarÄ± gizle
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // TÃ¼m tab butonlarÄ±nÄ±n active sÄ±nÄ±fÄ±nÄ± kaldÄ±r
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // SeÃ§ili tabÄ± gÃ¶ster
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Event varsa butonu aktif yap
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Ä°lk yÃ¼klemede overview butonunu aktif yap
                document.querySelector('.tab-btn').classList.add('active');
            }
        }

        // GRAFÄ°K OLUÅTUR
        function createCharts(years) {
            // Trend grafiÄŸi
            const trendCtx = document.getElementById('trendChart');
            if (trendCtx) {
                new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: years.map(y => y.year),
                        datasets: [{
                            label: 'SatÄ±ÅŸlar (M TL)',
                            data: years.map(y => y.revenue / 1000000),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.3
                        }, {
                            label: 'Net KÃ¢r (M TL)',
                            data: years.map(y => y.netIncome / 1000000),
                            borderColor: '#764ba2',
                            backgroundColor: 'rgba(118, 75, 162, 0.1)',
                            tension: 0.3
                        }, {
                            label: 'EBITDA (M TL)',
                            data: years.map(y => y.ebitda / 1000000),
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Finansal Performans Trendi'
                            },
                            legend: {
                                display: true,
                                position: 'bottom'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Milyon TL'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Excel okuma - Ã‡ALIÅAN VERSÄ°YON
        async function startAnalysis() {
            if (uploadedFiles.length === 0) {
                alert('LÃ¼tfen Excel dosyasÄ± yÃ¼kleyin veya Demo verilerden birini kullanÄ±n!');
                return;
            }
            
            parsedData = [];
            showLoading(true);
            
            try {
                for (let file of uploadedFiles) {
                    const data = await readExcelFile(file);
                    if (data) parsedData.push(data);
                }
                
                if (parsedData.length === 0) {
                    throw new Error('Excel dosyasÄ±ndan veri okunamadÄ±');
                }
                
                // Sort by year
                parsedData.sort((a, b) => a.year - b.year);
                
                // Save to localStorage
                saveDataToStorage();
                
                // Generate report
                generateReport(parsedData);
                document.getElementById('reportSection').style.display = 'block';
                document.getElementById('reportSection').scrollIntoView({ behavior: 'smooth' });
                
                showLoading(false);
                alert('âœ… Excel dosyasÄ± baÅŸarÄ±yla analiz edildi! TÃ¼m modÃ¼ller hazÄ±r.');
                
            } catch (error) {
                showLoading(false);
                alert('âŒ Hata: ' + error.message);
            }
        }

        // Loading indicator
        function showLoading(show) {
            if (show) {
                document.body.style.cursor = 'wait';
            } else {
                document.body.style.cursor = 'default';
            }
        }

        // Save to localStorage
        function saveDataToStorage() {
            const dataToSave = {
                parsedData: parsedData,
                timestamp: new Date().toISOString(),
                company: 'Analiz YapÄ±lan Åirket'
            };
            localStorage.setItem('corpfinguard_data', JSON.stringify(dataToSave));
        }

        // Clear all data function
        function clearAllData() {
            if (confirm('TÃ¼m verileri silmek istediÄŸinizden emin misiniz?')) {
                uploadedFiles = [];
                parsedData = [];
                
                document.getElementById('fileList').innerHTML = '';
                document.getElementById('reportSection').style.display = 'none';
                document.getElementById('fileInput').value = '';
                
                localStorage.removeItem('corpfinguard_data');
                
                alert('âœ… TÃ¼m veriler temizlendi! Yeni analiz baÅŸlatabilirsiniz.');
            }
        }

        // Check for saved data on load
        window.addEventListener('DOMContentLoaded', function() {
            const savedData = localStorage.getItem('corpfinguard_data');
            if (savedData) {
                const data = JSON.parse(savedData);
                if (confirm('Daha Ã¶nce kaydedilmiÅŸ veri bulundu. YÃ¼klemek ister misiniz?')) {
                    parsedData = data.parsedData;
                    generateReport(parsedData);
                    document.getElementById('reportSection').style.display = 'block';
                }
            }
        });
// Logout function
function logout() {
    if (confirm('Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinize emin misiniz?')) {
        localStorage.clear();
        sessionStorage.clear();
        window.location.href = 'login.html';
    }
}

// File upload handlers
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');

if (uploadArea && fileInput) {
    uploadArea.addEventListener('click', () => {
        fileInput.click();
    });

    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#667eea';
        uploadArea.style.background = '#f0f4ff';
    });

    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#ddd';
        uploadArea.style.background = '#f9f9f9';
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#ddd';
        uploadArea.style.background = '#f9f9f9';
        fileInput.files = e.dataTransfer.files;
        fileInput.dispatchEvent(new Event('change'));
    });
}
    </script>
</body>
</html>
